{"version":3,"file":"backend.js","mappings":";;;;;;AAAA,iBAAiB,mBAAO,CAAC,GAAU;AACnC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,6BAA6B,yBAAyB;AACtD;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,mBAAmB,kCAAkC;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,UAAU,kBAAkB;AACnF;AACA;AACA;AACA,mBAAmB,kCAAkC;AACrD;AACA,OAAO;AACP,cAAc,yBAAyB;AACvC;AACA;AACA,kBAAkB,4BAA4B;AAC9C;AACA,OAAO;AACP;AACA,eAAe;AACf;;AAEA;AACA,iBAAiB,oBAAoB;AACrC;AACA,qEAAqE,wBAAwB;AAC7F;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,UAAU,kBAAkB;AACnF;AACA;AACA;AACA,mBAAmB,iCAAiC;AACpD;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,4BAA4B,kDAAkD;AAC9E;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,uCAAuC,+BAA+B;AACtE;AACA;;AAEA,mBAAmB,kCAAkC,sCAAsC;AAC3F;AACA;AACA;AACA,yDAAyD,wBAAwB;AACjF;AACA;AACA;;AAEA;AACA,6CAA6C,+CAA+C;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,oBAAoB;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,gCAAgC,yBAAyB,UAAU,kBAAkB;AACrF;AACA;AACA;AACA,qBAAqB,4CAA4C;AACjE;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA,kBAAkB,qCAAqC;AACvD,iCAAiC,+CAA+C;AAChF;;AAEA;AACA,kBAAkB,kCAAkC;AACpD;AACA,qEAAqE,wBAAwB;AAC7F;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,UAAU,kBAAkB;AACnF;AACA,wCAAwC;AACxC;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,mBAAmB,0DAA0D;AAC7E;AACA,OAAO;AACP;;AAEA;AACA,mBAAmB,mBAAmB;AACtC,qEAAqE,wBAAwB;AAC7F;AACA;AACA;AACA,4BAA4B,gCAAgC;AAC5D;;AAEA,kBAAkB,WAAW;AAC7B,wCAAwC,0BAA0B;AAClE,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,WAAW;AAC9B,sCAAsC,4BAA4B;AAClE;;AAEA,qBAAqB,WAAW;AAChC,sCAAsC,8BAA8B;AACpE;;AAEA,wBAAwB,sBAAsB;AAC9C;AACA,sDAAsD,kBAAkB;AACxE;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,uDAAuD;AAC7F,sCAAsC,wDAAwD;AAC9F;AACA;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,gCAAgC;AACrD;AACA;AACA;AACA,8BAA8B,yBAAyB,UAAU,kBAAkB;AACnF;AACA;AACA;AACA;AACA,mBAAmB,gCAAgC;AACnD;AACA,OAAO;AACP;;AAEA,mBAAmB,qBAAqB;AACxC,+CAA+C,aAAa;AAC5D;AACA,6CAA6C,kEAAkE;AAC/G;;AAEA,sBAAsB,eAAe,MAAM;AAC3C,uDAAuD,IAAI;AAC3D,gDAAgD,aAAa;AAC7D;;AAEA,kCAAkC,QAAQ;AAC1C;AACA,+DAA+D,QAAQ;AACvE;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,kCAAkC,4BAA4B;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B,eAAe;AAC9C;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA,6DAA6D,4BAA4B;AACzF;AACA,mBAAmB,aAAa;AAChC;AACA;;AAEA,2BAA2B,0BAA0B;AACrD;AACA;AACA,qBAAqB,aAAa;AAClC,4CAA4C,uCAAuC;AACnF,SAAS;AACT,OAAO;AACP;;AAEA,iCAAiC,4BAA4B;AAC7D;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,sBAAsB;AACtB,8BAA8B,wBAAwB;AACtD;AACA;;AAEA,yBAAyB,qEAAqE;AAC9F;AACA;AACA,qBAAqB,aAAa;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,+BAA+B,kFAAkF;AACjH;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,mBAAmB,2BAA2B;AAC9C;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB,gCAAgC,gCAAgC;AAChE,UAAU;AACV;AACA;AACA,2BAA2B;AAC3B,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,iEAAiE,2BAA2B;AAC5F;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,UAAU,kBAAkB;AACnF;AACA;AACA,sCAAsC,qDAAqD;AAC3F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA;AACA;AACA,0BAA0B,mBAAmB,GAAG,0BAA0B;AAC1E,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kEAAkE;AACrF;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;AACA,qBAAqB,qBAAqB;AAC1C,gBAAgB,kFAAkF;AAClG;AACA,KAAK;AACL;AACA,wEAAwE,iBAAiB;AACzF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,oBAAoB,qBAAqB;AACzC;AACA;;AAEA,oBAAoB,mBAAmB;AACvC;AACA;AACA;;AAEA,iBAAiB,6CAA6C;AAC9D;AACA;AACA;AACA,6CAA6C,iCAAiC;AAC9E;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,kBAAkB,sBAAsB,4BAA4B,2CAA2C;AAC/G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,oBAAoB,mBAAmB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,oBAAoB,8CAA8C;AAClE,mCAAmC,2DAA2D;AAC9F;;AAEA,wBAAwB,8CAA8C;AACtE,mCAAmC,0DAA0D;AAC7F;;AAEA,qBAAqB,oDAAoD;AACzE;AACA;AACA,uDAAuD,YAAY;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,yDAAyD;AAC1G,YAAY;AACZ,mDAAmD,yDAAyD;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA,wBAAwB,qBAAqB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,yDAAyD;AACrF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D,kBAAkB;AAC9E;AACA;AACA,qCAAqC,6CAA6C;AAClF;AACA;AACA;AACA;AACA;AACA,gBAAgB,YAAY;AAC5B;AACA;AACA,OAAO;AACP;;AAEA,8BAA8B,yDAAyD;AACvF;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8DAA8D,kBAAkB;AAChF;AACA;AACA,uCAAuC,6CAA6C;AACpF;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,wBAAwB,+CAA+C;AACvE;AACA;AACA;AACA,yDAAyD,QAAQ;AACjE;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,uDAAuD,YAAY;AACnE;AACA;AACA;AACA;AACA,4CAA4C,yDAAyD;AACrG;AACA;AACA,4CAA4C,yDAAyD;AACrG;;AAEA;AACA,qCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,cAAc;AAClE;AACA;AACA;AACA,iEAAiE,UAAU;AAC3E;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D,QAAQ;AACnE;AACA;AACA;AACA,sCAAsC,2BAA2B;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;;AAEA,yCAAyC,2BAA2B;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACj0BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,aAAa,qCAAqC;AAClD;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAsB,qBAAqB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA,qFAAqF,OAAO;AAC5F;AACA;AACA;AACA,oDAAoD,mBAAmB,GAAG,4BAA4B,GAAG,OAAO;AAChH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACjFA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,yBAAyB;AAC3C;AACA;AACA;;AAEA,gBAAgB,6BAA6B;AAC7C;AACA,0BAA0B,KAAK,IAAI;AACnC;AACA;AACA;AACA;AACA;AACA,qBAAqB,wBAAwB;AAC7C;AACA;AACA;AACA;AACA,uBAAuB,yBAAyB;AAChD;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,0BAA0B,yBAAyB;AACnD;AACA,yCAAyC,yBAAyB;AAClE;AACA;AACA,2CAA2C,yBAAyB;AACpE,qDAAqD,OAAO,GAAG,iBAAiB;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,UAAU;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAsB,aAAa;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACvHA;AACA;AACA,oBAAoB,mDAAmD;AACvE;AACA;AACA;AACA,gBAAgB;AAChB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gCAAgC,OAAO;AACvC;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,WAAW;AAC9C,QAAQ;AACR;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAQ;AACR,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B,eAAe;AAC5C;AACA;AACA;AACA,cAAc;;AAEd,YAAY;AACZ;AACA,qCAAqC,KAAK,kBAAkB;AAC5D;;AAEA,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA,gBAAgB,0BAA0B;AAC1C;AACA;AACA;AACA,gBAAgB;AAChB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,WAAW;AAC9C,QAAQ;AACR;AACA;AACA;;AAEA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc;;AAEd,uBAAuB;AACvB,wCAAwC;AACxC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;AC5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACpDA,uBAAuB,mBAAO,CAAC,GAA2B;AAC1D,uBAAuB,mBAAO,CAAC,GAA2B;AAC1D,mBAAmB,mBAAO,CAAC,GAAuB;AAClD,wBAAwB,mBAAO,CAAC,EAA4B;AAC5D,yBAAyB,mBAAO,CAAC,GAA6B;;AAE9D;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACpCA;AACA;;AAEA;AACA;AACA;AACA,mBAAmB,kCAAkC;AACrD;AACA;AACA;AACA;AACA;AACA,6BAA6B,wBAAwB,GAAG,SAAS;AACjE;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,sBAAsB;AAC3E;AACA,yDAAyD,0CAA0C;AACnG,eAAe;AACf;;AAEA,iBAAiB,iCAAiC;AAClD;AACA,+CAA+C,+CAA+C;AAC9F;;AAEA,uBAAuB,4CAA4C;AACnE;AACA;;AAEA,mBAAmB,sCAAsC;AACzD;AACA;AACA,kBAAkB,kBAAkB;AACpC;AACA,OAAO;AACP;;AAEA,kBAAkB,+CAA+C;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,mDAAmD,uDAAuD;AAC1G;AACA;AACA;AACA,gCAAgC,4BAA4B;AAC5D;;AAEA,yBAAyB,4BAA4B;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,cAAc;AACzD;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,0BAA0B,sBAAsB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,aAAa;AAC/B;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,kBAAkB,oBAAoB;AACtC;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,kBAAkB,cAAc;AAChC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,kBAAkB,gBAAgB;AAClC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,kBAAkB,6BAA6B;AAC/C;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,kBAAkB,oBAAoB;AACtC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,kBAAkB,cAAc;AAChC;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;;;;;;;;AC1GA;AACA;;;;;;;;ACDA;;;;;;;;ACAA;;;;;;;;ACAA;AACA,WAAW,mBAAO,CAAC,GAAmB;AACtC,WAAW,mBAAO,CAAC,EAAmB;AACtC;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA,kBAAkB;AAClB,OAAO;AACP;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,eAAe;AACf;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACxFA,6BAA6B,mBAAO,CAAC,GAAkC;AACvE,6BAA6B,mBAAO,CAAC,GAAkC;;AAEvE;AACA;AACA;AACA;;;;;;;;ACNA;AACA;AACA;AACA;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,mEAAmE;AACnE;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;;;;;;;ACvHA,aAAa,mBAAO,CAAC,GAAsB;AAC3C,eAAe,mBAAO,CAAC,GAAwB;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA,eAAe,mBAAO,CAAC,EAAoB;AAC3C,gBAAgB,mBAAO,CAAC,EAAqB;AAC7C,eAAe,mBAAO,CAAC,GAAoB;AAC3C,qBAAqB,mBAAO,CAAC,GAAwB;;AAErD;AACA;AACA;;AAEA;AACA,gBAAgB,mBAAO,CAAC,GAAY;AACpC;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD;AACA,mBAAmB,mBAAO,CAAC,GAAe;AAC1C;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,oBAAoB,mBAAO,CAAC,GAAuB;AACnD;AACA,eAAe,mBAAO,CAAC,GAAW;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACpCA;AACA,kBAAkB,mBAAO,CAAC,GAAgC;AAC1D,wBAAwB,mBAAO,CAAC,GAA4B;AAC5D;AACA;AACA,eAAe;AACf;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA,oBAAoB;AACpB,kBAAkB;AAClB;AACA,KAAK;AACL;AACA;AACA;;;;;;;;AC9BA;AACA;AACA;AACA,mBAAmB,6BAA6B,yBAAyB;AACzE;AACA;;AAEA;AACA;;;;;;;;ACRA;AACA;AACA;AACA,mBAAmB,kCAAkC,yBAAyB;AAC9E;AACA;;AAEA;AACA;;;;;;;;ACRA,eAAe,mBAAO,CAAC,GAAmB;AAC1C,oBAAoB,mBAAO,CAAC,GAAwB;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA;AACA;AACA;AACA,MAAM,gEAAgE;AACtE,MAAM,0DAA0D;AAChE;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,oCAAoC;AAC3D,KAAK;AACL,MAAM,mEAAmE,SAAS,oCAAoC;AACtH;AACA;AACA;AACA;AACA,cAAc,SAAS,kCAAkC;AACzD,KAAK;AACL,MAAM,oEAAoE,SAAS,oCAAoC;AACvH;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,mCAAmC;AAC1D,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,oCAAoC;AAC3D,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,mCAAmC;AAC1D,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,oCAAoC;AAC3D,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,sCAAsC;AAC7D,KAAK;AACL,MAAM,8DAA8D;AACpE,MAAM,kEAAkE;AACxE,MAAM,gEAAgE;AACtE;AACA;AACA;;;;;;;;AC7DA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACZA;AACA;AACA,mBAAmB,kCAAkC;AACrD,iDAAiD,kCAAkC;AACnF;;AAEA,iBAAiB,oBAAoB;AACrC,+CAA+C,oBAAoB;AACnE;;AAEA,mBAAmB,qCAAqC;AACxD,iDAAiD,qCAAqC;AACtF;;AAEA,kBAAkB,qCAAqC;AACvD,gDAAgD,qCAAqC;AACrF;;AAEA,kBAAkB,0BAA0B;AAC5C,gDAAgD,0BAA0B;AAC1E;;AAEA,mBAAmB,WAAW;AAC9B,iDAAiD,WAAW;AAC5D;;AAEA,kBAAkB,WAAW;AAC7B,gDAAgD,WAAW;AAC3D;;AAEA,mBAAmB,WAAW;AAC9B,iDAAiD,WAAW;AAC5D;;AAEA,qBAAqB,WAAW;AAChC,mDAAmD,WAAW;AAC9D;;AAEA,oBAAoB,8CAA8C;AAClE,kDAAkD,8CAA8C;AAChG;;AAEA,wBAAwB,8CAA8C;AACtE,sDAAsD,8CAA8C;AACpG;;AAEA,sBAAsB,aAAa;AACnC,oDAAoD,aAAa;AACjE;AACA;;AAEA;AACA;;;;;;;;ACpDA,aAAa,mBAAO,CAAC,GAAmB;AACxC,eAAe,mBAAO,CAAC,GAAqB;;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACTA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://egg-born-module-a-detail/./backend/src/bean/bean.detail.js","webpack://egg-born-module-a-detail/./backend/src/bean/bean.detailAction.js","webpack://egg-born-module-a-detail/./backend/src/bean/bean.detailClass.js","webpack://egg-born-module-a-detail/./backend/src/bean/local.procedure.js","webpack://egg-born-module-a-detail/./backend/src/bean/version.manager.js","webpack://egg-born-module-a-detail/./backend/src/beans.js","webpack://egg-born-module-a-detail/./backend/src/common/detailBase.js","webpack://egg-born-module-a-detail/./backend/src/config/config.js","webpack://egg-born-module-a-detail/./backend/src/config/constants.js","webpack://egg-born-module-a-detail/./backend/src/config/errors.js","webpack://egg-born-module-a-detail/./backend/src/config/locale/en-us.js","webpack://egg-born-module-a-detail/./backend/src/config/locale/zh-cn.js","webpack://egg-born-module-a-detail/./backend/src/config/locales.js","webpack://egg-born-module-a-detail/./backend/src/config/static/layout/layoutDetailItemBase.js","webpack://egg-born-module-a-detail/./backend/src/config/static/layout/layoutDetailListBase.js","webpack://egg-born-module-a-detail/./backend/src/config/static/layouts.js","webpack://egg-born-module-a-detail/./backend/src/config/validation/schemas.js","webpack://egg-born-module-a-detail/./backend/src/controller/base.js","webpack://egg-born-module-a-detail/./backend/src/controller/detail.js","webpack://egg-born-module-a-detail/./backend/src/controllers.js","webpack://egg-born-module-a-detail/./backend/src/main.js","webpack://egg-born-module-a-detail/./backend/src/meta.js","webpack://egg-born-module-a-detail/./backend/src/model/detail.js","webpack://egg-born-module-a-detail/./backend/src/model/detailClass.js","webpack://egg-born-module-a-detail/./backend/src/models.js","webpack://egg-born-module-a-detail/./backend/src/routes.js","webpack://egg-born-module-a-detail/./backend/src/service/base.js","webpack://egg-born-module-a-detail/./backend/src/service/detail.js","webpack://egg-born-module-a-detail/./backend/src/services.js","webpack://egg-born-module-a-detail/external commonjs2 \"require3\"","webpack://egg-born-module-a-detail/webpack/bootstrap","webpack://egg-born-module-a-detail/webpack/before-startup","webpack://egg-born-module-a-detail/webpack/startup","webpack://egg-born-module-a-detail/webpack/after-startup"],"sourcesContent":["const require3 = require('require3');\nconst mparse = require3('egg-born-mparse').default;\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Detail extends ctx.app.meta.BeanModuleBase {\n    constructor(moduleName) {\n      super(ctx, 'detail');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get detailClass() {\n      return ctx.bean.detailClass.module(this.moduleName);\n    }\n\n    get modelDetail() {\n      return ctx.model.module(moduleInfo.relativeName).detail;\n    }\n\n    get sqlProcedure() {\n      return ctx.bean._getBean(moduleInfo.relativeName, 'local.procedure');\n    }\n\n    async getDetailClassId({ module, detailClassName }) {\n      const res = await this.detailClass.get({\n        module,\n        detailClassName,\n      });\n      return res.id;\n    }\n\n    async create({ atomKey, detailClass, item, user }) {\n      // detailClass\n      detailClass = await ctx.bean.detailClass.get(detailClass);\n      // item\n      item = item || {};\n      // detail bean\n      const _moduleInfo = mparse.parseInfo(detailClass.module);\n      const _detailClass = ctx.bean.detailClass.detailClass(detailClass);\n      const beanFullName = `${_moduleInfo.relativeName}.detail.${_detailClass.bean}`;\n      const res = await ctx.meta.util.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomKey, detailClass, item, user },\n        fn: 'create',\n      });\n      const { detailId, detailItemId } = res;\n      // save detailItemId\n      await this._update({\n        detail: { id: detailId, detailItemId },\n        user,\n      });\n      // ok: detailKey\n      return { detailId, detailItemId };\n    }\n\n    // read\n    async read({ key, options, user }) {\n      // detailClass\n      const detailClass = await ctx.bean.detailClass.getByDetailId({ detailId: key.detailId });\n      if (!detailClass) ctx.throw.module('a-base', 1002);\n      // detail bean\n      const _moduleInfo = mparse.parseInfo(detailClass.module);\n      const _detailClass = ctx.bean.detailClass.detailClass(detailClass);\n      const beanFullName = `${_moduleInfo.relativeName}.detail.${_detailClass.bean}`;\n      const item = await ctx.meta.util.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { detailClass, options, key, user },\n        fn: 'read',\n      });\n      // ok\n      return item;\n    }\n\n    // readByStaticKey\n    //   atomKey or atomStage must be set\n    async readByStaticKey({ atomKey, detailClass, detailStaticKey, atomStage }) {\n      const options = {\n        mode: 'full',\n        stage: atomStage,\n        where: {\n          'a.detailStaticKey': detailStaticKey,\n        },\n      };\n      const list = await this.select({ atomKey, detailClass, options });\n      return list[0];\n    }\n\n    async select({ atomKey, detailClass, options = {}, user, pageForce = false, count = 0 }) {\n      // detailClass\n      if (!detailClass) {\n        // use default detail\n        detailClass = await this.getDetailClassDefault({ atomId: atomKey.atomId });\n      }\n      detailClass = await ctx.bean.detailClass.get(detailClass);\n      const _detailClass = await ctx.bean.detailClass.detailClass(detailClass);\n\n      // tableName\n      const tableName = this._getTableName({ detailClass: _detailClass, mode: options.mode });\n      // 'where' should append atomClassId for safe\n      if (!options.where) options.where = {};\n      // atomKey maybe nulll\n      if (atomKey) {\n        options.where['a.atomId'] = atomKey.atomId;\n      }\n      options.where['a.detailClassId'] = detailClass.id;\n      // atomStage\n      if (options.stage === undefined) {\n        // atom\n        const atom = await ctx.bean.atom.modelAtom.get({ id: atomKey.atomId });\n        options.stage = atom.atomStage;\n      }\n      // orders\n      if (!options.orders || options.orders.length === 0) {\n        options.orders = [['a.detailLineNo', 'asc']];\n      }\n      // select\n      const items = await this._list({\n        tableName,\n        options,\n        user,\n        pageForce,\n        count,\n      });\n      // select items\n      if (!count) {\n        const _moduleInfo = mparse.parseInfo(detailClass.module);\n        const beanFullName = `${_moduleInfo.relativeName}.detail.${_detailClass.bean}`;\n        await ctx.meta.util.executeBean({\n          beanModule: _moduleInfo.relativeName,\n          beanFullName,\n          context: { atomKey, detailClass, options, items, user },\n          fn: 'select',\n        });\n      }\n      // ok\n      return items;\n    }\n\n    async count({ atomKey, detailClass, options, user }) {\n      return await this.select({ atomKey, detailClass, options, user, count: 1 });\n    }\n\n    // write\n    async write({ key, target, item, options, user }) {\n      // detailClass\n      const detailClass = await ctx.bean.detailClass.getByDetailId({ detailId: key.detailId });\n      if (!detailClass) ctx.throw.module('a-base', 1002);\n      if (!key.detailItemId) key.detailItemId = detailClass.detailItemId;\n      // detail bean\n      const _moduleInfo = mparse.parseInfo(detailClass.module);\n      const _detailClass = ctx.bean.detailClass.detailClass(detailClass);\n      const beanFullName = `${_moduleInfo.relativeName}.detail.${_detailClass.bean}`;\n      // item draft\n      const itemDraft = Object.assign({}, item, {\n        detailId: key.detailId,\n        detailItemId: key.detailItemId,\n        atomStage: ctx.constant.module('a-base').atom.stage.draft,\n      });\n      await ctx.meta.util.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { detailClass, target, key, item: itemDraft, options, user },\n        fn: 'write',\n      });\n    }\n\n    // delete\n    async delete({ key, target, user }) {\n      const detailClass = await ctx.bean.detailClass.getByDetailId({ detailId: key.detailId });\n      if (!detailClass) ctx.throw.module('a-base', 1002);\n      if (!key.detailItemId) key.detailItemId = detailClass.detailItemId;\n      // delete\n      await this._delete2({ detailClass, key, target, user });\n    }\n\n    async clone({ key, user }) {\n      const srcItem = await this.read({ key, options: null, user });\n      const srcKeyAtom = { atomId: srcItem.atomId };\n      const destKeyAtom = srcKeyAtom;\n      const keyDest = await this._copyDetail({\n        srcKey: key,\n        srcItem,\n        destKey: null,\n        detailClass: null,\n        atomClass: null,\n        target: 'clone',\n        srcKeyAtom,\n        destKeyAtom,\n        destAtom: null,\n        options: null,\n        user,\n      });\n      // ok\n      return keyDest;\n    }\n\n    async moveUp({ key, user }) {\n      return await this._moveLineNo({ key, user, direction: 'up' });\n    }\n\n    async moveDown({ key, user }) {\n      return await this._moveLineNo({ key, user, direction: 'down' });\n    }\n\n    async _moveLineNo({ key, user, direction }) {\n      // from\n      const detailFrom = await this.modelDetail.get({ id: key.detailId });\n      // sql\n      let sql;\n      if (direction === 'up') {\n        sql = `select a.id,a.detailLineNo from aDetail a\n          where a.iid=? and a.deleted=0 and a.atomId=? and a.detailClassId=? and a.detailLineNo<?\n          order by detailLineNo desc`;\n      } else {\n        sql = `select a.id,a.detailLineNo from aDetail a\n          where a.iid=? and a.deleted=0 and a.atomId=? and a.detailClassId=? and a.detailLineNo>?\n          order by detailLineNo asc`;\n      }\n      // to\n      const detailTo = await ctx.model.queryOne(sql, [\n        ctx.instance.id,\n        detailFrom.atomId,\n        detailFrom.detailClassId,\n        detailFrom.detailLineNo,\n      ]);\n      if (!detailTo) {\n        // do nothing\n        return null;\n      }\n      // switch\n      await this.modelDetail.update({ id: key.detailId, detailLineNo: detailTo.detailLineNo });\n      await this.modelDetail.update({ id: detailTo.id, detailLineNo: detailFrom.detailLineNo });\n      // ok\n      return {\n        from: key.detailId,\n        to: detailTo.id,\n      };\n    }\n\n    async _delete2({ detailClass, key, target, user }) {\n      // detail bean\n      const _moduleInfo = mparse.parseInfo(detailClass.module);\n      const _detailClass = ctx.bean.detailClass.detailClass(detailClass);\n      const beanFullName = `${_moduleInfo.relativeName}.detail.${_detailClass.bean}`;\n      // delete\n      await ctx.meta.util.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { detailClass, target, key, user },\n        fn: 'delete',\n      });\n    }\n\n    async schema({ detailClass, schema }) {\n      const validator = await this.validator({ detailClass });\n      if (!validator) return null;\n      return ctx.bean.validation.getSchema({ module: validator.module, validator: validator.validator, schema });\n    }\n\n    async validator({ detailClass: { id } }) {\n      const detailClass = await this.detailClass.get({ id });\n      return await this.detailClass.validator({ detailClass });\n    }\n\n    async getDetailClassDefault({ atomId }) {\n      // use default\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId });\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const detailDefault = _atomClass.details && _atomClass.details[0];\n      if (!detailDefault) return null;\n      return this._prepareDetailClassFromName({\n        atomClass,\n        detailClassName: detailDefault,\n      });\n    }\n\n    _prepareDetailClassFromName({ atomClass, detailClassName }) {\n      if (typeof detailClassName === 'string') {\n        return {\n          module: atomClass.module,\n          detailClassName,\n        };\n      }\n      return {\n        module: detailClassName.module || atomClass.module,\n        detailClassName: detailClassName.detailClassName,\n      };\n    }\n\n    async _loopDetailClasses({ atomClass, fn }) {\n      // all details of atom\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const detailClassNames = _atomClass.details;\n      if (!detailClassNames) return; // do nothing\n      // loop\n      for (const detailClassName of detailClassNames) {\n        let detailClass = this._prepareDetailClassFromName({ atomClass, detailClassName });\n        detailClass = await this.detailClass.get(detailClass);\n        await fn({ detailClass });\n      }\n    }\n\n    async _deleteDetails({ atomClass, atomKey, user }) {\n      await this._loopDetailClasses({\n        atomClass,\n        fn: async ({ detailClass }) => {\n          await this._deleteDetails_Class({ detailClass, atomClass, atomKey, user });\n        },\n      });\n    }\n\n    async _deleteDetails_Class({ detailClass, atomKey, user }) {\n      // details\n      const details = await this.modelDetail.select({\n        where: {\n          atomId: atomKey.atomId,\n          detailClassId: detailClass.id,\n        },\n      });\n      // loop\n      for (const detail of details) {\n        // delete\n        const key = { detailId: detail.id, detailItemId: detail.detailItemId };\n        await this._delete2({ detailClass, key, user });\n      }\n    }\n\n    async _copyDetails({ atomClass, target, srcKeyAtom, destKeyAtom, destAtom, options, user }) {\n      await this._loopDetailClasses({\n        atomClass,\n        fn: async ({ detailClass }) => {\n          await this._copyDetails_Class({\n            detailClass,\n            atomClass,\n            target,\n            srcKeyAtom,\n            destKeyAtom,\n            destAtom,\n            options,\n            user,\n          });\n        },\n      });\n    }\n\n    async _copyDetails_Class({ detailClass, atomClass, target, srcKeyAtom, destKeyAtom, destAtom, options, user }) {\n      // details dest\n      const detailsDest = await this.modelDetail.select({\n        where: {\n          atomId: destKeyAtom.atomId,\n          detailClassId: detailClass.id,\n        },\n      });\n      // details src\n      const detailsSrc = await this.select({\n        atomKey: { atomId: srcKeyAtom.atomId },\n        detailClass,\n        options: {\n          mode: 'full',\n        },\n        user,\n      });\n      // loop\n      for (const detailDest of detailsDest) {\n        const indexSrc = detailsSrc.findIndex(item => item.detailStaticKey === detailDest.detailStaticKey);\n        if (indexSrc === -1) {\n          // delete\n          const key = { detailId: detailDest.id, detailItemId: detailDest.detailItemId };\n          await this._delete2({ detailClass, key, target, user });\n        } else {\n          // write\n          const srcItem = detailsSrc[indexSrc];\n          const srcKey = { detailId: srcItem.detailId, detailItemId: srcItem.detailItemId };\n          const destKey = { detailId: detailDest.id, detailItemId: detailDest.detailItemId };\n          await this._copyDetail({\n            srcKey,\n            srcItem,\n            destKey,\n            detailClass,\n            atomClass,\n            target,\n            srcKeyAtom,\n            destKeyAtom,\n            destAtom,\n            options,\n            user,\n          });\n          // delete src\n          detailsSrc.splice(indexSrc, 1);\n        }\n      }\n      // append the remains\n      for (const srcItem of detailsSrc) {\n        const srcKey = { detailId: srcItem.detailId, detailItemId: srcItem.detailItemId };\n        await this._copyDetail({\n          srcKey,\n          srcItem,\n          detailClass,\n          atomClass,\n          target,\n          srcKeyAtom,\n          destKeyAtom,\n          destAtom,\n          options,\n          user,\n        });\n      }\n    }\n\n    // target: draft/formal/history/clone\n    async _copyDetail({\n      srcKey,\n      srcItem,\n      destKey,\n      detailClass,\n      atomClass,\n      target,\n      srcKeyAtom,\n      destKeyAtom,\n      destAtom,\n      options,\n      user,\n    }) {\n      // detailClass\n      if (!detailClass) {\n        detailClass = await ctx.bean.detailClass.getByDetailId({ detailId: srcKey.detailId });\n      }\n      // detail bean\n      const _moduleInfo = mparse.parseInfo(detailClass.module);\n      const _detailClass = ctx.bean.detailClass.detailClass(detailClass);\n      const beanFullName = `${_moduleInfo.relativeName}.detail.${_detailClass.bean}`;\n      // destKey\n      if (!destKey) {\n        destKey = await this.create({ atomKey: destKeyAtom, detailClass, item: null, user });\n      }\n      // atomStage\n      const atomStage = ctx.constant.module('a-base').atom.stage[target] || 0;\n      // detail\n      let userIdUpdated = srcItem.userIdUpdated;\n      let userIdCreated = srcItem.userIdCreated || userIdUpdated;\n      const detailCodeId = srcItem.detailCodeId;\n      const detailCode = srcItem.detailCode;\n      let detailName = srcItem.detailName;\n      const detailLineNo = srcItem.detailLineNo;\n      let detailStatic = srcItem.detailStatic;\n      let detailStaticKey = srcItem.detailStaticKey;\n      if (target === 'draft') {\n        userIdUpdated = user.id;\n      } else if (target === 'formal') {\n        // do nothing\n      } else if (target === 'history') {\n        // do nothing\n      } else if (target === 'clone') {\n        userIdUpdated = user.id;\n        userIdCreated = user.id;\n        if (srcKeyAtom.atomId === destKeyAtom.atomId) {\n          detailName = `${srcItem.detailName}-${ctx.text('CloneCopyText')}`;\n        } else {\n          detailName = srcItem.detailName;\n        }\n        detailStatic = 0;\n        if (detailStaticKey) {\n          detailStaticKey = ctx.bean.util.uuidv4();\n        }\n      }\n      // destItem\n      const destItem = Object.assign({}, srcItem, {\n        atomId: destKeyAtom.atomId,\n        atomStage,\n        detailId: destKey.detailId,\n        detailItemId: destKey.detailItemId,\n        userIdCreated,\n        userIdUpdated,\n        detailCodeId,\n        detailCode,\n        detailName,\n        detailLineNo,\n        detailStatic,\n        detailStaticKey,\n        createdAt: srcItem.atomCreatedAt,\n        updatedAt: srcItem.atomUpdatedAt,\n      });\n      // update fields\n      const params = {\n        id: destItem.detailId,\n        userIdCreated: destItem.userIdCreated,\n        userIdUpdated: destItem.userIdUpdated,\n        //   see also: detailBase\n        // detailCodeId: destItem.detailCodeId,\n        // detailCode: destItem.detailCode,\n        // detailName: destItem.detailName,\n        // detailStatic: destItem.detailStatic,\n        // detailStaticKey: destItem.detailStaticKey,\n        atomStage: destItem.atomStage,\n        createdAt: destItem.detailCreatedAt,\n        updatedAt: destItem.detailUpdatedAt,\n      };\n      if (target !== 'clone') {\n        params.detailLineNo = destItem.detailLineNo;\n      }\n      await this.modelDetail.update(params);\n      // detail write\n      await ctx.meta.util.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { detailClass, target, key: destKey, item: destItem, options, user },\n        fn: 'write',\n      });\n      // detail copy\n      await ctx.meta.util.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: {\n          detailClass,\n          target,\n          srcKey,\n          srcItem,\n          destKey,\n          destItem,\n          options,\n          user,\n          atomClass,\n          srcKeyAtom,\n          destKeyAtom,\n          destAtom,\n        },\n        fn: 'copy',\n      });\n      // ok\n      return destKey;\n    }\n\n    // detail\n\n    async _add({\n      atomKey,\n      detailClass: { id, detailClassName },\n      detail: { detailItemId, detailName, detailLineNo, detailStatic = 0, detailStaticKey = null },\n      user,\n    }) {\n      let detailClassId = id;\n      if (!detailClassId) detailClassId = await this.getDetailClassId({ detailClassName });\n      const res = await this.modelDetail.insert({\n        atomId: atomKey.atomId,\n        detailItemId,\n        detailClassId,\n        detailName,\n        detailLineNo,\n        detailStatic,\n        detailStaticKey,\n        userIdCreated: user.id,\n        userIdUpdated: user.id,\n      });\n      return res.insertId;\n    }\n\n    async _update({ detail /* , user,*/ }) {\n      await this.modelDetail.update(detail);\n    }\n\n    async _delete({ detail /* user,*/ }) {\n      // aDetail\n      await this.modelDetail.delete(detail);\n    }\n\n    async _get({ detailClass, options, key, mode /* , user*/ }) {\n      if (!options) options = {};\n      //\n      const _detailClass = await ctx.bean.detailClass.detailClass(detailClass);\n      const tableName = this._getTableName({ detailClass: _detailClass, mode });\n      const sql = this.sqlProcedure.getDetail({\n        iid: ctx.instance.id,\n        tableName,\n        detailId: key.detailId,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    async _list({ tableName, options: { where, orders, page, stage }, /* user,*/ pageForce = false, count = 0 }) {\n      page = ctx.bean.util.page(page, pageForce);\n      stage = typeof stage === 'number' ? stage : ctx.constant.module('a-base').atom.stage[stage];\n      const sql = this.sqlProcedure.selectDetails({\n        iid: ctx.instance.id,\n        tableName,\n        where,\n        orders,\n        page,\n        count,\n        stage,\n      });\n      const res = await ctx.model.query(sql);\n      return count ? res[0]._count : res;\n    }\n\n    _getTableName({ detailClass, mode }) {\n      const tableNameModes = detailClass.tableNameModes || {};\n      // not support search\n      // if (mode === 'search') {\n      //   return tableNameModes.search || tableNameModes.full || tableNameModes.default || detailClass.tableName;\n      // }\n      return tableNameModes[mode] || tableNameModes.default || detailClass.tableName;\n    }\n\n    // right\n\n    async actions({ flowTaskId, atomKey, detailClass, mode, user }) {\n      return await this._actions({ flowTaskId, atomKey, detailClass, mode, user, bulk: false });\n    }\n\n    async actionsBulk({ flowTaskId, atomKey, detailClass, mode, user }) {\n      return await this._actions({ flowTaskId, atomKey, detailClass, mode, user, bulk: true });\n    }\n\n    async _actions({ flowTaskId, atomKey, detailClass, mode, user, bulk }) {\n      // atom\n      const atomId = atomKey.atomId;\n      const atom = await ctx.bean.atom.modelAtom.get({ id: atomId });\n      // actionsAll\n      let actionsAll = ctx.bean.detailAction.actions();\n      actionsAll = actionsAll[detailClass.module][detailClass.detailClassName];\n      // actions of mode\n      let _actions = [];\n      for (const name in actionsAll) {\n        const action = actionsAll[name];\n        if (action.authorize === false) continue;\n        if (!!action.bulk === bulk && (!action.mode || action.mode === mode)) {\n          _actions.push(action);\n        }\n      }\n      // sort\n      _actions = _actions.sort((a, b) => a.code - b.code);\n      // inherit: read/others\n      const res = [];\n      const rights = [];\n      for (const actionBase of _actions) {\n        let right = rights[actionBase.inherit];\n        if (right === undefined) {\n          if (actionBase.inherit === 'read') {\n            right = await this._checkRightRead({ flowTaskId, detailClass, atomId, atom, actionBase, user });\n          } else {\n            right = await this._checkRightAction({ flowTaskId, detailClass, atomId, atom, actionBase, user });\n          }\n          rights[actionBase.inherit] = right;\n        }\n        if (right) {\n          res.push({\n            ...actionBase,\n            module: detailClass.module,\n            detailClassName: detailClass.detailClassName,\n          });\n        }\n      }\n      // ok\n      return res;\n    }\n\n    _checkSchemaValid({ schema, detailClass }) {\n      for (const key in schema.properties) {\n        const property = schema.properties[key];\n        if (\n          property.ebType === 'details' &&\n          property.ebParams.detailClass.module === detailClass.module &&\n          property.ebParams.detailClass.detailClassName === detailClass.detailClassName\n        ) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    async _checkRightRead({ flowTaskId, detailClass, atomId, atom, actionBase, user }) {\n      // special check for stage\n      if (actionBase.stage) {\n        const stages = actionBase.stage.split(',');\n        if (!stages.some(item => ctx.constant.module('a-base').atom.stage[item] === atom.atomStage)) return false;\n      }\n      // special check for flow\n      if (atom.atomStage === 0 && atom.atomFlowId > 0 && flowTaskId) {\n        const viewAtom = await ctx.bean.flowTask.viewAtom({ flowTaskId, user });\n        if (!viewAtom) return false;\n        if (viewAtom.item.atomId !== atomId) return false;\n        if (this._checkSchemaValid({ schema: viewAtom.schema.schema, detailClass })) return true;\n        // default is false\n        return false;\n      }\n      // atom read\n      return !!(await ctx.bean.atom.checkRightRead({\n        atom: { id: atomId },\n        user,\n        checkFlow: false,\n      }));\n    }\n\n    async _checkRightAction({ flowTaskId, detailClass, atomId, atom, actionBase, user }) {\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.get({ id: atom.atomClassId });\n      const atomActionBase = ctx.bean.base.action({\n        module: atomClass.module,\n        atomClassName: atomClass.atomClassName,\n        name: actionBase.inherit,\n      });\n      // special check for stage\n      if (actionBase.stage) {\n        const stages = actionBase.stage.split(',');\n        if (!stages.some(item => ctx.constant.module('a-base').atom.stage[item] === atom.atomStage)) return false;\n      }\n      // special check write for flow\n      if (actionBase.inherit === 'write') {\n        if (atom.atomStage === 0 && atom.atomFlowId > 0 && flowTaskId) {\n          const editAtom = await ctx.bean.flowTask.editAtom({ flowTaskId, user });\n          if (!editAtom) return false;\n          if (editAtom.item.atomId !== atomId) return false;\n          if (this._checkSchemaValid({ schema: editAtom.schema.schema, detailClass })) return true;\n          // default is false\n          return false;\n        }\n      }\n      // atom action\n      return !!(await ctx.bean.atom.checkRightAction({\n        atom: { id: atomId },\n        action: atomActionBase.code,\n        // need not set stage\n        // stage,\n        user,\n        checkFlow: false,\n      }));\n    }\n\n    async _checkRight({ flowTaskId, atomId, detailClass, action, user }) {\n      // detailClass\n      if (!detailClass) {\n        // use default detail\n        detailClass = await this.getDetailClassDefault({ atomId });\n      }\n      // parse action code\n      action = ctx.bean.detailAction.parseActionCode({\n        action,\n        detailClass,\n      });\n      // actionBase\n      const actionBase = ctx.bean.detailAction.action({\n        module: detailClass.module,\n        detailClassName: detailClass.detailClassName,\n        code: action,\n      });\n      // atom\n      const atom = await ctx.bean.atom.modelAtom.get({ id: atomId });\n      // inherit\n      const inherit = actionBase.inherit;\n      // read\n      if (inherit === 'read') {\n        return await this._checkRightRead({ flowTaskId, detailClass, atomId, atom, actionBase, user });\n      }\n      // write or others\n      return await this._checkRightAction({ flowTaskId, detailClass, atomId, atom, actionBase, user });\n    }\n\n    // right\n    async _checkRightForMiddleware({ options }) {\n      const action = options.action;\n      // atomId/detailClass\n      let atomId;\n      let detailClass;\n      // check key first\n      const key = ctx.request.body.key;\n      if (key) {\n        const detailId = key.detailId;\n        const detail = await this.modelDetail.get({ id: detailId });\n        if (!detail) ctx.throw(403);\n        atomId = detail.atomId;\n        // detailClass\n        detailClass = await ctx.bean.detailClass.getByDetailId({ detailId });\n        if (!detailClass) ctx.throw.module('a-base', 1002);\n        // for safe\n        if (ctx.request.body.atomKey) {\n          ctx.request.body.atomKey = { atomId };\n        }\n        if (ctx.request.body.detailClass) {\n          ctx.request.body.detailClass = detailClass;\n        }\n      } else {\n        // atomKey must be set\n        atomId = ctx.request.body.atomKey && ctx.request.body.atomKey.atomId;\n        if (!atomId) ctx.throw(403);\n        // detailClass maybe empty\n        detailClass = ctx.request.body.detailClass;\n        if (!detailClass) {\n          // use default detail\n          detailClass = await this.getDetailClassDefault({ atomId });\n        }\n      }\n      // _checkdetailClassExpect\n      await _checkDetailClassExpect({ detailClass, options, ctx });\n      // flowTaskId\n      const flowTaskId = ctx.request.body.flowTaskId;\n      // check\n      const res = await this._checkRight({\n        flowTaskId,\n        atomId,\n        detailClass,\n        action,\n        user: ctx.state.user.op,\n      });\n      if (!res) ctx.throw(403);\n    }\n  }\n\n  return Detail;\n};\n\nfunction _parseDetailClass(detailClass) {\n  if (!detailClass) return detailClass;\n  if (typeof detailClass === 'string') {\n    const [module, detailClassName] = detailClass.split(':');\n    return { module, detailClassName };\n  }\n  return detailClass;\n}\n\nfunction _checkIfSameDetailClass(detailClassA, detailClassB) {\n  return detailClassA.module === detailClassB.module && detailClassA.detailClassName === detailClassB.detailClassName;\n}\n\nasync function _checkDetailClassExpect({ detailClass, options, ctx }) {\n  // detailClassExpect\n  const detailClassExpect = _parseDetailClass(options.detailClass);\n  //\n  if (!detailClass && !detailClassExpect) ctx.throw(403);\n  if (detailClass && detailClassExpect && !_checkIfSameDetailClass(detailClass, detailClassExpect)) {\n    ctx.throw(403);\n  }\n}\n","const _actions = {};\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class DetailAction extends ctx.app.meta.BeanModuleBase {\n    constructor(moduleName) {\n      super(ctx, 'detailAction');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    actions() {\n      if (!_actions[ctx.locale]) {\n        _actions[ctx.locale] = this._prepareActions();\n      }\n      return _actions[ctx.locale];\n    }\n\n    action({ module, detailClassName, code, name }) {\n      const _actions = this.actions();\n      const actions = _actions[module][detailClassName];\n      if (name) return actions[name];\n      const key = Object.keys(actions).find(key => actions[key].code === code);\n      return actions[key];\n    }\n\n    parseActionCode({ action, detailClass }) {\n      // is number\n      if (!isNaN(action)) return parseInt(action);\n      // add role right\n      const actionCode = ctx.constant.module('a-detail').detail.action[action];\n      if (actionCode) return actionCode;\n      // detailClass\n      if (!detailClass) throw new Error(`should specify the detailClass of action: ${action}`);\n      const actions = this.actions();\n      const _action = actions[detailClass.module][detailClass.detailClassName][action];\n      if (!_action) {\n        throw new Error(`detail action not found: ${detailClass.module}:${detailClass.detailClassName}.${action}`);\n      }\n      return _action.code;\n    }\n\n    _prepareActions() {\n      const actions = {};\n      for (const relativeName in ctx.app.meta.modules) {\n        const module = ctx.app.meta.modules[relativeName];\n        const details = ctx.bean.util.getProperty(module, 'main.meta.detail.details');\n        if (details) {\n          const res = {};\n          for (const detailClassName in details) {\n            const res2 = this._prepareActionsDetailClass(module, details[detailClassName]);\n            if (Object.keys(res2).length > 0) {\n              res[detailClassName] = res2;\n            }\n          }\n          if (Object.keys(res).length > 0) {\n            actions[relativeName] = res;\n          }\n        }\n      }\n      return actions;\n    }\n\n    _prepareActionsDetailClass(module, detailClass) {\n      const actions = {};\n      const _actions = detailClass.actions;\n      const _actionsSystem = ctx.constant.module(moduleInfo.relativeName).detail.action;\n      const _actionsSystemMeta = ctx.constant.module(moduleInfo.relativeName).detail.actionMeta;\n      const _actionsAll = ctx.bean.util.extend({}, _actionsSystemMeta, _actions);\n      for (const key in _actionsAll) {\n        if (key === 'custom') continue;\n        const action = _actionsAll[key];\n        if (!action.code) action.code = _actionsSystem[key];\n        action.name = key;\n        action.titleLocale = ctx.text(action.title);\n        actions[key] = action;\n      }\n      return actions;\n    }\n  }\n\n  return DetailAction;\n};\n","const _detailClasses = {};\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class DetailClass extends ctx.app.meta.BeanModuleBase {\n    constructor(moduleName) {\n      super(ctx, 'detailClass');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get model() {\n      return ctx.model.module(moduleInfo.relativeName).detailClass;\n    }\n\n    detailClasses() {\n      if (!_detailClasses[ctx.locale]) {\n        _detailClasses[ctx.locale] = this._prepareDetailClasses();\n      }\n      return _detailClasses[ctx.locale];\n    }\n\n    detailClass({ module, detailClassName }) {\n      const _detailClasses = this.detailClasses();\n      return _detailClasses[module] && _detailClasses[module][detailClassName];\n    }\n\n    async get({ id, module, detailClassName }) {\n      module = module || this.moduleName;\n      const data = id ? { id } : { module, detailClassName };\n      const res = await this.model.get(data);\n      if (res) return res;\n      if (!module || !detailClassName) ctx.throw.module('a-base', 1011);\n      // lock\n      return await ctx.meta.util.lock({\n        resource: `${moduleInfo.relativeName}.detailClass.register`,\n        fn: async () => {\n          return await ctx.meta.util.executeBeanIsolate({\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'detailClass',\n            context: { module, detailClassName },\n            fn: '_registerLock',\n          });\n        },\n      });\n    }\n\n    async _registerLock({ module, detailClassName }) {\n      // get\n      const res = await this.model.get({ module, detailClassName });\n      if (res) return res;\n      // data\n      const atomClass = this.detailClass({ module, detailClassName });\n      if (!atomClass) throw new Error(`detailClass ${module}:${detailClassName} not found!`);\n      const data = {\n        module,\n        detailClassName,\n      };\n      // insert\n      const res2 = await this.model.insert(data);\n      data.id = res2.insertId;\n      return data;\n    }\n\n    async getByDetailId({ detailId }) {\n      const res = await this.model.query(\n        `\n        select a.*,b.id as detailId,b.detailItemId from aDetailClass a\n          left join aDetail b on a.id=b.detailClassId\n            where b.iid=? and b.id=?\n        `,\n        [ctx.instance.id, detailId]\n      );\n      return res[0];\n    }\n\n    async validator({ detailClass }) {\n      // default\n      const _module = ctx.app.meta.modules[detailClass.module];\n      const validator = _module.main.meta.detail.details[detailClass.detailClassName].validator;\n      if (!validator) return null;\n      return {\n        module: detailClass.module,\n        validator,\n      };\n    }\n\n    _prepareDetailClasses() {\n      const detailClasses = {};\n      for (const relativeName in ctx.app.meta.modules) {\n        const module = ctx.app.meta.modules[relativeName];\n        const details = ctx.bean.util.getProperty(module, 'main.meta.detail.details');\n        if (details) {\n          const res = this._prepareDetailClassesModule(module, details);\n          if (Object.keys(res).length > 0) {\n            detailClasses[relativeName] = res;\n          }\n        }\n      }\n      return detailClasses;\n    }\n\n    _prepareDetailClassesModule(module, _details) {\n      const detailClasses = {};\n      for (const key in _details) {\n        // info\n        const detailClass = {\n          name: key,\n          ..._details[key].info,\n        };\n        // titleLocale\n        detailClass.titleLocale = ctx.text(detailClass.title);\n        // ok\n        detailClasses[key] = detailClass;\n      }\n      return detailClasses;\n    }\n  }\n\n  return DetailClass;\n};\n","module.exports = ctx => {\n  class Procedure {\n    selectDetails({ iid, tableName, where, orders, page, count, stage }) {\n      // -- tables\n      // -- a: aDetail\n      // -- b: aDetailClass\n      // -- f: {item}\n      // -- g: aUser\n      // -- g2: aUser\n\n      iid = parseInt(iid);\n      stage = parseInt(stage);\n\n      // for safe\n      tableName = tableName ? ctx.model.format('??', tableName) : null;\n      where = where ? ctx.model._where(where) : null;\n      orders = orders ? ctx.model._orders(orders) : null;\n      const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n      // vars\n      let _itemField, _itemJoin;\n\n      //\n      const _where = where ? `${where} AND` : ' WHERE';\n      const _orders = orders || '';\n      const _limit = limit || '';\n\n      // tableName\n      if (tableName) {\n        _itemField = 'f.*,';\n        _itemJoin = ` inner join ${tableName} f on f.detailId=a.id`;\n      } else {\n        _itemField = '';\n        _itemJoin = '';\n      }\n\n      // fields\n      let _selectFields;\n      if (count) {\n        _selectFields = 'count(*) as _count';\n      } else {\n        _selectFields = `${_itemField}\n                a.id as detailId,a.atomId,a.atomStage,a.detailItemId,a.detailClassId,\n                a.detailCodeId,a.detailCode,a.detailName,a.detailLineNo,\n                a.detailStatic,a.detailStaticKey,\n                a.userIdCreated,a.userIdUpdated,a.createdAt as detailCreatedAt,a.updatedAt as detailUpdatedAt,\n                b.module,b.detailClassName,\n                g.userName,g.avatar,\n                g2.userName as userNameUpdated,g2.avatar as avatarUpdated\n                `;\n      }\n\n      // sql\n      const _sql = `select ${_selectFields} from aDetail a\n            inner join aDetailClass b on a.detailClassId=b.id\n            left join aUser g on a.userIdCreated=g.id\n            left join aUser g2 on a.userIdUpdated=g2.id\n            ${_itemJoin}\n\n          ${_where}\n           (\n             a.deleted=0 and a.iid=${iid} and a.atomStage=${stage}\n           )\n\n          ${count ? '' : _orders}\n          ${count ? '' : _limit}\n        `;\n\n      // ok\n      return _sql;\n    }\n\n    getDetail({ iid, tableName, detailId }) {\n      // -- tables\n      // -- a: aDetail\n      // -- b: aDetailClass\n      // -- f: {item}\n      // -- g: aUser\n      // -- g2: aUser\n\n      // for safe\n      tableName = tableName ? ctx.model.format('??', tableName) : null;\n\n      iid = parseInt(iid);\n      detailId = parseInt(detailId);\n\n      // vars\n      let _itemField, _itemJoin;\n\n      // tableName\n      if (tableName) {\n        _itemField = 'f.*,';\n        _itemJoin = ` inner join ${tableName} f on f.detailId=a.id`;\n      } else {\n        _itemField = '';\n        _itemJoin = '';\n      }\n\n      // sql\n      const _sql = `select ${_itemField}\n                a.id as detailId,a.atomId,a.atomStage,a.detailItemId,a.detailClassId,\n                a.detailCodeId,a.detailCode,a.detailName,a.detailLineNo,\n                a.detailStatic,a.detailStaticKey,\n                a.userIdCreated,a.userIdUpdated,a.createdAt as detailCreatedAt,a.updatedAt as detailUpdatedAt,\n                b.module,b.detailClassName,\n                g.userName,g.avatar,\n                g2.userName as userNameUpdated,g2.avatar as avatarUpdated\n          from aDetail a\n\n            inner join aDetailClass b on a.detailClassId=b.id\n            left join aUser g on a.userIdCreated=g.id\n            left join aUser g2 on a.userIdUpdated=g2.id\n            ${_itemJoin}\n\n          where a.id=${detailId}\n            and a.deleted=0 and a.iid=${iid}\n        `;\n\n      // ok\n      return _sql;\n    }\n  }\n\n  return Procedure;\n};\n","module.exports = app => {\n  class Version extends app.meta.BeanBase {\n    async update(options) {\n      if (options.version === 1) {\n        // create table: aDetail\n        let sql = `\n          CREATE TABLE aDetail (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            atomStage int(11) DEFAULT '0',\n            detailItemId int(11) DEFAULT '0',\n            detailClassId int(11) DEFAULT '0',\n            detailCodeId int(11) DEFAULT '0',\n            detailCode varchar(255) DEFAULT NULL,\n            detailName varchar(255) DEFAULT NULL,\n            detailLineNo int(11) DEFAULT '0',\n            detailStatic int(11) DEFAULT '0',\n            detailStaticKey varchar(255) DEFAULT NULL,\n            userIdCreated int(11) DEFAULT '0',\n            userIdUpdated int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aDetailClass\n        sql = `\n          CREATE TABLE aDetailClass (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            module varchar(255) DEFAULT NULL,\n            detailClassName varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n      }\n    }\n\n    async init(options) {}\n\n    async test() {}\n  }\n\n  return Version;\n};\n","const versionManager = require('./bean/version.manager.js');\nconst localProcedure = require('./bean/local.procedure.js');\nconst beanDetail = require('./bean/bean.detail.js');\nconst beanDetailClass = require('./bean/bean.detailClass.js');\nconst beanDetailAction = require('./bean/bean.detailAction.js');\n\nmodule.exports = app => {\n  const beans = {\n    // version\n    'version.manager': {\n      mode: 'app',\n      bean: versionManager,\n    },\n    // local\n    'local.procedure': {\n      mode: 'ctx',\n      bean: localProcedure,\n    },\n    // global\n    detail: {\n      mode: 'ctx',\n      bean: beanDetail,\n      global: true,\n    },\n    detailClass: {\n      mode: 'ctx',\n      bean: beanDetailClass,\n      global: true,\n    },\n    detailAction: {\n      mode: 'ctx',\n      bean: beanDetailAction,\n      global: true,\n    },\n  };\n  return beans;\n};\n","// detailLineNo will be changed by other way\nconst __detailBasicFields = ['detailCodeId', 'detailCode', 'detailName', 'detailStatic', 'detailStaticKey'];\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class DetailBase extends app.meta.BeanBase {\n    async create({ atomKey, detailClass, item, user }) {\n      // detailName\n      if (!item.detailName) {\n        // draftId\n        const sequence = this.ctx.bean.sequence.module(moduleInfo.relativeName);\n        const uniqueId = await sequence.next('detail');\n        item.detailName = `${this.ctx.text('Detail')}-${uniqueId}`;\n      }\n      // detailStaticKey\n      if (!item.detailStaticKey) {\n        item.detailStaticKey = this.ctx.bean.util.uuidv4();\n      }\n      // detailLineNo\n      item.detailLineNo = await this._createLineNo({ atomKey, detailClass });\n      // add\n      const detailId = await this.ctx.bean.detail._add({ atomKey, detailClass, detail: item, user });\n      return { detailId };\n    }\n\n    async read({ detailClass, options, key, user }) {\n      // get\n      return await this.ctx.bean.detail._get({ detailClass, options, key, mode: 'full', user });\n    }\n\n    async select(/* {  atomKey, detailClass, options, items, user }*/) {\n      // donothing\n    }\n\n    async delete({ /* detailClass, target, */ key, user }) {\n      // delete\n      await this.ctx.bean.detail._delete({\n        detail: { id: key.detailId },\n        user,\n      });\n    }\n\n    async write({ detailClass, target, key, item, options, user }) {\n      if (!item) return;\n      // stage\n      const atomStage = item.atomStage;\n      // validate\n      const ignoreValidate = options && options.ignoreValidate;\n      if (atomStage === 0 && !target && !ignoreValidate) {\n        this.ctx.bean.util.setProperty(this.ctx, 'meta.validateHost', {\n          detailClass,\n          key,\n        });\n        await this.ctx.bean.validation._validate({ detailClass, data: item, options, filterOptions: true });\n        this.ctx.bean.util.setProperty(this.ctx, 'meta.validateHost', null);\n      }\n      // write detail\n      await this._writeDetail({ key, item, user, atomStage });\n    }\n\n    async _writeDetail({ key, item, user, atomStage }) {\n      // write detail\n      const detail = {};\n      for (const field of __detailBasicFields) {\n        if (item[field] !== undefined) detail[field] = item[field];\n      }\n      if (atomStage === 0) {\n        detail.updatedAt = new Date();\n      }\n      // update\n      detail.id = key.detailId;\n      await this.ctx.bean.detail._update({ detail, user });\n    }\n\n    async copy(/* {\n      detailClass, target, srcKey, srcItem, destKey, destItem, options, user,\n      atomClass, srcKeyAtom, destKeyAtom, destAtom,\n    }*/) {\n      // do nothing\n    }\n\n    async _createLineNo({ atomKey, detailClass }) {\n      // need not check atomStage\n      const res = await this.ctx.model.queryOne(\n        `\n        select max(a.detailLineNo) as detailLineNo from aDetail a\n          where a.iid=? and a.deleted=0 and a.atomId=? and a.detailClassId=?\n        `,\n        [this.ctx.instance.id, atomKey.atomId, detailClass.id]\n      );\n      const detailLineNo = res.detailLineNo;\n      return detailLineNo ? detailLineNo + 1 : 1;\n    }\n\n    _ensureItemMeta(item) {\n      if (!item) return null;\n      if (!item._meta) item._meta = {};\n      if (!item._meta.flags) item._meta.flags = [];\n      return item._meta;\n    }\n  }\n  return DetailBase;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {};\n\n  // middlewares\n  config.middlewares = {};\n\n  return config;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  return {\n    detail: {\n      action: {\n        create: 1,\n        read: 2,\n        write: 3,\n        delete: 4,\n        clone: 5,\n        moveUp: 6,\n        moveDown: 7,\n\n        save: 51,\n\n        custom: 100, // custom action start from custom\n      },\n      actionMeta: {\n        create: {\n          title: 'Create',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          bulk: true,\n          icon: { f7: '::add' },\n          inherit: 'write',\n          mode: 'edit',\n          stage: 'draft',\n        },\n        read: {\n          title: 'View',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          icon: { f7: '::visibility' },\n          inherit: 'read',\n          mode: 'view',\n          stage: '',\n        },\n        write: {\n          title: 'Edit',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          icon: { f7: '::edit' },\n          inherit: 'write',\n          mode: 'edit',\n          stage: 'draft',\n          directShowOnSwipeout: true,\n          directShowOnList: true,\n        },\n        delete: {\n          title: 'Delete',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          icon: { f7: '::delete' },\n          inherit: 'write',\n          mode: 'edit',\n          stage: 'draft',\n          directShowOnSwipeout: true,\n          directShowOnList: true,\n        },\n        clone: {\n          title: 'Clone',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          icon: { f7: ':outline:copy-outline' },\n          inherit: 'write',\n          mode: 'edit',\n          stage: 'draft',\n        },\n        moveUp: {\n          title: 'Move Up',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          icon: { f7: '::arrow-up' },\n          inherit: 'write',\n          mode: 'edit',\n          stage: 'draft',\n          directShowOnList: true,\n          disableOnItem: true,\n        },\n        moveDown: {\n          title: 'Move Down',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          icon: { f7: '::arrow-down' },\n          inherit: 'write',\n          mode: 'edit',\n          stage: 'draft',\n          directShowOnList: true,\n          disableOnItem: true,\n        },\n        save: {\n          title: 'Save',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          authorize: false,\n          icon: { f7: '::save' },\n          inherit: 'write',\n          mode: 'edit',\n          stage: 'draft',\n        },\n        custom: {\n          title: 'Custom',\n        },\n      },\n    },\n  };\n};\n","// error code should start from 1001\nmodule.exports = {};\n","module.exports = {};\n","module.exports = {};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const content = {\n    info: {\n      layout: {\n        viewSize: {\n          view: {\n            small: 'default',\n            medium: 'default',\n            large: 'default',\n          },\n          edit: {\n            small: 'default',\n            medium: 'default',\n            large: 'default',\n          },\n        },\n      },\n    },\n    layouts: {\n      base: {\n        blocks: {},\n      },\n      default: {\n        subnavbar: false,\n      },\n    },\n  };\n  const layout = {\n    atomName: 'Base',\n    atomStaticKey: 'layoutDetailItemBase',\n    atomRevision: 1,\n    description: '',\n    layoutTypeCode: 6,\n    content: JSON.stringify(content),\n    resourceRoles: 'root',\n  };\n  return layout;\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const content = {\n    info: {\n      layout: {\n        viewSize: {\n          small: 'list',\n          medium: 'table',\n          large: 'table',\n        },\n      },\n    },\n    layouts: {\n      base: {\n        blocks: {\n          title: {\n            component: {\n              module: 'a-detail',\n              name: 'listLayoutBlockListTitle',\n            },\n          },\n        },\n      },\n      list: {\n        title: 'LayoutList',\n        component: {\n          module: 'a-detail',\n          name: 'listLayoutList',\n        },\n        blocks: {\n          items: {\n            component: {\n              module: 'a-detail',\n              name: 'listLayoutBlockListItems',\n            },\n          },\n        },\n      },\n      table: {\n        title: 'LayoutTable',\n        component: {\n          module: 'a-detail',\n          name: 'listLayoutTable',\n        },\n        blocks: {\n          items: {\n            component: {\n              module: 'a-baselayout',\n              name: 'baseLayoutBlockTableItems',\n            },\n            enableTableHeight: false,\n            sorter: false,\n            columns: [\n              {\n                dataIndex: 'detailLineNo',\n                title: '#',\n                align: 'center',\n                width: 50,\n                component: {\n                  module: 'a-detail',\n                  name: 'listLayoutTableCellDetailLineNo',\n                },\n              },\n              {\n                dataIndex: 'detailName',\n                title: 'Name',\n                align: 'left',\n                component: {\n                  module: 'a-detail',\n                  name: 'listLayoutTableCellDetailName',\n                },\n              },\n            ],\n          },\n        },\n      },\n    },\n  };\n  const layout = {\n    atomName: 'Base',\n    atomStaticKey: 'layoutDetailListBase',\n    atomRevision: 1,\n    description: '',\n    layoutTypeCode: 5,\n    content: JSON.stringify(content),\n    resourceRoles: 'root',\n  };\n  return layout;\n};\n","const layoutDetailItemBase = require('./layout/layoutDetailItemBase.js');\nconst layoutDetailListBase = require('./layout/layoutDetailListBase.js');\n\nmodule.exports = app => {\n  const layouts = [layoutDetailItemBase(app), layoutDetailListBase(app)];\n  return layouts;\n};\n","module.exports = app => {\n  const schemas = {};\n  return schemas;\n};\n","module.exports = app => {\n  class BaseController extends app.Controller {\n    detailClasses() {\n      const res = this.ctx.service.base.detailClasses();\n      this.ctx.success(res);\n    }\n\n    actions() {\n      const res = this.ctx.service.base.actions();\n      this.ctx.success(res);\n    }\n  }\n\n  return BaseController;\n};\n","module.exports = app => {\n  class DetailController extends app.Controller {\n    async create() {\n      const res = await this.ctx.service.detail.create({\n        atomKey: this.ctx.request.body.atomKey,\n        detailClass: this.ctx.request.body.detailClass,\n        item: this.ctx.request.body.item,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async read() {\n      const res = await this.ctx.service.detail.read({\n        key: this.ctx.request.body.key,\n        options: this.ctx.request.body.options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    // options\n    //   where, orders, page, star, label\n    async select() {\n      const options = this.ctx.request.body.options || {};\n      options.page = this.ctx.bean.util.page(options.page, false); // false\n      const items = await this.ctx.service.detail.select({\n        atomKey: this.ctx.request.body.atomKey,\n        detailClass: this.ctx.request.body.detailClass,\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.successMore(items, options.page.index, options.page.size);\n    }\n\n    async count() {\n      const options = this.ctx.request.body.options || {};\n      const count = await this.ctx.service.detail.count({\n        atomKey: this.ctx.request.body.atomKey,\n        detailClass: this.ctx.request.body.detailClass,\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(count);\n    }\n\n    async write() {\n      const options = { ignoreValidate: false };\n      await this.ctx.service.detail.write({\n        key: this.ctx.request.body.key,\n        item: this.ctx.request.body.item,\n        user: this.ctx.state.user.op,\n        options,\n      });\n      this.ctx.success();\n    }\n\n    async delete() {\n      await this.ctx.service.detail.delete({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success();\n    }\n\n    async clone() {\n      const res = await this.ctx.service.detail.clone({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async moveUp() {\n      const res = await this.ctx.service.detail.moveUp({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async moveDown() {\n      const res = await this.ctx.service.detail.moveDown({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async actions() {\n      const res = await this.ctx.service.detail.actions({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        atomKey: this.ctx.request.body.atomKey,\n        detailClass: this.ctx.request.body.detailClass,\n        mode: this.ctx.request.body.mode,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async actionsBulk() {\n      const res = await this.ctx.service.detail.actionsBulk({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        atomKey: this.ctx.request.body.atomKey,\n        detailClass: this.ctx.request.body.detailClass,\n        mode: this.ctx.request.body.mode,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async validator() {\n      const res = await this.ctx.service.detail.validator({\n        detailClass: this.ctx.request.body.detailClass,\n      });\n      this.ctx.success(res);\n    }\n  }\n  return DetailController;\n};\n","const base = require('./controller/base.js');\nconst detail = require('./controller/detail.js');\n\nmodule.exports = app => {\n  const controllers = {\n    base,\n    detail,\n  };\n  return controllers;\n};\n","const config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\nconst DetailBaseFn = require('./common/detailBase.js');\n\nmodule.exports = app => {\n  // detailBase\n  app.meta.DetailBase = DetailBaseFn(app);\n\n  // beans\n  const beans = require('./beans.js')(app);\n  // routes\n  const routes = require('./routes.js')(app);\n  // controllers\n  const controllers = require('./controllers.js')(app);\n  // services\n  const services = require('./services.js')(app);\n  // models\n  const models = require('./models.js')(app);\n  // constants\n  const constants = require('./config/constants.js')(app);\n  // meta\n  const meta = require('./meta.js')(app);\n\n  return {\n    beans,\n    routes,\n    controllers,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    constants,\n    meta,\n  };\n};\n","module.exports = app => {\n  const schemas = require('./config/validation/schemas.js')(app);\n  const staticLayouts = require('./config/static/layouts.js')(app);\n  const meta = {\n    base: {\n      atoms: {},\n      statics: {\n        'a-baselayout.layout': {\n          items: staticLayouts,\n        },\n      },\n    },\n    sequence: {\n      providers: {\n        detail: {\n          bean: {\n            module: 'a-sequence',\n            name: 'simple',\n          },\n          start: 0,\n        },\n      },\n    },\n    validation: {\n      validators: {},\n      keywords: {},\n      schemas,\n    },\n  };\n  return meta;\n};\n","module.exports = app => {\n  class Detail extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDetail', options: { disableDeleted: false } });\n    }\n  }\n\n  return Detail;\n};\n","module.exports = app => {\n  class DetailClass extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDetailClass', options: { disableDeleted: false } });\n    }\n  }\n\n  return DetailClass;\n};\n","const detail = require('./model/detail.js');\nconst detailClass = require('./model/detailClass.js');\n\nmodule.exports = app => {\n  const models = {\n    detail,\n    detailClass,\n  };\n  return models;\n};\n","module.exports = app => {\n  const routes = [\n    // base\n    { method: 'post', path: 'base/detailClasses', controller: 'base' },\n    { method: 'post', path: 'base/actions', controller: 'base' },\n    // detail\n    {\n      method: 'post',\n      path: 'detail/create',\n      controller: 'detail',\n      middlewares: 'transaction',\n      meta: { right: { type: 'detail', action: 'create' } },\n    },\n    { method: 'post', path: 'detail/read', controller: 'detail', meta: { right: { type: 'detail', action: 'read' } } },\n    {\n      method: 'post',\n      path: 'detail/select',\n      controller: 'detail',\n      meta: { right: { type: 'detail', action: 'read' } },\n    },\n    { method: 'post', path: 'detail/count', controller: 'detail', meta: { right: { type: 'detail', action: 'read' } } },\n    {\n      method: 'post',\n      path: 'detail/write',\n      controller: 'detail',\n      middlewares: 'transaction',\n      meta: { right: { type: 'detail', action: 'write' } },\n    },\n    {\n      method: 'post',\n      path: 'detail/delete',\n      controller: 'detail',\n      middlewares: 'transaction',\n      meta: { right: { type: 'detail', action: 'delete' } },\n    },\n    {\n      method: 'post',\n      path: 'detail/clone',\n      controller: 'detail',\n      middlewares: 'transaction',\n      meta: { right: { type: 'detail', action: 'clone' } },\n    },\n    {\n      method: 'post',\n      path: 'detail/moveUp',\n      controller: 'detail',\n      middlewares: 'transaction',\n      meta: { right: { type: 'detail', action: 'moveUp' } },\n    },\n    {\n      method: 'post',\n      path: 'detail/moveDown',\n      controller: 'detail',\n      middlewares: 'transaction',\n      meta: { right: { type: 'detail', action: 'moveDown' } },\n    },\n    { method: 'post', path: 'detail/actions', controller: 'detail' },\n    { method: 'post', path: 'detail/actionsBulk', controller: 'detail' },\n    { method: 'post', path: 'detail/validator', controller: 'detail' },\n  ];\n  return routes;\n};\n","module.exports = app => {\n  class Base extends app.Service {\n    detailClasses() {\n      return this.ctx.bean.detailClass.detailClasses();\n    }\n\n    actions() {\n      return this.ctx.bean.detailAction.actions();\n    }\n  }\n\n  return Base;\n};\n","module.exports = app => {\n  class Detail extends app.Service {\n    async create({ atomKey, detailClass, item, user }) {\n      return await this.ctx.bean.detail.create({ atomKey, detailClass, item, user });\n    }\n\n    async read({ key, options, user }) {\n      return await this.ctx.bean.detail.read({ key, options, user });\n    }\n\n    async select({ atomKey, detailClass, options, user }) {\n      return await this.ctx.bean.detail.select({ atomKey, detailClass, options, user });\n    }\n\n    async count({ atomKey, detailClass, options, user }) {\n      return await this.ctx.bean.detail.count({ atomKey, detailClass, options, user });\n    }\n\n    async write({ key, item, options, user }) {\n      return await this.ctx.bean.detail.write({ key, item, options, user });\n    }\n\n    async delete({ key, user }) {\n      return await this.ctx.bean.detail.delete({ key, user });\n    }\n\n    async clone({ key, user }) {\n      return await this.ctx.bean.detail.clone({ key, user });\n    }\n\n    async moveUp({ key, user }) {\n      return await this.ctx.bean.detail.moveUp({ key, user });\n    }\n\n    async moveDown({ key, user }) {\n      return await this.ctx.bean.detail.moveDown({ key, user });\n    }\n\n    async actions({ flowTaskId, atomKey, detailClass, mode, user }) {\n      return await this.ctx.bean.detail.actions({ flowTaskId, atomKey, detailClass, mode, user });\n    }\n\n    async actionsBulk({ flowTaskId, atomKey, detailClass, mode, user }) {\n      return await this.ctx.bean.detail.actionsBulk({ flowTaskId, atomKey, detailClass, mode, user });\n    }\n\n    async validator({ detailClass }) {\n      return await this.ctx.bean.detail.validator({ detailClass });\n    }\n  }\n\n  return Detail;\n};\n","const base = require('./service/base.js');\nconst detail = require('./service/detail.js');\n\nmodule.exports = app => {\n  const services = {\n    base,\n    detail,\n  };\n  return services;\n};\n","module.exports = require(\"require3\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(421);\n",""],"names":[],"sourceRoot":""}