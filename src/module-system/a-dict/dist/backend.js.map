{"version":3,"file":"backend.js","mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;;;;ACHA;AACA;AACA;AACA,mBAAmB,gCAAgC;AACnD;AACA,uCAAuC,gCAAgC;AACvE;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB,OAAO;AACP;AACA,eAAe;AACf;;AAEA,iBAAiB,+BAA+B;AAChD;AACA,sCAAsC,+BAA+B;AACrE;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,iCAAiC;AACpD;AACA,2BAA2B,iCAAiC;AAC5D;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,6CAA6C;AAC/D;AACA;AACA;AACA,0BAA0B,6CAA6C;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,+CAA+C,wBAAwB;AACvE,SAAS;AACT;AACA;;AAEA,mBAAmB,+BAA+B;AAClD,4DAA4D,gBAAgB;AAC5E;AACA;AACA;AACA,2BAA2B,+BAA+B;AAC1D;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,+CAA+C,wBAAwB;AACvE,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACpGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,+BAA+B;AACpD;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA,wCAAwC,iBAAiB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,kEAAkE;AACvF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,oBAAoB,iBAAiB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,iBAAiB;AAClE;AACA;AACA;AACA;;AAEA,sBAAsB,SAAS;AAC/B;AACA;;AAEA,yBAAyB,iBAAiB;AAC1C;AACA,kDAAkD,uCAAuC;AACzF;AACA,iCAAiC,cAAc;AAC/C;AACA;AACA;;AAEA,8BAA8B,2BAA2B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,sEAAsE,wBAAwB;AAC9F,yDAAyD,QAAQ;AACjE;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,iEAAiE,8BAA8B;AAC/F;AACA;AACA;AACA;AACA,8CAA8C,OAAO,UAAU;AAC/D;AACA;AACA;AACA;;AAEA,0BAA0B,cAAc;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,+BAA+B,uCAAuC;AACtE;AACA;AACA,2DAA2D,iCAAiC;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;;AAEA,+BAA+B,qBAAqB;AACpD;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACjNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe,sCAAsC;AACrD,eAAe,mDAAmD;AAClE,eAAe,6DAA6D;AAC5E,eAAe,oDAAoD;AACnE,eAAe,8DAA8D;AAC7E,eAAe,qDAAqD;AACpE,eAAe,+DAA+D;AAC9E,eAAe,oDAAoD;AACnE,eAAe,8DAA8D;AAC7E,eAAe,wDAAwD;AACvE,eAAe,kEAAkE;AACjF,eAAe,0CAA0C;AACzD,eAAe,0CAA0C;AACzD;AACA,wDAAwD,mCAAmC;AAC3F;;AAEA;AACA;AACA;AACA,YAAY,sCAAsC;AAClD,YAAY,mDAAmD;AAC/D,YAAY,iEAAiE;AAC7E,YAAY,oDAAoD;AAChE,YAAY,kEAAkE;AAC9E,YAAY,qDAAqD;AACjE,YAAY,mEAAmE;AAC/E,YAAY,oDAAoD;AAChE,YAAY,kEAAkE;AAC9E,YAAY,wDAAwD;AACpE,YAAY,sEAAsE;AAClF,YAAY,0CAA0C;AACtD,YAAY,0CAA0C;AACtD;AACA,qDAAqD,mCAAmC;AACxF;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;AC1FA,uBAAuB,mBAAO,CAAC,GAA2B;AAC1D,iBAAiB,mBAAO,CAAC,GAAqB;AAC9C,iBAAiB,mBAAO,CAAC,GAAqB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACxBA;AACA;AACA;AACA;AACA;;;;;;;;ACJA;AACA;;;;;;;;ACDA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACLA;AACA,WAAW,mBAAO,CAAC,GAAmB;AACtC,WAAW,mBAAO,CAAC,EAAmB;AACtC;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,eAAe;AACf;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB,iBAAiB;AACjB,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB,iBAAiB;AACjB,eAAe;AACf;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnEA,2BAA2B,mBAAO,CAAC,GAAgC;;AAEnE;AACA;AACA;AACA;;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;AClEA,aAAa,mBAAO,CAAC,GAAkB;;AAEvC;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;;;;;;;ACZA,aAAa,mBAAO,CAAC,GAAsB;;AAE3C;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACPA,eAAe,mBAAO,CAAC,EAAoB;AAC3C,gBAAgB,mBAAO,CAAC,EAAqB;AAC7C,eAAe,mBAAO,CAAC,GAAoB;;AAE3C;AACA;AACA,eAAe,mBAAO,CAAC,GAAW;AAClC;AACA,gBAAgB,mBAAO,CAAC,GAAY;AACpC;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD;AACA,mBAAmB,mBAAO,CAAC,GAAe;AAC1C;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,eAAe,mBAAO,CAAC,GAAW;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AChCA;AACA;AACA,kBAAkB,mBAAO,CAAC,GAAgC;AAC1D;AACA,wBAAwB,mBAAO,CAAC,GAA4B;AAC5D,0BAA0B,mBAAO,CAAC,GAA8B;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP,kBAAkB;AAClB;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACjEA;AACA;AACA;AACA,mBAAmB,2BAA2B,yBAAyB;AACvE;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,mBAAmB,kCAAkC,yBAAyB;AAC9E;AACA;AACA;AACA;;;;;;;;ACPA,aAAa,mBAAO,CAAC,GAAiB;AACtC,oBAAoB,mBAAO,CAAC,GAAwB;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA;AACA,oBAAoB,0DAA0D;AAC9E;AACA;;;;;;;;ACHA;AACA;AACA,oBAAoB,eAAe;AACnC;AACA,+DAA+D,kCAAkC;AACjG;AACA;AACA,sDAAsD,SAAS;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;AClBA,aAAa,mBAAO,CAAC,GAAmB;;AAExC;AACA;AACA;AACA;AACA;AACA;;;;;;;UCPA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://egg-born-module-a-dict/./backend/src/aops.js","webpack://egg-born-module-a-dict/./backend/src/bean/atom.dict.js","webpack://egg-born-module-a-dict/./backend/src/bean/bean.dict.js","webpack://egg-born-module-a-dict/./backend/src/bean/version.manager.js","webpack://egg-born-module-a-dict/./backend/src/beans.js","webpack://egg-born-module-a-dict/./backend/src/config/config.js","webpack://egg-born-module-a-dict/./backend/src/config/errors.js","webpack://egg-born-module-a-dict/./backend/src/config/locale/en-us.js","webpack://egg-born-module-a-dict/./backend/src/config/locale/zh-cn.js","webpack://egg-born-module-a-dict/./backend/src/config/locales.js","webpack://egg-born-module-a-dict/./backend/src/config/static/layout/layoutAtomListDict.js","webpack://egg-born-module-a-dict/./backend/src/config/static/layouts.js","webpack://egg-born-module-a-dict/./backend/src/config/static/resources.js","webpack://egg-born-module-a-dict/./backend/src/config/validation/schema/dict.js","webpack://egg-born-module-a-dict/./backend/src/config/validation/schemas.js","webpack://egg-born-module-a-dict/./backend/src/controller/dict.js","webpack://egg-born-module-a-dict/./backend/src/controllers.js","webpack://egg-born-module-a-dict/./backend/src/main.js","webpack://egg-born-module-a-dict/./backend/src/meta.js","webpack://egg-born-module-a-dict/./backend/src/model/dict.js","webpack://egg-born-module-a-dict/./backend/src/model/dictContent.js","webpack://egg-born-module-a-dict/./backend/src/models.js","webpack://egg-born-module-a-dict/./backend/src/routes.js","webpack://egg-born-module-a-dict/./backend/src/service/dict.js","webpack://egg-born-module-a-dict/./backend/src/services.js","webpack://egg-born-module-a-dict/webpack/bootstrap","webpack://egg-born-module-a-dict/webpack/before-startup","webpack://egg-born-module-a-dict/webpack/startup","webpack://egg-born-module-a-dict/webpack/after-startup"],"sourcesContent":["module.exports = app => {\n  const aops = {};\n  return aops;\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Atom extends app.meta.AtomBase {\n    async create({ atomClass, item, options, user }) {\n      // super\n      const key = await super.create({ atomClass, item, options, user });\n      // add dict\n      const res = await this.ctx.model.dict.insert({\n        atomId: key.atomId,\n      });\n      const itemId = res.insertId;\n      // add content\n      await this.ctx.model.dictContent.insert({\n        atomId: key.atomId,\n        itemId,\n        dictItems: '[]',\n        dictLocales: '{}',\n      });\n      // return key\n      return { atomId: key.atomId, itemId };\n    }\n\n    async read({ atomClass, options, key, user }) {\n      // super\n      const item = await super.read({ atomClass, options, key, user });\n      if (!item) return null;\n      // meta\n      this._getMeta(item);\n      // ok\n      return item;\n    }\n\n    async select({ atomClass, options, items, user }) {\n      // super\n      await super.select({ atomClass, options, items, user });\n      // meta\n      for (const item of items) {\n        this._getMeta(item);\n      }\n    }\n\n    async write({ atomClass, target, key, item, options, user }) {\n      const atomStaticKey = item.atomStaticKey;\n      const atomStage = item.atomStage;\n      // super\n      await super.write({ atomClass, target, key, item, options, user });\n      // update dict\n      const data = await this.ctx.model.dict.prepareData(item);\n      await this.ctx.model.dict.update(data);\n      // update content\n      await this.ctx.model.dictContent.update(\n        {\n          dictItems: item.dictItems,\n          dictLocales: item.dictLocales,\n        },\n        {\n          where: {\n            atomId: key.atomId,\n          },\n        }\n      );\n      // remove dict cache\n      if (atomStage === 1) {\n        this.ctx.tail(() => {\n          this.ctx.bean.dict.dictCacheRemove({ dictKey: atomStaticKey });\n        });\n      }\n    }\n\n    async delete({ atomClass, key, options, user }) {\n      const item = await this.ctx.bean.atom.modelAtom.get({ id: key.atomId });\n      const atomStaticKey = item.atomStaticKey;\n      const atomStage = item.atomStage;\n      // super\n      await super.delete({ atomClass, key, options, user });\n      // delete dict\n      await this.ctx.model.dict.delete({\n        id: key.itemId,\n      });\n      // delete content\n      await this.ctx.model.dictContent.delete({\n        itemId: key.itemId,\n      });\n      // remove dict cache\n      if (atomStage === 1) {\n        this.ctx.tail(() => {\n          this.ctx.bean.dict.dictCacheRemove({ dictKey: atomStaticKey });\n        });\n      }\n    }\n\n    _getMeta(item) {\n      const meta = this._ensureItemMeta(item);\n      // meta.flags\n      // meta.summary\n      meta.summary = item.description;\n    }\n  }\n\n  return Atom;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Dict extends ctx.app.meta.BeanModuleBase {\n    constructor(moduleName) {\n      super(ctx, 'dict');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get cacheMem() {\n      return ctx.cache.mem.module(moduleInfo.relativeName);\n    }\n\n    get atomClass() {\n      return {\n        module: moduleInfo.relativeName,\n        atomClassName: 'dict',\n      };\n    }\n\n    get model() {\n      return ctx.model.module(moduleInfo.relativeName).dict;\n    }\n\n    get modelDictContent() {\n      return ctx.model.module(moduleInfo.relativeName).dictContent;\n    }\n\n    // options: separator\n    //  find by code or title\n    async findItem({ dictKey, code, title, options }) {\n      let findByCode;\n      if (!this._checkIfEmptyForSelect(code)) {\n        code = String(code);\n        findByCode = true;\n      } else if (title) {\n        findByCode = false;\n      } else {\n        return null;\n      }\n      // options\n      options = options || { separator: '/' };\n      const separator = options.separator;\n      // locale\n      const locale = ctx.locale;\n      // dict\n      const dict = await this.getDict({ dictKey, locale });\n      if (!dict._cacheCode) dict._cacheCode = {};\n      if (!dict._cacheTitle) dict._cacheTitle = {};\n      let dictItemRes = findByCode ? dict._cacheCode[code] : dict._cacheTitle[title];\n      if (dictItemRes) return dictItemRes;\n      // find\n      const dictItemsRes = [];\n      const res = this._findItem_loop({\n        dictItemsRes,\n        dictItems: dict._dictItems,\n        dictItemsMap: dict._dictItemsMap,\n        codes: findByCode ? code.split(separator) : undefined,\n        titles: findByCode ? undefined : title.split(separator),\n        findByCode,\n      });\n      if (!res) return null;\n      const codeFull = findByCode ? code : dictItemsRes.map(item => item.code).join(separator);\n      const titleFull = dictItemsRes.map(item => item.title).join(separator);\n      const titleLocaleFull = dictItemsRes.map(item => item.titleLocale).join(separator);\n      dictItemRes = {\n        ...dictItemsRes[dictItemsRes.length - 1],\n        codeFull,\n        titleFull,\n        titleLocaleFull,\n      };\n      // cache\n      if (findByCode) {\n        dict._cacheCode[code] = dictItemRes;\n      } else {\n        dict._cacheTitle[title] = dictItemRes;\n      }\n      // ok\n      return dictItemRes;\n    }\n\n    _findItem_loop({ dictItemsRes, dictItems, dictItemsMap, codes, titles, findByCode }) {\n      let dictItem;\n      if (findByCode) {\n        const code = codes.shift();\n        dictItem = dictItemsMap && dictItemsMap[code];\n        if (!dictItem) return false;\n        dictItemsRes.push(dictItem);\n        if (codes.length === 0) return true;\n      } else {\n        const title = titles.shift();\n        dictItem = dictItems && dictItems.find(item => item.title === title || item.titleLocale === title);\n        if (!dictItem) return false;\n        dictItemsRes.push(dictItem);\n        if (titles.length === 0) return true;\n      }\n      return this._findItem_loop({\n        dictItemsRes,\n        dictItems: dictItem.children,\n        dictItemsMap: dictItem._childrenMap,\n        codes,\n        titles,\n        findByCode,\n      });\n    }\n\n    async getDict({ dictKey, locale }) {\n      locale = locale || ctx.locale;\n      let dict = this.cacheMem.get(dictKey);\n      if (dict && dict[locale]) return dict[locale];\n      if (!dict) {\n        dict = {};\n      }\n      if (!dict[locale]) {\n        dict[locale] = await this._prepareDict({ dictKey, locale });\n      }\n      this.cacheMem.set(dictKey, dict);\n      return dict[locale];\n    }\n\n    dictCacheRemove({ dictKey }) {\n      this.cacheMem.remove(dictKey);\n    }\n\n    async _prepareDict({ dictKey, locale }) {\n      // load\n      const dict = await this._prepareDict_load({ dictKey, user: null, returnDict: true });\n      // prepare\n      this._prepareDict_adjust({ dict, locale });\n      // ok\n      return dict;\n    }\n\n    async _prepareDict_load({ dictKey, user, returnDict }) {\n      if (!dictKey) throw new Error('dictKey not set');\n      // get atomId\n      let atomId;\n      const atomClass = await ctx.bean.atomClass.get(this.atomClass);\n      const atom = await ctx.bean.atom.modelAtom.get({\n        atomClassId: atomClass.id,\n        atomStaticKey: dictKey,\n        atomStage: 1,\n      });\n      if (!atom) {\n        // try preload\n        const atomKey = await ctx.bean.atomStatic.preloadAtomStatic({ atomStaticKey: dictKey });\n        if (!atomKey) throw new Error(`dict not found: ${dictKey}`);\n        atomId = atomKey.atomId;\n      } else {\n        atomId = atom.id;\n      }\n      // check resource right\n      if (user) {\n        const res = await ctx.bean.resource.checkRightResource({ resourceAtomId: atomId, user });\n        if (!res) ctx.throw(403);\n      }\n      if (!returnDict) return true;\n      // read\n      const dict = await ctx.bean.atom.read({ key: { atomId } });\n      if (!dict) return ctx.throw.module('a-base', 1002);\n      // ok\n      return dict;\n    }\n\n    _prepareDict_adjust({ dict, locale }) {\n      // init\n      dict._dictItems = JSON.parse(dict.dictItems);\n      dict._dictLocales = dict.dictLocales ? JSON.parse(dict.dictLocales) : null;\n      dict._dictItemsMap = {};\n      // adjust\n      this._prepareDict_adjust_loop({\n        dict,\n        dictItemsMap: dict._dictItemsMap,\n        dictItems: dict._dictItems,\n        locale,\n      });\n    }\n\n    _prepareDict_adjust_loop({ dict, dictItemsMap, dictItems, locale }) {\n      for (const item of dictItems) {\n        // self\n        item.titleLocale = this._prepareDict_titleLocale({ dict, title: item.title, locale });\n        dictItemsMap[item.code] = item;\n        // children\n        if (item.children) {\n          item._childrenMap = {};\n          this._prepareDict_adjust_loop({\n            dict,\n            dictItemsMap: item._childrenMap,\n            dictItems: item.children,\n            locale,\n          });\n        }\n      }\n    }\n\n    _prepareDict_titleLocale({ dict, title, locale }) {\n      return ctx.bean.util.getTitleLocale({\n        locales: dict._dictLocales,\n        title,\n        locale,\n      });\n    }\n\n    _checkIfEmptyForSelect(value) {\n      return value === '' || value === undefined || value === null;\n    }\n  }\n\n  return Dict;\n};\n","module.exports = app => {\n  class Version extends app.meta.BeanBase {\n    async update(options) {\n      if (options.version === 1) {\n        // create table: aDict\n        let sql = `\n          CREATE TABLE aDict (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            description varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n        // create table: aDictContent\n        sql = `\n          CREATE TABLE aDictContent (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            itemId int(11) DEFAULT '0',\n            dictItems JSON DEFAULT NULL,\n            dictLocales JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n        // create view: aDictViewFull\n        sql = `\n          CREATE VIEW aDictViewFull as\n            select a.*,b.dictItems,b.dictLocales from aDict a\n              left join aDictContent b on a.id=b.itemId\n        `;\n        await this.ctx.model.query(sql);\n      }\n    }\n\n    async init(options) {\n      if (options.version === 1) {\n        // // add role rights\n        // const roleRights = [\n        //   { roleName: 'system', action: 'create' },\n        //   { roleName: 'system', action: 'read', scopeNames: 0 },\n        //   { roleName: 'system', action: 'read', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'write', scopeNames: 0 },\n        //   { roleName: 'system', action: 'write', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'delete', scopeNames: 0 },\n        //   { roleName: 'system', action: 'delete', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'clone', scopeNames: 0 },\n        //   { roleName: 'system', action: 'clone', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'authorize', scopeNames: 0 },\n        //   { roleName: 'system', action: 'authorize', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'deleteBulk' },\n        //   { roleName: 'system', action: 'exportBulk' },\n        // ];\n        // await this.ctx.bean.role.addRoleRightBatch({ atomClassName: 'dict', roleRights });\n      }\n\n      if (options.version === 2) {\n        // add role rights\n        const roleRights = [\n          { roleName: 'system', action: 'create' },\n          { roleName: 'system', action: 'read', scopeNames: 0 },\n          { roleName: 'system', action: 'read', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'write', scopeNames: 0 },\n          { roleName: 'system', action: 'write', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'delete', scopeNames: 0 },\n          { roleName: 'system', action: 'delete', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'clone', scopeNames: 0 },\n          { roleName: 'system', action: 'clone', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'authorize', scopeNames: 0 },\n          { roleName: 'system', action: 'authorize', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'deleteBulk' },\n          { roleName: 'system', action: 'exportBulk' },\n        ];\n        await this.ctx.bean.role.addRoleRightBatch({ atomClassName: 'dict', roleRights });\n      }\n    }\n\n    async test() {}\n  }\n\n  return Version;\n};\n","const versionManager = require('./bean/version.manager.js');\nconst atomDict = require('./bean/atom.dict.js');\nconst beanDict = require('./bean/bean.dict.js');\n\nmodule.exports = app => {\n  const beans = {\n    // version\n    'version.manager': {\n      mode: 'app',\n      bean: versionManager,\n    },\n    // atom\n    'atom.dict': {\n      mode: 'app',\n      bean: atomDict,\n    },\n    // global\n    dict: {\n      mode: 'ctx',\n      bean: beanDict,\n      global: true,\n    },\n  };\n  return beans;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {};\n  return config;\n};\n","// error code should start from 1001\nmodule.exports = {};\n","module.exports = {};\n","module.exports = {\n  Dict: '字典',\n  Dicts: '字典',\n  'Create Dict': '新建字典',\n  'Dict List': '字典列表',\n};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const content = {\n    layouts: {\n      table: {\n        blocks: {\n          items: {\n            columns: [\n              {\n                dataIndex: 'atomName',\n                title: 'Atom Name',\n                align: 'left',\n                component: {\n                  module: 'a-baselayout',\n                  name: 'listLayoutTableCellAtomName',\n                },\n              },\n              {\n                dataIndex: 'description',\n                title: 'Description',\n                align: 'left',\n              },\n              {\n                dataIndex: 'userName',\n                title: 'Creator',\n                align: 'left',\n                component: {\n                  module: 'a-baselayout',\n                  name: 'listLayoutTableCellUserName',\n                },\n              },\n              {\n                dataIndex: 'atomCreatedAt',\n                title: 'Created Time',\n                align: 'center',\n                params: {\n                  dateFormat: {\n                    lines: true,\n                  },\n                },\n              },\n              {\n                dataIndex: 'atomUpdatedAt',\n                title: 'Modification Time',\n                align: 'center',\n                params: {\n                  dateFormat: {\n                    lines: true,\n                  },\n                },\n              },\n            ],\n          },\n        },\n      },\n    },\n  };\n  const layout = {\n    atomName: 'Dict',\n    atomStaticKey: 'layoutAtomListDict',\n    atomRevision: 0,\n    description: '',\n    layoutTypeCode: 3,\n    content: JSON.stringify(content),\n    resourceRoles: 'root',\n  };\n  return layout;\n};\n","const layoutAtomListDict = require('./layout/layoutAtomListDict.js');\n\nmodule.exports = app => {\n  const layouts = [layoutAtomListDict(app)];\n  return layouts;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const resources = [\n    // menu\n    {\n      atomName: 'Create Dict',\n      atomStaticKey: 'createDict',\n      atomRevision: -1,\n      atomCategoryId: 'a-base:menu.BasicProfile',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'dict',\n        atomAction: 'create',\n      }),\n      resourceIcon: ':outline:dict-outline',\n      appKey: 'a-appbooster:appSystem',\n      resourceRoles: 'template.system',\n    },\n    {\n      atomName: 'Dicts',\n      atomStaticKey: 'listDict',\n      atomRevision: 3,\n      atomCategoryId: 'a-base:menu.BasicProfile',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'dict',\n        atomAction: 'read',\n      }),\n      resourceIcon: ':outline:dict-outline',\n      appKey: 'a-appbooster:appSystem',\n      resourceRoles: 'template.system',\n    },\n  ];\n  return resources;\n};\n","module.exports = app => {\n  const schemas = {};\n  // dict\n  schemas.dict = {\n    type: 'object',\n    properties: {\n      // Basic Info\n      __groupBasicInfo: {\n        ebType: 'group-flatten',\n        ebTitle: 'Basic Info',\n      },\n      atomName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Name',\n        notEmpty: true,\n      },\n      description: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Description',\n      },\n      dictItems: {\n        type: 'string',\n        ebType: 'json',\n        ebTitle: 'Dict Items',\n        notEmpty: true,\n      },\n      dictLocales: {\n        type: 'string',\n        ebType: 'json',\n        ebTitle: 'Dict Locales',\n        notEmpty: true,\n      },\n      // Extra\n      __groupExtra: {\n        ebType: 'group-flatten',\n        ebTitle: 'Extra',\n      },\n      atomStaticKey: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'KeyForAtom',\n        ebReadOnly: true,\n        notEmpty: true,\n      },\n      atomRevision: {\n        type: 'number',\n        ebType: 'text',\n        ebTitle: 'Revision',\n        ebReadOnly: true,\n      },\n    },\n  };\n  // dict search\n  schemas.dictSearch = {\n    type: 'object',\n    properties: {\n      description: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Description',\n      },\n    },\n  };\n  return schemas;\n};\n","const dict = require('./schema/dict.js');\n\nmodule.exports = app => {\n  const schemas = {};\n  // dict\n  Object.assign(schemas, dict(app));\n  // ok\n  return schemas;\n};\n","module.exports = app => {\n  class DictController extends app.Controller {\n    async getDict() {\n      const res = await this.ctx.service.dict.getDict({\n        dictKey: this.ctx.request.body.dictKey,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n  }\n\n  return DictController;\n};\n","const dict = require('./controller/dict.js');\n\nmodule.exports = app => {\n  const controllers = {\n    dict,\n  };\n  return controllers;\n};\n","const config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\n\nmodule.exports = app => {\n  // aops\n  const aops = require('./aops.js')(app);\n  // beans\n  const beans = require('./beans.js')(app);\n  // routes\n  const routes = require('./routes.js')(app);\n  // controllers\n  const controllers = require('./controllers.js')(app);\n  // services\n  const services = require('./services.js')(app);\n  // models\n  const models = require('./models.js')(app);\n  // meta\n  const meta = require('./meta.js')(app);\n\n  return {\n    aops,\n    beans,\n    routes,\n    controllers,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    meta,\n  };\n};\n","module.exports = app => {\n  // schemas\n  const schemas = require('./config/validation/schemas.js')(app);\n  // static\n  const staticLayouts = require('./config/static/layouts.js')(app);\n  const staticResources = require('./config/static/resources.js')(app);\n  // meta\n  const meta = {\n    base: {\n      atoms: {\n        dict: {\n          info: {\n            bean: 'dict',\n            title: 'Dict',\n            tableName: 'aDict',\n            tableNameModes: {\n              full: 'aDictViewFull',\n            },\n            inner: true,\n            resource: true,\n            language: false,\n            category: false,\n            tag: false,\n            comment: false,\n            attachment: false,\n            layout: {\n              config: {\n                atomList: 'layoutAtomListDict',\n              },\n            },\n          },\n          actions: {\n            write: {\n              enableOnStatic: true,\n            },\n          },\n          validator: 'dict',\n          search: {\n            validator: 'dictSearch',\n          },\n        },\n      },\n      statics: {\n        'a-baselayout.layout': {\n          items: staticLayouts,\n        },\n        'a-base.resource': {\n          items: staticResources,\n        },\n      },\n    },\n    validation: {\n      validators: {\n        dict: {\n          schemas: 'dict',\n        },\n        dictSearch: {\n          schemas: 'dictSearch',\n        },\n      },\n      keywords: {},\n      schemas,\n    },\n  };\n  return meta;\n};\n","module.exports = app => {\n  class Dict extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDict', options: { disableDeleted: false } });\n    }\n  }\n  return Dict;\n};\n","module.exports = app => {\n  class DictContent extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDictContent', options: { disableDeleted: false } });\n    }\n  }\n  return DictContent;\n};\n","const dict = require('./model/dict.js');\nconst dictContent = require('./model/dictContent.js');\n\nmodule.exports = app => {\n  const models = {\n    dict,\n    dictContent,\n  };\n  return models;\n};\n","module.exports = app => {\n  const routes = [{ method: 'post', path: 'dict/getDict', controller: 'dict' }];\n  return routes;\n};\n","module.exports = app => {\n  class Dict extends app.Service {\n    async getDict({ dictKey, user }) {\n      // check right\n      const res = await this.ctx.bean.dict._prepareDict_load({ dictKey, user, returnDict: false });\n      if (!res) this.ctx.throw(403);\n      // get dict\n      const dict = await this.ctx.bean.dict.getDict({ dictKey });\n      // short\n      return {\n        atomId: dict.atomId,\n        description: dict.description,\n        _dictItems: dict._dictItems,\n      };\n    }\n  }\n\n  return Dict;\n};\n","const dict = require('./service/dict.js');\n\nmodule.exports = app => {\n  const services = {\n    dict,\n  };\n  return services;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(421);\n",""],"names":[],"sourceRoot":""}