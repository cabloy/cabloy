{"version":3,"file":"backend.js","mappings":";;;;;;AAAA;AACA;AACA,mBAAmB,gCAAgC;AACnD;AACA,uCAAuC,gCAAgC;AACvE;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,eAAe;AACf;;AAEA,iBAAiB,+BAA+B;AAChD;AACA,sCAAsC,+BAA+B;AACrE;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,iCAAiC;AACpD;AACA,2BAA2B,iCAAiC;AAC5D;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,6CAA6C;AAC/D;AACA;AACA;AACA,0BAA0B,6CAA6C;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;;AAEA,mBAAmB,+BAA+B;AAClD;AACA,2BAA2B,+BAA+B;AAC1D;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe,sCAAsC;AACrD,eAAe,mDAAmD;AAClE,eAAe,6DAA6D;AAC5E,eAAe,oDAAoD;AACnE,eAAe,8DAA8D;AAC7E,eAAe,qDAAqD;AACpE,eAAe,+DAA+D;AAC9E,eAAe,oDAAoD;AACnE,eAAe,8DAA8D;AAC7E,eAAe,wDAAwD;AACvE,eAAe,kEAAkE;AACjF,eAAe,0CAA0C;AACzD,eAAe,0CAA0C;AACzD;AACA,wDAAwD,wCAAwC;AAChG;;AAEA;AACA;AACA;AACA,YAAY,sCAAsC;AAClD,YAAY,mDAAmD;AAC/D,YAAY,iEAAiE;AAC7E,YAAY,oDAAoD;AAChE,YAAY,kEAAkE;AAC9E,YAAY,qDAAqD;AACjE,YAAY,mEAAmE;AAC/E,YAAY,oDAAoD;AAChE,YAAY,kEAAkE;AAC9E,YAAY,wDAAwD;AACpE,YAAY,sEAAsE;AAClF,YAAY,0CAA0C;AACtD,YAAY,0CAA0C;AACtD;AACA,qDAAqD,wCAAwC;AAC7F;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACzIA,uBAAuB,mBAAO,CAAC,GAA2B;AAC1D,sBAAsB,mBAAO,CAAC,GAA0B;;AAExD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;;;;;;;;ACJA;AACA;;;;;;;;ACDA;AACA;AACA;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACRA;AACA,WAAW,mBAAO,CAAC,GAAmB;AACtC,WAAW,mBAAO,CAAC,EAAmB;AACtC;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,mCAAmC;AAC3D,yBAAyB,uBAAuB;AAChD,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,8BAA8B;AAC1D,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,iCAAiC;AACzD,yBAAyB,uBAAuB;AAChD,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,+BAA+B;AAC3D,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,sCAAsC;AAC9D,yBAAyB,sBAAsB;AAC/C,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,6BAA6B;AACzD,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,4BAA4B;AACpD,yBAAyB,uBAAuB;AAChD,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,4BAA4B;AACxD,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,mCAAmC;AAC3D,yBAAyB,uBAAuB;AAChD,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,8BAA8B;AAC1D,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,iCAAiC;AACzD,yBAAyB,uBAAuB;AAChD,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,+BAA+B;AAC3D,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,sCAAsC;AAC9D,yBAAyB,sBAAsB;AAC/C,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,6BAA6B;AACzD,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC,sBAAsB,wBAAwB;AAC9C,wBAAwB,4BAA4B;AACpD,yBAAyB,uBAAuB;AAChD,0BAA0B,oBAAoB;AAC9C,0BAA0B,qBAAqB;AAC/C,2BAA2B,oBAAoB;AAC/C,4BAA4B,4BAA4B;AACxD,+BAA+B,2BAA2B;AAC1D,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9LA,2BAA2B,mBAAO,CAAC,GAAmC;AACtE,sBAAsB,mBAAO,CAAC,GAA8B;;AAE5D;AACA;AACA;AACA;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;;;;;;;AC/EA,kBAAkB,mBAAO,CAAC,GAA2B;;AAErD;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACPA,eAAe,mBAAO,CAAC,EAAoB;AAC3C,gBAAgB,mBAAO,CAAC,EAAqB;AAC7C,eAAe,mBAAO,CAAC,GAAoB;;AAE3C;AACA;AACA,gBAAgB,mBAAO,CAAC,GAAY;AACpC;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD;AACA,mBAAmB,mBAAO,CAAC,GAAe;AAC1C;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,eAAe,mBAAO,CAAC,GAAW;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7BA;AACA,kBAAkB,mBAAO,CAAC,GAAgC;AAC1D,2BAA2B,mBAAO,CAAC,GAA+B;AAClE,0BAA0B,mBAAO,CAAC,GAA8B;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP,kBAAkB;AAClB;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;ACzEA;AACA;AACA;AACA,mBAAmB,gCAAgC,yBAAyB;AAC5E;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,mBAAmB,uCAAuC,yBAAyB;AACnF;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,mBAAmB,wCAAwC,yBAAyB;AACpF;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,mBAAmB,oCAAoC,yBAAyB;AAChF;AACA;AACA;AACA;;;;;;;;ACPA,kBAAkB,mBAAO,CAAC,GAAsB;AAChD,yBAAyB,mBAAO,CAAC,GAA6B;AAC9D,sBAAsB,mBAAO,CAAC,GAA0B;AACxD,sBAAsB,mBAAO,CAAC,GAA0B;;AAExD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACbA;AACA;AACA;AACA,MAAM,sEAAsE;AAC5E;AACA;AACA;AACA;AACA,cAAc,SAAS,kCAAkC;AACzD,KAAK;AACL,MAAM,iFAAiF,QAAQ,gBAAgB;AAC/G,MAAM,iFAAiF,QAAQ,gBAAgB;AAC/G,MAAM,uFAAuF,QAAQ,gBAAgB;AACrH,MAAM,mFAAmF,QAAQ,gBAAgB;AACjH;AACA;AACA;AACA;AACA,cAAc,SAAS,kCAAkC;AACzD,KAAK;AACL;AACA;AACA;AACA;AACA,cAAc,SAAS,kCAAkC;AACzD,KAAK;AACL;AACA;AACA;AACA;AACA,cAAc,SAAS,kCAAkC;AACzD,KAAK;AACL;AACA;AACA;;;;;;;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,sBAAsB,qBAAqB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,oEAAoE,8BAA8B;AAClG;AACA;AACA,+BAA+B,+BAA+B;AAC9D;;AAEA,iBAAiB,kDAAkD;AACnE;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,eAAe,yBAAyB;AACxC;AACA,OAAO;AACP;AACA,eAAe;AACf;;AAEA,yBAAyB,uBAAuB;AAChD;AACA;AACA;AACA,OAAO;AACP;;AAEA,yBAAyB,gCAAgC;AACzD;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;;AAEA,+BAA+B,sCAAsC;AACrE;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;;AAEA,2BAA2B,uBAAuB;AAClD;AACA;AACA;AACA,OAAO;AACP;;AAEA,2BAA2B,uBAAuB;AAClD;AACA;AACA,eAAe,yBAAyB;AACxC;AACA,OAAO;AACP;AACA;AACA,+BAA+B,+BAA+B,GAAG,GAAG;AACpE;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAsB,uBAAuB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;;AAEA,kCAAkC,wCAAwC;AAC1E;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;;;;;;;AC3KA,kBAAkB,mBAAO,CAAC,GAAwB;;AAElD;AACA;AACA;AACA;AACA;AACA;;;;;;;UCPA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://egg-born-module-a-dashboard/./backend/src/bean/atom.dashboard.js","webpack://egg-born-module-a-dashboard/./backend/src/bean/version.manager.js","webpack://egg-born-module-a-dashboard/./backend/src/beans.js","webpack://egg-born-module-a-dashboard/./backend/src/config/config.js","webpack://egg-born-module-a-dashboard/./backend/src/config/errors.js","webpack://egg-born-module-a-dashboard/./backend/src/config/locale/en-us.js","webpack://egg-born-module-a-dashboard/./backend/src/config/locale/zh-cn.js","webpack://egg-born-module-a-dashboard/./backend/src/config/locales.js","webpack://egg-born-module-a-dashboard/./backend/src/config/static/dashboard/dashboardAnonymous.js","webpack://egg-born-module-a-dashboard/./backend/src/config/static/dashboard/dashboardHome.js","webpack://egg-born-module-a-dashboard/./backend/src/config/static/dashboards.js","webpack://egg-born-module-a-dashboard/./backend/src/config/static/resources.js","webpack://egg-born-module-a-dashboard/./backend/src/config/validation/schemas.js","webpack://egg-born-module-a-dashboard/./backend/src/controller/dashboard.js","webpack://egg-born-module-a-dashboard/./backend/src/controllers.js","webpack://egg-born-module-a-dashboard/./backend/src/main.js","webpack://egg-born-module-a-dashboard/./backend/src/meta.js","webpack://egg-born-module-a-dashboard/./backend/src/model/dashboard.js","webpack://egg-born-module-a-dashboard/./backend/src/model/dashboardContent.js","webpack://egg-born-module-a-dashboard/./backend/src/model/dashboardFull.js","webpack://egg-born-module-a-dashboard/./backend/src/model/dashboardUser.js","webpack://egg-born-module-a-dashboard/./backend/src/models.js","webpack://egg-born-module-a-dashboard/./backend/src/routes.js","webpack://egg-born-module-a-dashboard/./backend/src/service/dashboard.js","webpack://egg-born-module-a-dashboard/./backend/src/services.js","webpack://egg-born-module-a-dashboard/webpack/bootstrap","webpack://egg-born-module-a-dashboard/webpack/before-startup","webpack://egg-born-module-a-dashboard/webpack/startup","webpack://egg-born-module-a-dashboard/webpack/after-startup"],"sourcesContent":["module.exports = app => {\n  class Atom extends app.meta.AtomBase {\n    async create({ atomClass, item, options, user }) {\n      // super\n      const key = await super.create({ atomClass, item, options, user });\n      // add dashboard\n      const res = await this.ctx.model.dashboard.insert({\n        atomId: key.atomId,\n      });\n      const itemId = res.insertId;\n      // add content\n      const content = {\n        root: {\n          id: this.ctx.bean.util.uuidv4(),\n          widgets: [],\n        },\n      };\n      await this.ctx.model.dashboardContent.insert({\n        atomId: key.atomId,\n        itemId,\n        content: JSON.stringify(content),\n      });\n      return { atomId: key.atomId, itemId };\n    }\n\n    async read({ atomClass, options, key, user }) {\n      // super\n      const item = await super.read({ atomClass, options, key, user });\n      if (!item) return null;\n      // meta\n      this._getMeta(item);\n      // ok\n      return item;\n    }\n\n    async select({ atomClass, options, items, user }) {\n      // super\n      await super.select({ atomClass, options, items, user });\n      // meta\n      for (const item of items) {\n        this._getMeta(item);\n      }\n    }\n\n    async write({ atomClass, target, key, item, options, user }) {\n      // check demo\n      this.ctx.bean.util.checkDemoForAtomWrite();\n      // super\n      await super.write({ atomClass, target, key, item, options, user });\n      // update dashboard\n      const data = await this.ctx.model.dashboard.prepareData(item);\n      await this.ctx.model.dashboard.update(data);\n      // update content\n      await this.ctx.model.dashboardContent.update(\n        {\n          content: item.content,\n        },\n        {\n          where: {\n            atomId: key.atomId,\n          },\n        }\n      );\n    }\n\n    async delete({ atomClass, key, options, user }) {\n      // super\n      await super.delete({ atomClass, key, options, user });\n      // delete dashboard\n      await this.ctx.model.dashboard.delete({\n        id: key.itemId,\n      });\n      // delete content\n      await this.ctx.model.dashboardContent.delete({\n        itemId: key.itemId,\n      });\n    }\n\n    _getMeta(item) {\n      const meta = this._ensureItemMeta(item);\n      // meta.flags\n      // meta.summary\n      meta.summary = item.description;\n    }\n  }\n\n  return Atom;\n};\n","module.exports = app => {\n  class Version extends app.meta.BeanBase {\n    async update(options) {\n      if (options.version === 1) {\n        // create table: aDashboardProfile\n        const sql = `\n          CREATE TABLE aDashboardProfile (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            profileName varchar(255) DEFAULT NULL,\n            profileValue json DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n      }\n\n      if (options.version === 2) {\n        // drop table: aDashboardProfile\n        let sql = `\n          DROP TABLE aDashboardProfile\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aDashboard\n        sql = `\n          CREATE TABLE aDashboard (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            description varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n          `;\n        await this.ctx.model.query(sql);\n\n        // create table: aDashboardContent\n        sql = `\n          CREATE TABLE aDashboardContent (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            itemId int(11) DEFAULT '0',\n            content JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aDashboardUser\n        sql = `\n          CREATE TABLE aDashboardUser (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            dashboardDefault int(11) DEFAULT '0',\n            dashboardAtomId int(11) DEFAULT '0',\n            dashboardName varchar(255) DEFAULT NULL,\n            content JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create view: aDashboardViewFull\n        sql = `\n          CREATE VIEW aDashboardViewFull as\n            select a.*,b.content from aDashboard a\n              left join aDashboardContent b on a.id=b.itemId\n        `;\n        await this.ctx.model.query(sql);\n      }\n    }\n\n    async init(options) {\n      if (options.version === 1) {\n        // empty\n      }\n\n      if (options.version === 2) {\n        // // add role rights\n        // const roleRights = [\n        //   { roleName: 'system', action: 'create' },\n        //   { roleName: 'system', action: 'read', scopeNames: 0 },\n        //   { roleName: 'system', action: 'read', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'write', scopeNames: 0 },\n        //   { roleName: 'system', action: 'write', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'delete', scopeNames: 0 },\n        //   { roleName: 'system', action: 'delete', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'clone', scopeNames: 0 },\n        //   { roleName: 'system', action: 'clone', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'authorize', scopeNames: 0 },\n        //   { roleName: 'system', action: 'authorize', scopeNames: 'superuser' },\n        //   { roleName: 'system', action: 'deleteBulk' },\n        //   { roleName: 'system', action: 'exportBulk' },\n        // ];\n        // await this.ctx.bean.role.addRoleRightBatch({ atomClassName: 'dashboard', roleRights });\n      }\n\n      if (options.version === 3) {\n        // add role rights\n        const roleRights = [\n          { roleName: 'system', action: 'create' },\n          { roleName: 'system', action: 'read', scopeNames: 0 },\n          { roleName: 'system', action: 'read', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'write', scopeNames: 0 },\n          { roleName: 'system', action: 'write', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'delete', scopeNames: 0 },\n          { roleName: 'system', action: 'delete', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'clone', scopeNames: 0 },\n          { roleName: 'system', action: 'clone', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'authorize', scopeNames: 0 },\n          { roleName: 'system', action: 'authorize', scopeNames: 'authenticated' },\n          { roleName: 'system', action: 'deleteBulk' },\n          { roleName: 'system', action: 'exportBulk' },\n        ];\n        await this.ctx.bean.role.addRoleRightBatch({ atomClassName: 'dashboard', roleRights });\n      }\n    }\n\n    async test() {}\n  }\n\n  return Version;\n};\n","const versionManager = require('./bean/version.manager.js');\nconst atomDashboard = require('./bean/atom.dashboard.js');\n\nmodule.exports = app => {\n  const beans = {\n    // version\n    'version.manager': {\n      mode: 'app',\n      bean: versionManager,\n    },\n    // atom\n    'atom.dashboard': {\n      mode: 'app',\n      bean: atomDashboard,\n    },\n  };\n  return beans;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {};\n  return config;\n};\n","// error code should start from 1001\nmodule.exports = {};\n","module.exports = {\n  DashboardProfile: 'Dashboard Profile',\n};\n","module.exports = {\n  About: '关于',\n  Dashboard: '仪表板',\n  Dashboards: '仪表板',\n  DashboardProfile: '仪表板配置',\n  'Create Dashboard': '新建仪表板',\n  'Dashboard List': '仪表板列表',\n  'Dashboard Widget': '仪表板部件',\n};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const content = {\n    root: {\n      id: '3f61ffd596d848be9c82d2c07d7dde83',\n      widgets: [\n        {\n          id: '54783c4851524d6088b5eec034b95f77',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: ':business:store' },\n            infoTitle: { type: 1, value: '280' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'New Orders' },\n            backgroundColor: { type: 1, value: '#3F51B5' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n        {\n          id: '4adafa58339848b8b1ea8ab05131ec5a',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: '::stats-chart' },\n            infoTitle: { type: 1, value: '30%' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'Bounce Rate' },\n            backgroundColor: { type: 1, value: '#00897B' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n        {\n          id: 'b23039deef83401facf23a7e5bcccc53',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: '::round-person-add' },\n            infoTitle: { type: 1, value: '50' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'New Users' },\n            backgroundColor: { type: 1, value: '#F57C00' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n        {\n          id: '81103667cb8e402186693c2eae6949f7',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: '::person' },\n            infoTitle: { type: 1, value: '300' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'Visitors' },\n            backgroundColor: { type: 1, value: '#AB47BC' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n      ],\n    },\n  };\n  const dashboard = {\n    atomName: 'Home',\n    atomStaticKey: 'dashboardAnonymous',\n    atomRevision: 12,\n    description: 'Home(Anonymous)',\n    content: JSON.stringify(content),\n    resourceRoles: 'root',\n  };\n  return dashboard;\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const content = {\n    root: {\n      id: 'e341b99ef3bc495db8a8c09e6ad6203f',\n      widgets: [\n        {\n          id: '54783c4851524d6088b5eec034b95f77',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: ':business:store' },\n            infoTitle: { type: 1, value: '280' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'New Orders' },\n            backgroundColor: { type: 1, value: '#3F51B5' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n        {\n          id: '4adafa58339848b8b1ea8ab05131ec5a',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: '::stats-chart' },\n            infoTitle: { type: 1, value: '30%' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'Bounce Rate' },\n            backgroundColor: { type: 1, value: '#00897B' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n        {\n          id: 'b23039deef83401facf23a7e5bcccc53',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: '::round-person-add' },\n            infoTitle: { type: 1, value: '50' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'New Users' },\n            backgroundColor: { type: 1, value: '#F57C00' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n        {\n          id: '81103667cb8e402186693c2eae6949f7',\n          properties: {\n            title: { type: 1, value: '' },\n            height: { type: 1, value: 'auto' },\n            infoIcon: { type: 1, value: '::person' },\n            infoTitle: { type: 1, value: '300' },\n            widthLarge: { type: 1, value: 25 },\n            widthSmall: { type: 1, value: 100 },\n            widthMedium: { type: 1, value: 50 },\n            infoSubTitle: { type: 1, value: 'Visitors' },\n            backgroundColor: { type: 1, value: '#AB47BC' },\n          },\n          atomStaticKey: 'a-dashboardbooster:widgetInfoBox',\n        },\n        {\n          atomStaticKey: 'test-note:widgetNote',\n          id: '878d9687921641de880b130fa0ff5fd0',\n          properties: {\n            demoKey: {\n              type: 1,\n              value: 'demo-1',\n            },\n            height: {\n              type: 1,\n              value: 'auto',\n            },\n            title: {\n              type: 1,\n              value: '',\n            },\n            widthLarge: {\n              type: 1,\n              value: 25,\n            },\n            widthMedium: {\n              type: 1,\n              value: 50,\n            },\n            widthSmall: {\n              type: 1,\n              value: 100,\n            },\n          },\n        },\n        {\n          atomStaticKey: 'test-note:widgetNote',\n          id: '688725d1c2a446fea402580a5af072da',\n          properties: {\n            demoKey: {\n              type: 1,\n              value: 'demo-2',\n            },\n            height: {\n              type: 1,\n              value: 'auto',\n            },\n            title: {\n              type: 1,\n              value: '',\n            },\n            widthLarge: {\n              type: 1,\n              value: 25,\n            },\n            widthMedium: {\n              type: 1,\n              value: 50,\n            },\n            widthSmall: {\n              type: 1,\n              value: 100,\n            },\n          },\n        },\n        {\n          atomStaticKey: 'test-party:widgetSimpleChat',\n          id: '650acfa718f645098bf0516628d678f0',\n          properties: {\n            height: {\n              type: 1,\n              value: 'auto',\n            },\n            title: {\n              type: 1,\n              value: '',\n            },\n            widthLarge: {\n              type: 1,\n              value: 25,\n            },\n            widthMedium: {\n              type: 1,\n              value: 50,\n            },\n            widthSmall: {\n              type: 1,\n              value: 100,\n            },\n          },\n        },\n        {\n          atomStaticKey: 'test-party:widgetAbout',\n          id: '8a04bfa743fb42b2a65a104e018ab924',\n          properties: {\n            height: {\n              type: 1,\n              value: 'auto',\n            },\n            title: {\n              type: 1,\n              value: '',\n            },\n            widthLarge: {\n              type: 1,\n              value: 25,\n            },\n            widthMedium: {\n              type: 1,\n              value: 50,\n            },\n            widthSmall: {\n              type: 1,\n              value: 100,\n            },\n          },\n        },\n      ],\n    },\n  };\n  const dashboard = {\n    atomName: 'Home',\n    atomStaticKey: 'dashboardHome',\n    atomRevision: 23,\n    description: 'Home(Authenticated)',\n    content: JSON.stringify(content),\n    resourceRoles: 'root',\n  };\n  return dashboard;\n};\n","const dashboardAnonymous = require('./dashboard/dashboardAnonymous.js');\nconst dashboardHome = require('./dashboard/dashboardHome.js');\n\nmodule.exports = app => {\n  const dashboards = [dashboardAnonymous(app), dashboardHome(app)];\n  return dashboards;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const resources = [\n    // menu\n    {\n      atomName: 'Create Dashboard',\n      atomStaticKey: 'createDashboard',\n      atomRevision: -1,\n      atomCategoryId: 'a-base:menu.BasicProfile',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'dashboard',\n        atomAction: 'create',\n      }),\n      resourceIcon: '::dashboard',\n      appKey: 'a-appbooster:appSystem',\n      resourceRoles: 'template.system',\n    },\n    {\n      atomName: 'Dashboards',\n      atomStaticKey: 'listDashboard',\n      atomRevision: 2,\n      atomCategoryId: 'a-base:menu.BasicProfile',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'dashboard',\n        atomAction: 'read',\n      }),\n      resourceIcon: '::dashboard',\n      appKey: 'a-appbooster:appSystem',\n      resourceRoles: 'template.system',\n    },\n    // dashboard widget\n    {\n      atomName: 'About',\n      atomStaticKey: 'widgetAbout',\n      atomRevision: -1,\n      atomCategoryId: 'a-dashboard:widget.General',\n      resourceType: 'a-dashboard:widget',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        component: 'widgetAbout',\n      }),\n      resourceRoles: 'root',\n    },\n  ];\n  return resources;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const schemas = {};\n  // dashboard\n  schemas.dashboard = {\n    type: 'object',\n    properties: {\n      atomName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Name',\n        notEmpty: true,\n      },\n      atomStaticKey: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'KeyForAtom',\n        ebReadOnly: true,\n        notEmpty: true,\n      },\n      description: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Description',\n      },\n      content: {\n        type: 'string',\n        ebType: 'component',\n        ebTitle: 'Content',\n        ebRender: {\n          module: moduleInfo.relativeName,\n          name: 'renderDashboardContent',\n        },\n        notEmpty: true,\n      },\n    },\n  };\n  // dashboard search\n  schemas.dashboardSearch = {\n    type: 'object',\n    properties: {\n      description: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Description',\n      },\n    },\n  };\n  return schemas;\n};\n","module.exports = app => {\n  class DashboardController extends app.Controller {\n    async itemByKey() {\n      const res = await this.service.dashboard.itemByKey({\n        atomStaticKey: this.ctx.request.body.atomStaticKey,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async item() {\n      const res = await this.service.dashboard.item({\n        dashboardAtomId: this.ctx.request.body.key.atomId,\n        dashboardUserCheck: this.ctx.request.body.dashboardUserCheck,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async loadItemUser() {\n      const res = await this.service.dashboard.loadItemUser({\n        dashboardUserId: this.ctx.request.body.dashboardUserId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async saveItemUser() {\n      const res = await this.service.dashboard.saveItemUser({\n        dashboardUserId: this.ctx.request.body.dashboardUserId,\n        content: this.ctx.request.body.content,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async changeItemUserName() {\n      const res = await this.service.dashboard.changeItemUserName({\n        dashboardUserId: this.ctx.request.body.dashboardUserId,\n        dashboardName: this.ctx.request.body.dashboardName,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async deleteItemUser() {\n      const res = await this.service.dashboard.deleteItemUser({\n        dashboardUserId: this.ctx.request.body.dashboardUserId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async createItemUser() {\n      const res = await this.service.dashboard.createItemUser({\n        dashboardAtomId: this.ctx.request.body.key.atomId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async itemUsers() {\n      const res = await this.service.dashboard.itemUsers({\n        dashboardAtomId: this.ctx.request.body.key.atomId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async changeItemUserDefault() {\n      const res = await this.service.dashboard.changeItemUserDefault({\n        dashboardAtomId: this.ctx.request.body.key.atomId,\n        dashboardUserId: this.ctx.request.body.dashboardUserId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n  }\n  return DashboardController;\n};\n","const dashboard = require('./controller/dashboard.js');\n\nmodule.exports = app => {\n  const controllers = {\n    dashboard,\n  };\n  return controllers;\n};\n","const config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\n\nmodule.exports = app => {\n  // beans\n  const beans = require('./beans.js')(app);\n  // routes\n  const routes = require('./routes.js')(app);\n  // controllers\n  const controllers = require('./controllers.js')(app);\n  // services\n  const services = require('./services.js')(app);\n  // models\n  const models = require('./models.js')(app);\n  // meta\n  const meta = require('./meta.js')(app);\n\n  return {\n    beans,\n    routes,\n    controllers,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    meta,\n  };\n};\n","module.exports = app => {\n  const schemas = require('./config/validation/schemas.js')(app);\n  const staticDashboards = require('./config/static/dashboards.js')(app);\n  const staticResources = require('./config/static/resources.js')(app);\n  const meta = {\n    base: {\n      atoms: {\n        dashboard: {\n          info: {\n            bean: 'dashboard',\n            title: 'Dashboard',\n            tableName: 'aDashboard',\n            tableNameModes: {\n              full: 'aDashboardViewFull',\n            },\n            inner: true,\n            resource: true,\n            comment: false,\n            attachment: false,\n          },\n          actions: {\n            write: {\n              enableOnStatic: true,\n            },\n          },\n          validator: 'dashboard',\n          search: {\n            validator: 'dashboardSearch',\n          },\n        },\n      },\n      resources: {\n        widget: {\n          title: 'Dashboard Widget',\n        },\n      },\n      statics: {\n        'a-dashboard.dashboard': {\n          items: staticDashboards,\n        },\n        'a-base.resource': {\n          items: staticResources,\n        },\n      },\n    },\n    sequence: {\n      providers: {\n        dashboard: {\n          bean: {\n            module: 'a-sequence',\n            name: 'simple',\n          },\n          start: 0,\n        },\n      },\n    },\n    validation: {\n      validators: {\n        dashboard: {\n          schemas: 'dashboard',\n        },\n        dashboardSearch: {\n          schemas: 'dashboardSearch',\n        },\n      },\n      keywords: {},\n      schemas: {\n        dashboard: schemas.dashboard,\n        dashboardSearch: schemas.dashboardSearch,\n      },\n    },\n  };\n  return meta;\n};\n","module.exports = app => {\n  class Dashboard extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDashboard', options: { disableDeleted: false } });\n    }\n  }\n  return Dashboard;\n};\n","module.exports = app => {\n  class DashboardContent extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDashboardContent', options: { disableDeleted: false } });\n    }\n  }\n  return DashboardContent;\n};\n","module.exports = app => {\n  class DashboardFull extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDashboardViewFull', options: { disableDeleted: false } });\n    }\n  }\n  return DashboardFull;\n};\n","module.exports = app => {\n  class DashboardUser extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aDashboardUser', options: { disableDeleted: false } });\n    }\n  }\n  return DashboardUser;\n};\n","const dashboard = require('./model/dashboard.js');\nconst dashboardContent = require('./model/dashboardContent.js');\nconst dashboardUser = require('./model/dashboardUser.js');\nconst dashboardFull = require('./model/dashboardFull.js');\n\nmodule.exports = app => {\n  const models = {\n    dashboard,\n    dashboardContent,\n    dashboardUser,\n    dashboardFull,\n  };\n  return models;\n};\n","module.exports = app => {\n  const routes = [\n    // dashboard\n    { method: 'post', path: 'dashboard/itemByKey', controller: 'dashboard' },\n    {\n      method: 'post',\n      path: 'dashboard/item',\n      controller: 'dashboard',\n      meta: { right: { type: 'resource', useKey: true } },\n    },\n    { method: 'post', path: 'dashboard/loadItemUser', controller: 'dashboard', meta: { auth: { user: true } } },\n    { method: 'post', path: 'dashboard/saveItemUser', controller: 'dashboard', meta: { auth: { user: true } } },\n    { method: 'post', path: 'dashboard/changeItemUserName', controller: 'dashboard', meta: { auth: { user: true } } },\n    { method: 'post', path: 'dashboard/deleteItemUser', controller: 'dashboard', meta: { auth: { user: true } } },\n    {\n      method: 'post',\n      path: 'dashboard/createItemUser',\n      controller: 'dashboard',\n      meta: { right: { type: 'resource', useKey: true } },\n    },\n    {\n      method: 'post',\n      path: 'dashboard/itemUsers',\n      controller: 'dashboard',\n      meta: { right: { type: 'resource', useKey: true } },\n    },\n    {\n      method: 'post',\n      path: 'dashboard/changeItemUserDefault',\n      controller: 'dashboard',\n      meta: { right: { type: 'resource', useKey: true } },\n    },\n  ];\n  return routes;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Dashboard extends app.Service {\n    get atomClass() {\n      return {\n        module: moduleInfo.relativeName,\n        atomClassName: 'dashboard',\n      };\n    }\n\n    get sequence() {\n      return this.ctx.bean.sequence.module(moduleInfo.relativeName);\n    }\n\n    async itemByKey({ atomStaticKey, user }) {\n      if (!atomStaticKey) return this.ctx.throw.module('a-base', 1002);\n      // get atomId\n      const atomClass = await this.ctx.bean.atomClass.get(this.atomClass);\n      const atom = await this.ctx.bean.atom.modelAtom.get({\n        atomClassId: atomClass.id,\n        atomStaticKey,\n        atomStage: 1,\n      });\n      if (!atom) return this.ctx.throw.module('a-base', 1002);\n      const atomId = atom.id;\n      // check resource right\n      const res = await this.ctx.bean.resource.checkRightResource({ resourceAtomId: atomId, user });\n      if (!res) this.ctx.throw(403);\n      // item\n      return await this.item({ dashboardAtomId: atomId, user });\n    }\n\n    async item({ dashboardAtomId, dashboardUserCheck = true, user }) {\n      // try get default of dashboardUser\n      if (dashboardUserCheck) {\n        const dashboardUser = await this.ctx.model.dashboardUser.get({\n          dashboardAtomId,\n          dashboardDefault: 1,\n          userId: user.id,\n        });\n        if (dashboardUser) {\n          return { dashboardUser };\n        }\n      }\n      // get system\n      const dashboardSystem = await this.ctx.bean.resource.read({\n        key: { atomId: dashboardAtomId },\n        user,\n      });\n      // ok\n      return { dashboardSystem };\n    }\n\n    async loadItemUser({ dashboardUserId, user }) {\n      return await this.ctx.model.dashboardUser.get({\n        id: dashboardUserId,\n        userId: user.id,\n      });\n    }\n\n    async saveItemUser({ dashboardUserId, content, user }) {\n      await this.ctx.model.dashboardUser.update(\n        {\n          content,\n        },\n        {\n          where: {\n            id: dashboardUserId,\n            userId: user.id,\n          },\n        }\n      );\n    }\n\n    async changeItemUserName({ dashboardUserId, dashboardName, user }) {\n      await this.ctx.model.dashboardUser.update(\n        {\n          dashboardName,\n        },\n        {\n          where: {\n            id: dashboardUserId,\n            userId: user.id,\n          },\n        }\n      );\n    }\n\n    async deleteItemUser({ dashboardUserId, user }) {\n      await this.ctx.model.dashboardUser.delete({\n        id: dashboardUserId,\n        userId: user.id,\n      });\n    }\n\n    async createItemUser({ dashboardAtomId, user }) {\n      // get system\n      const dashboardSystem = await this.ctx.bean.resource.read({\n        key: { atomId: dashboardAtomId },\n        user,\n      });\n      // name\n      const id = await this.sequence.next('dashboard');\n      const dashboardName = `${dashboardSystem.atomNameLocale}-${id}`;\n      // update old default\n      await this.ctx.model.dashboardUser.update(\n        {\n          dashboardDefault: 0,\n        },\n        {\n          where: {\n            userId: user.id,\n            dashboardAtomId,\n          },\n        }\n      );\n      // insert\n      const data = {\n        userId: user.id,\n        dashboardDefault: 1,\n        dashboardAtomId,\n        dashboardName,\n        content: dashboardSystem.content,\n      };\n      const res = await this.ctx.model.dashboardUser.insert(data);\n      data.id = res.insertId;\n      // ok\n      return data;\n    }\n\n    async itemUsers({ dashboardAtomId, user }) {\n      return await this.ctx.model.dashboardUser.select({\n        columns: [\n          'id',\n          'createdAt',\n          'updatedAt',\n          'deleted',\n          'iid',\n          'userId',\n          'dashboardDefault',\n          'dashboardAtomId',\n          'dashboardName',\n        ],\n        where: {\n          userId: user.id,\n          dashboardAtomId,\n        },\n        orders: [['dashboardName', 'asc']],\n      });\n    }\n\n    async changeItemUserDefault({ dashboardAtomId, dashboardUserId, user }) {\n      await this.ctx.model.dashboardUser.update(\n        {\n          dashboardDefault: 0,\n        },\n        {\n          where: {\n            userId: user.id,\n            dashboardAtomId,\n          },\n        }\n      );\n      await this.ctx.model.dashboardUser.update({\n        id: dashboardUserId,\n        dashboardDefault: 1,\n      });\n    }\n  }\n\n  return Dashboard;\n};\n","const dashboard = require('./service/dashboard.js');\n\nmodule.exports = app => {\n  const services = {\n    dashboard,\n  };\n  return services;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(421);\n",""],"names":[],"sourceRoot":""}