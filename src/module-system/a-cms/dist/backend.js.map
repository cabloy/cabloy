{"version":3,"sources":["webpack://egg-born-module-a-cms/./backend/src/bean/atom.article.js","webpack://egg-born-module-a-cms/./backend/src/bean/io.message.hotloadFile.js","webpack://egg-born-module-a-cms/./backend/src/bean/local.build.js","webpack://egg-born-module-a-cms/./backend/src/bean/queue.render.js","webpack://egg-born-module-a-cms/./backend/src/bean/startup.registerAllWatchers.js","webpack://egg-born-module-a-cms/./backend/src/bean/version.manager.js","webpack://egg-born-module-a-cms/./backend/src/beans.js","webpack://egg-born-module-a-cms/./backend/src/common/time.js","webpack://egg-born-module-a-cms/./backend/src/common/utils.js","webpack://egg-born-module-a-cms/./backend/src/common/watcher.js","webpack://egg-born-module-a-cms/./backend/src/config/config.js","webpack://egg-born-module-a-cms/./backend/src/config/errors.js","webpack://egg-born-module-a-cms/./backend/src/config/locale/en-us.js","webpack://egg-born-module-a-cms/./backend/src/config/locale/zh-cn.js","webpack://egg-born-module-a-cms/./backend/src/config/locales.js","webpack://egg-born-module-a-cms/./backend/src/config/socketio/hotloadFile.js","webpack://egg-born-module-a-cms/./backend/src/config/static/flowDef/articlePublish.js","webpack://egg-born-module-a-cms/./backend/src/config/static/flowDefs.js","webpack://egg-born-module-a-cms/./backend/src/config/static/resources.js","webpack://egg-born-module-a-cms/./backend/src/config/validation/keywords.js","webpack://egg-born-module-a-cms/./backend/src/config/validation/schemas.js","webpack://egg-born-module-a-cms/./backend/src/controller/article.js","webpack://egg-born-module-a-cms/./backend/src/controller/comment.js","webpack://egg-born-module-a-cms/./backend/src/controller/render.js","webpack://egg-born-module-a-cms/./backend/src/controller/rss.js","webpack://egg-born-module-a-cms/./backend/src/controller/site.js","webpack://egg-born-module-a-cms/./backend/src/controllers.js","webpack://egg-born-module-a-cms/./backend/src/main.js","webpack://egg-born-module-a-cms/./backend/src/meta.js","webpack://egg-born-module-a-cms/./backend/src/model/article.js","webpack://egg-born-module-a-cms/./backend/src/model/content.js","webpack://egg-born-module-a-cms/./backend/src/models.js","webpack://egg-born-module-a-cms/./backend/src/routes.js","webpack://egg-born-module-a-cms/./backend/src/service/render.js","webpack://egg-born-module-a-cms/./backend/src/service/site.js","webpack://egg-born-module-a-cms/./backend/src/services.js","webpack://egg-born-module-a-cms/external \"path\"","webpack://egg-born-module-a-cms/external \"require3\"","webpack://egg-born-module-a-cms/webpack/bootstrap","webpack://egg-born-module-a-cms/webpack/startup"],"names":[],"mappings":";;;;;;;AAAA,iBAAiB,mBAAO,CAAC,GAAU;AACnC;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAkB,wBAAwB;AAC1C;AACA,sCAAsC,wBAAwB;AAC9D;AACA,kEAAkE,mCAAmC;AACrG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,cAAc;AACd;;AAEA,gBAAgB,gCAAgC;AAChD;AACA,qCAAqC,gCAAgC;AACrE;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,kCAAkC;AACpD;AACA,0BAA0B,kCAAkC;AAC5D;AACA;AACA;AACA;AACA;AACA;;AAEA,iBAAiB,8CAA8C;AAC/D;AACA;AACA,qDAAqD,YAAY;AACjE;AACA,yBAAyB,8CAA8C;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,0BAA0B,UAAU,EAAE,SAAS;AAC/C,OAAO;AACP,0BAA0B,aAAa,EAAE,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC;AAChC;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAqC,8BAA8B;AACnE;AACA;AACA,qCAAqC,+BAA+B;AACpE;AACA;AACA;;AAEA,kBAAkB,uBAAuB;AACzC;AACA,qDAAqD,YAAY;;AAEjE;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA,mCAAmC,gDAAgD;AACnF;AACA;AACA,mCAAmC,iDAAiD;AACpF;;AAEA;AACA,0BAA0B,uBAAuB;AACjD;;AAEA,kBAAkB,gCAAgC;AAClD;AACA,iCAAiC,gCAAgC;AACjE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,iCAAiC;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,iBAAiB,GAAG,wBAAwB;AACvE;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,0BAA0B,wBAAwB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,iBAAiB,GAAG,wBAAwB;AACvE;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,uBAAuB,aAAa;AACpC;AACA;AACA,sEAAsE,wBAAwB;AAC9F,mEAAmE,QAAQ,iBAAiB,4BAA4B;AACxH;AACA;AACA;AACA,qDAAqD,aAAa,QAAQ,EAAE;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACnQA;AACA;AACA;AACA;AACA;;;;;;;;ACJA,aAAa,mBAAO,CAAC,GAAM;AAC3B,iBAAiB,mBAAO,CAAC,GAAU;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,mBAAO,CAAC,GAAmB;AACxC,cAAc,mBAAO,CAAC,GAAoB;;AAE1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kCAAkC;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iEAAiE,sBAAsB;AACvF;AACA;;AAEA,yBAAyB,OAAO;AAChC,iEAAiE,sBAAsB;AACvF;AACA;;AAEA,6BAA6B,WAAW;AACxC,4CAA4C,SAAS,cAAc,SAAS,GAAG,sBAAsB;AACrG;AACA;;AAEA,6BAA6B,iBAAiB;AAC9C,4CAA4C,SAAS,cAAc,SAAS,GAAG,sBAAsB;AACrG;AACA;AACA;;AAEA,oCAAoC,WAAW;AAC/C,uCAAuC,WAAW;AAClD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,qBAAqB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D,WAAW;AACtE;AACA,4BAA4B;AAC5B;AACA,SAAS,YAAY,oBAAoB;AACzC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA,2CAA2C,qBAAqB;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,8CAA8C,WAAW;AACzD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,2CAA2C,sBAAsB;AACjE;;AAEA;AACA;AACA;AACA;AACA;AACA,oDAAoD,4BAA4B,KAAK,wBAAwB;AAC7G,kBAAkB,OAAO,EAAE,UAAU,EAAE,qBAAqB,GAAG,YAAY;AAC3E;AACA,gBAAgB,cAAc,EAAE,mDAAmD;AACnF;AACA;AACA;AACA,gBAAgB,QAAQ,EAAE,yDAAyD;AACnF;AACA;AACA;AACA,uBAAuB,QAAQ,GAAG,KAAK;AACvC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,sBAAsB;AACvE;;AAEA;;AAEA,0BAA0B,mCAAmC;AAC7D;AACA;AACA;AACA,uCAAuC,WAAW;AAClD,qBAAqB;AACrB;AACA,gCAAgC,OAAO;AACvC;AACA,kCAAkC,+BAA+B;AACjE;AACA,+BAA+B,OAAO;AACtC;;AAEA,yBAAyB,aAAa;AACtC;AACA,sDAAsD,wBAAwB,6BAA6B,aAAa;AACxH;AACA;AACA;AACA;AACA,uCAAuC,iCAAiC;AACxE;AACA,sDAAsD,OAAO;AAC7D,6BAA6B;AAC7B;AACA,qBAAqB;AACrB;AACA,iCAAiC,gBAAgB;AACjD;AACA;AACA,kCAAkC,gBAAgB;AAClD;AACA,iCAAiC,OAAO;AACxC;AACA;;AAEA,yBAAyB,sBAAsB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,iCAAiC;AACxE;AACA,sDAAsD,OAAO;AAC7D,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,EAAE,qBAAqB,YAAY;AACxE;AACA;AACA;AACA;AACA,iCAAiC,OAAO;AACxC;AACA;;AAEA,2BAA2B,+BAA+B;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,eAAe,cAAc;AAC7B;AACA,OAAO;;AAEP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,mCAAmC,gBAAgB;AACnD;AACA,oCAAoC,kBAAkB;AACtD;AACA,iCAAiC,iBAAiB;AAClD;;AAEA,0BAA0B,gBAAgB;AAC1C;AACA,uCAAuC,OAAO;AAC9C;AACA;AACA;AACA;AACA;AACA,iCAAiC,aAAa;AAC9C;AACA,OAAO;AACP;;AAEA,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA,gBAAgB,iBAAiB;AACjC,OAAO;AACP;AACA;AACA,yCAAyC,OAAO;AAChD;AACA;AACA;AACA;AACA,yBAAyB,UAAU;AACnC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,0BAA0B,iBAAiB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,IAAI;AACf,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yBAAyB,gBAAgB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,IAAI;AACf,eAAe,QAAQ;AACvB;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,qCAAqC,EAAE,qBAAqB,YAAY;AACxE;AACA;AACA;AACA;AACA;AACA,WAAW,IAAI;AACf,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;;;AAGA,yBAAyB,OAAO;AAChC;AACA;AACA;AACA,gBAAgB,iBAAiB;AACjC,OAAO;AACP;AACA;AACA,yCAAyC,OAAO;AAChD;AACA;AACA;AACA;AACA,yBAAyB,UAAU;AACnC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,uBAAuB,uCAAuC;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,iBAAiB;AAC9E,sBAAsB,eAAe,IAAI,WAAW;AACpD;AACA;AACA;AACA;AACA,wCAAwC,gBAAgB;AACxD,2CAA2C,gBAAgB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,cAAc;AACnD;AACA;;AAEA,4BAA4B,cAAc;AAC1C;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,oCAAoC,YAAY;AAChD;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA,0BAA0B,mBAAmB;AAC7C;AACA;AACA;;AAEA,+BAA+B,iBAAiB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,6CAA6C;AACnF;AACA;AACA;AACA,sEAAsE,yBAAyB;AAC/F;AACA;AACA;AACA,gCAAgC,eAAe,qBAAqB,eAAe;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,gBAAgB;AAC1C,yCAAyC,iDAAiD;AAC1F,yCAAyC,+CAA+C;AACxF;AACA;;AAEA,wBAAwB,6BAA6B;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,iBAAiB;AAC3E;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,oDAAoD,+DAA+D;AACnH;AACA;AACA;AACA,qDAAqD,kBAAkB,IAAI,qBAAqB;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,mBAAmB,GAAG,IAAI,GAAG,mBAAmB;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,KAAK;AAC1C;AACA;;AAEA,uBAAuB,gBAAgB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,YAAY;AACrD;AACA,2BAA2B,eAAe,IAAI;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,4FAA4F;AAC5F;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,qDAAqD,qBAAqB,GAAG,qBAAqB;AAClG,WAAW;AACX;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;;;AAGA;;AAEA;AACA,0BAA0B,6BAA6B;AACvD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,uBAAuB,GAAG,wBAAwB;AACzE,aAAa;AACb;;AAEA;AACA,oCAAoC,mDAAmD;AACvF;;AAEA;AACA;AACA,sEAAsE;;AAEtE;AACA;AACA;AACA;AACA;AACA,0BAA0B,2BAA2B,IAAI,eAAe,EAAE,yBAAyB;AACnG,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,gDAAgD,mCAAmC;AACnF;AACA;AACA;AACA;AACA;;AAEA;AACA,yBAAyB,uCAAuC;AAChE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;;AAEA;AACA,yCAAyC,WAAW;;AAEpD;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,SAAS;AAC3B,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,WAAW;AACjC,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB,WAAW;AAC7B,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,iBAAiB;AACnC,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,sBAAsB,iBAAiB;AACvC,aAAa;AACb;AACA,mCAAmC,KAAK;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,SAAS,GAAG,IAAI;AACpC,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA,iCAAiC,OAAO;;AAExC;AACA,uCAAuC,OAAO;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;;AAEA;AACA,mCAAmC,mDAAmD;;AAEtF;AACA;AACA,sEAAsE;;AAEtE;AACA;AACA;AACA;AACA;AACA,0BAA0B,2BAA2B,IAAI,eAAe,EAAE,yBAAyB;AACnG,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,gDAAgD,mCAAmC;AACnF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,WAAW;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;;AAEA,2BAA2B,WAAW;AACtC;AACA,sDAAsD,WAAW;AACjE;AACA;AACA;;AAEA,2BAA2B,WAAW;AACtC;AACA,uCAAuC,WAAW;;AAElD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8BAA8B,OAAO;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW,EAAE,yDAAyD;AACjF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM;AACR;AACA;AACA,8BAA8B,YAAY;AAC1C;;AAEA,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA;AACA;;AAEA,WAAW,WAAW;AACtB;AACA;AACA;AACA,8BAA8B,YAAY;AAC1C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,UAAU;AAC1B,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,6BAA6B,OAAO;AACpC;AACA;AACA;AACA;AACA;;AAEA,yBAAyB,MAAM;AAC/B;AACA,sDAAsD,wBAAwB,6BAA6B,mBAAmB;AAC9H;AACA;AACA,uCAAuC,iCAAiC;AACxE;AACA,sDAAsD,OAAO;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB,iBAAiB,GAAG,wBAAwB,GAAG,4BAA4B;AAC3F;;AAEA,wBAAwB,WAAW;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB,iBAAiB;AACjB,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;;AChrCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,yBAAyB,kCAAkC;AAC3D,8CAA8C,wBAAwB;AACtE,wCAAwC,uBAAuB;AAC/D;;AAEA,0BAA0B,wBAAwB;AAClD,8CAA8C,wBAAwB;AACtE,yCAAyC,aAAa;AACtD;;AAEA,yBAAyB,wBAAwB;AACjD,8CAA8C,wBAAwB;AACtE,wCAAwC,aAAa;AACrD;;AAEA,yBAAyB,iCAAiC;AAC1D,8CAA8C,wBAAwB;AACtE,wCAAwC,sBAAsB;AAC9D;;AAEA;;AAEA;AACA;;;;;;;;ACjCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,wBAAwB;AAC5E;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC9BA,iBAAiB,mBAAO,CAAC,GAAU;AACnC;AACA,cAAc,mBAAO,CAAC,GAAoB;;AAE1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,qEAAqE,uBAAuB;AAC5F,sEAAsE,wBAAwB;AAC9F;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,+CAA+C,8CAA8C;AAC7F;AACA;AACA;;AAEA;AACA;AACA,WAAW,2CAA2C;AACtD,WAAW,sEAAsE;AACjF,WAAW,yDAAyD;AACpE,WAAW,0DAA0D;AACrE,WAAW,yDAAyD;AACpE,WAAW,+CAA+C;AAC1D,WAAW,+CAA+C;AAC1D,WAAW,yEAAyE;AACpF,WAAW,0EAA0E;AACrF,WAAW,gEAAgE;AAC3E,WAAW,kDAAkD;AAC7D;AACA,oDAAoD,uCAAuC;;AAE3F;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,gEAAgE;AACzE,SAAS,gEAAgE;AACzE,SAAS,wEAAwE;AACjF,SAAS,wEAAwE;AACjF,SAAS,oFAAoF;AAC7F,SAAS,wFAAwF;AACjG,SAAS,yFAAyF;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA,2DAA2D,UAAU,EAAE;AACvE;AACA;AACA;AACA;AACA,2BAA2B,wBAAwB;AACnD;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2DAA2D,UAAU,EAAE;AACvE;AACA;AACA;AACA;AACA,2BAA2B,wBAAwB;AACnD;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA,2DAA2D,UAAU,EAAE;AACvE;AACA;AACA;AACA;AACA,2BAA2B,wBAAwB;AACnD;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,4BAA4B;AACzE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sCAAsC,4BAA4B;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,qCAAqC;AACnF;AACA;;AAEA,qCAAqC,qCAAqC;AAC1E;AACA,oBAAoB;AACpB;AACA,sDAAsD,OAAO,yBAAyB,QAAQ;AAC9F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,0CAA0C,uBAAuB;AACjE;AACA;AACA;;AAEA,iCAAiC,iBAAiB;AAClD;AACA,oBAAoB,sBAAsB;AAC1C;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,+CAA+C,uCAAuC;AACtF;AACA;AACA;AACA,sCAAsC,uCAAuC;AAC7E;AACA;AACA;AACA;AACA,kEAAkE,uDAAuD;AACzH;AACA;AACA,oBAAoB,2BAA2B;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC/pBA,uBAAuB,mBAAO,CAAC,GAA2B;AAC1D,mBAAmB,mBAAO,CAAC,GAAuB;AAClD,oBAAoB,mBAAO,CAAC,EAAwB;AACpD,mCAAmC,mBAAO,CAAC,GAAuC;AAClF,oBAAoB,mBAAO,CAAC,EAAwB;AACpD,6BAA6B,mBAAO,CAAC,GAAkC;;AAEvE;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACzCA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,uJAAuJ;AAC7K;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,4CAA4C,IAAI,IAAI,IAAI;AACxD,GAAG;AACH;AACA;AACA,0CAA0C,IAAI,IAAI,IAAI;AACtD,GAAG;AACH;;;;;;;;;ACnCA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb,YAAY;AACZ,YAAY;AACZ,cAAc;AACd,eAAe;AACf;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;;;;;;;;AC/EA,iBAAiB,mBAAO,CAAC,GAAU;AACnC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;;AAEA;AACA;AACA,oCAAoC,4CAA4C;AAChF;;AAEA;AACA;AACA,oCAAoC,qDAAqD;AACzF;;AAEA;AACA,wBAAwB,qBAAqB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe,2CAA2C;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iCAAiC;AACpD,WAAW;AACX,SAAS;AACT;;AAEA;AACA,mBAAmB,iCAAiC;AACpD;AACA;AACA;AACA;AACA,yBAAyB,iBAAiB,GAAG,wBAAwB;AACrE;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;;AAEA;AACA;;;;;;;;AC9GA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnDA;AACA,WAAW,mBAAO,CAAC,GAAmB;AACtC,WAAW,mBAAO,CAAC,EAAmB;AACtC;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7DA,uBAAuB,mBAAO,CAAC,GAA6B;;AAE5D;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;;;;;;;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE,0BAA0B;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,kEAAkE;AAC7F;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;;;;;;;;ACnIA,iBAAiB,mBAAO,CAAC,GAAU;AACnC;AACA,cAAc,mBAAO,CAAC,GAAoB;;AAE1C;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,6CAA6C;AAClG;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;ACvDA,cAAc,mBAAO,CAAC,GAAoB;;AAE1C;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;AC3BA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;ACdA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,WAAW;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,qBAAqB;AACpC,OAAO;AACP;AACA;AACA,8CAA8C,wBAAwB;AACtE;AACA,wCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA,sBAAsB,gBAAgB;AACtC,YAAY,2CAA2C;AACvD,4BAA4B,4CAA4C;AACxE,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA,2BAA2B,qBAAqB;AAChD,iBAAiB,kBAAkB;AACnC,6BAA6B,iBAAiB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD;AACxD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,eAAe,WAAW;AAC1B;AACA;AACA;AACA;AACA;AACA,eAAe,qBAAqB;AACpC,OAAO;AACP;AACA;AACA,8CAA8C,wBAAwB;AACtE;AACA,wCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA,mCAAmC,gBAAgB;AACnD,YAAY,2CAA2C;AACvD,4BAA4B,4CAA4C;AACxE,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA,UAAU,uCAAuC;AACjD;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA,iBAAiB,iBAAiB;AAClC,6BAA6B,gBAAgB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD;AACxD;;AAEA;AACA;AACA;AACA;AACA,sDAAsD,wBAAwB,6BAA6B,OAAO,SAAS,gBAAgB;AAC3I;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,WAAW;AAC1B;AACA;AACA;AACA;AACA;AACA,gBAAgB,SAAS;AACzB;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,2DAA2D,0BAA0B;AACrF;AACA,8CAA8C,wBAAwB;AACtE;AACA,wCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA,mCAAmC,iBAAiB;AACpD,YAAY,0CAA0C;AACtD,4BAA4B,uCAAuC;AACnE,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA,UAAU,0CAA0C;AACpD;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA,iBAAiB,eAAe;AAChC,6BAA6B,cAAc;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD;AACxD;;AAEA;AACA;AACA;;;;;;;;;AChOA,cAAc,mBAAO,CAAC,GAAoB;;AAE1C;AACA;AACA;;AAEA;AACA;AACA,kEAAkE,YAAY;AAC9E,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA,8DAA8D,YAAY;AAC1E,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,kCAAkC;AAClF,wBAAwB,aAAa;AACrC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,wBAAwB;AACzE,wBAAwB,aAAa;AACrC;;AAEA;AACA;AACA,4DAA4D,YAAY;AACxE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;AC/GA,gBAAgB,mBAAO,CAAC,GAAyB;AACjD,eAAe,mBAAO,CAAC,GAAwB;AAC/C,aAAa,mBAAO,CAAC,GAAsB;AAC3C,gBAAgB,mBAAO,CAAC,GAAyB;AACjD,YAAY,mBAAO,CAAC,GAAqB;;AAEzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACfA,eAAe,mBAAO,CAAC,EAAoB;AAC3C,gBAAgB,mBAAO,CAAC,EAAqB;AAC7C,eAAe,mBAAO,CAAC,GAAoB;AAC3C,kBAAkB,mBAAO,CAAC,GAAqB;;AAE/C;;AAEA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB,mBAAO,CAAC,GAAY;AACpC;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD;AACA,mBAAmB,mBAAO,CAAC,GAAe;AAC1C;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,eAAe,mBAAO,CAAC,GAAW;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACrCA;AACA,mBAAmB,mBAAO,CAAC,GAAiC;AAC5D,kBAAkB,mBAAO,CAAC,GAAgC;AAC1D,8BAA8B,mBAAO,CAAC,GAAkC;AACxE,yBAAyB,mBAAO,CAAC,GAA6B;AAC9D,0BAA0B,mBAAO,CAAC,GAA8B;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,WAAW;AACX;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;AC/EA;AACA;AACA;AACA,kBAAkB,iCAAiC,wBAAwB,EAAE;AAC7E;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,kBAAkB,iCAAiC,wBAAwB,EAAE;AAC7E;AACA;AACA;AACA;;;;;;;;ACPA,gBAAgB,mBAAO,CAAC,GAAoB;AAC5C,gBAAgB,mBAAO,CAAC,GAAoB;;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA;AACA;AACA;AACA,KAAK,8DAA8D;AACnE,KAAK,qEAAqE;AAC1E;AACA,KAAK,6DAA6D;AAClE;AACA,KAAK;AACL,aAAa,SAAS,2CAA2C,EAAE;AACnE,KAAK;AACL;AACA,KAAK,4EAA4E,SAAS,2DAA2D,EAAE,EAAE;AACzJ,KAAK,wEAAwE,SAAS,2DAA2D,EAAE,EAAE;AACrJ,KAAK,wEAAwE,SAAS,2DAA2D,EAAE,EAAE;AACrJ,KAAK,mFAAmF,SAAS,2DAA2D,EAAE,EAAE;AAChK,KAAK,4EAA4E,SAAS,2DAA2D,EAAE,EAAE;AACzJ,KAAK,4EAA4E,SAAS,2DAA2D,EAAE,EAAE;AACzJ,KAAK,wEAAwE,SAAS,2DAA2D,EAAE,EAAE;AACrJ,KAAK,yEAAyE,SAAS,2DAA2D,EAAE,EAAE;AACtJ,KAAK,gEAAgE;AACrE,KAAK,0DAA0D;AAC/D,KAAK,6DAA6D;AAClE,KAAK,mEAAmE,SAAS,2DAA2D,EAAE,EAAE;AAChJ;AACA,KAAK,yGAAyG;AAC9G,KAAK,uHAAuH;AAC5H,KAAK,sGAAsG;AAC3G;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AClCA;AACA;AACA;;AAEA,yBAAyB,iBAAiB;AAC1C;AACA,+DAA+D,qBAAqB;AACpF;AACA,8CAA8C,wBAAwB;AACtE,wCAAwC,MAAM;AAC9C;;AAEA;AACA,2BAA2B,6BAA6B;AACxD,8CAA8C,wBAAwB;AACtE,0CAA0C,kBAAkB;AAC5D;;AAEA;;AAEA;AACA;;;;;;;;ACrBA,iBAAiB,mBAAO,CAAC,GAAU;AACnC;;AAEA;;AAEA;AACA;AACA;;AAEA,mBAAmB,+BAA+B;AAClD,8CAA8C,wBAAwB;AACtE,kCAAkC,oBAAoB;AACtD;;AAEA,6BAA6B,YAAY;AACzC,8CAA8C,wBAAwB;AACtE;AACA;;AAEA,yBAAyB,YAAY;AACrC,8CAA8C,wBAAwB;AACtE;AACA;;AAEA;AACA,yBAAyB,kBAAkB;AAC3C;AACA,8CAA8C,wBAAwB;AACtE;AACA,iCAAiC,OAAO;AACxC;AACA;AACA;AACA,kCAAkC,YAAY;AAC9C;AACA;AACA;AACA;;AAEA,oCAAoC,sBAAsB;AAC1D,8CAA8C,wBAAwB;AACtE,mDAAmD,WAAW;AAC9D;;AAEA,6BAA6B,sBAAsB;AACnD,8CAA8C,wBAAwB;AACtE,4CAA4C,WAAW;AACvD;;AAEA;AACA,6BAA6B,4BAA4B;AACzD;AACA,8CAA8C,wBAAwB;AACtE;AACA,qCAAqC,iBAAiB;AACtD;AACA;AACA;AACA,iCAAiC,sBAAsB;AACvD;AACA,qCAAqC,WAAW;AAChD;AACA;;AAEA,wBAAwB,YAAY;AACpC,8CAA8C,wBAAwB;AACtE;AACA;;AAEA,kBAAkB,4BAA4B;AAC9C,8CAA8C,wBAAwB;AACtE,wCAAwC,WAAW;AACnD;AACA;;AAEA,yBAAyB,wBAAwB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,iBAAiB,GAAG,wBAAwB;AACrE;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA,wBAAwB,kCAAkC;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,iBAAiB,GAAG,wBAAwB;AACrE;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA,oBAAoB,uBAAuB;AAC3C;AACA;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;;AAEA,8BAA8B,sBAAsB;AACpD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;;AAEA,qBAAqB,kBAAkB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,iCAAiC,mCAAmC;AACpE;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,qDAAqD;AAC/G;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,iBAAiB;AAC3C;AACA;AACA;AACA,4BAA4B,WAAW,GAAG,IAAI;AAC9C;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACzMA,eAAe,mBAAO,CAAC,EAAqB;AAC5C,aAAa,mBAAO,CAAC,GAAmB;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACTA,kC;;;;;;;;ACAA,sC;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;UCrBA;UACA;UACA;UACA","file":"backend.js","sourcesContent":["const require3 = require('require3');\nconst trimHtml = require3('@zhennann/trim-html');\nconst markdown = require3('@zhennann/markdown');\nconst markdonw_it_block = require3('@zhennann/markdown-it-block');\nconst uuid = require3('uuid');\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Atom extends app.meta.AtomBase {\n\n    async create({ atomClass, item, user }) {\n      // super\n      const key = await super.create({ atomClass, item, user });\n      // article\n      const site = await this.ctx.service.render.combineSiteBase({ atomClass, mergeConfigSite: true });\n      const editMode = site.edit.mode;\n      // add article\n      const params = {\n        atomId: key.atomId,\n        editMode,\n      };\n      // uuid\n      params.uuid = item.uuid || uuid.v4().replace(/-/g, '');\n      // insert\n      const res = await this.ctx.model.article.insert(params);\n      const itemId = res.insertId;\n      // add content\n      await this.ctx.model.content.insert({\n        atomId: key.atomId,\n        itemId,\n        content: '',\n      });\n      return { atomId: key.atomId, itemId };\n    }\n\n    async read({ atomClass, options, key, user }) {\n      // super\n      const item = await super.read({ atomClass, options, key, user });\n      if (!item) return null;\n      // read: showSorting=true\n      this._getMeta(item, true);\n      // ok\n      return item;\n    }\n\n    async select({ atomClass, options, items, user }) {\n      // super\n      await super.select({ atomClass, options, items, user });\n      // select\n      const showSorting = options && options.category;\n      for (const item of items) {\n        this._getMeta(item, showSorting);\n      }\n    }\n\n    async write({ atomClass, target, key, item, options, user }) {\n      const atomStage = item.atomStage;\n      // get atom for safety\n      const atomOld = await this.ctx.bean.atom.read({ key, user });\n      // super\n      await super.write({ atomClass, target, key, item, options, user });\n      // if undefined then old\n      const fields = [ 'atomLanguage', 'slug', 'editMode', 'content', 'sticky', 'keywords', 'description', 'sorting', 'flag', 'extra' ];\n      for (const field of fields) {\n        if (item[field] === undefined) item[field] = atomOld[field];\n      }\n      // clone\n      if (target === 'clone') {\n        item.slug = null; // clear slug\n      }\n      // url\n      let url;\n      const draftExt = atomStage === 0 ? '.draft' : '';\n      if (item.slug) {\n        url = `articles/${item.slug}${draftExt}.html`;\n      } else {\n        url = `articles/${atomOld.uuid}${draftExt}.html`;\n      }\n      // image first\n      let imageFirst = '';\n      if (item.editMode === 1) {\n        const matches = item.content && item.content.match(/!\\[[^\\]]*?\\]\\(([^\\)]*?)\\)/);\n        imageFirst = (matches && matches[1]) || '';\n      }\n      // audio first\n      let audioFirst = '';\n      let audioCoverFirst = '';\n      if (item.editMode === 1) {\n        const matches = item.content && item.content.match(/\\$\\$\\$\\s*cms-pluginblock:audio([\\s\\S]*?)\\$\\$\\$/);\n        let options = matches && matches[1];\n        if (options) {\n          options = global.JSON5.parse(options);\n          if (options && options.audio) {\n            if (Array.isArray(options.audio)) {\n              audioFirst = options.audio[0].url;\n              audioCoverFirst = options.audio[0].cover;\n            } else {\n              audioFirst = options.audio.url;\n              audioCoverFirst = options.audio.cover;\n            }\n          }\n        }\n      }\n      // markdown\n      const md = markdown.create();\n      // markdown-it-block\n      const blocks = this.ctx.service.site.getBlocks();\n      // block options\n      const blockOptions = {\n        utils: {\n          text: (...args) => {\n            return this.ctx.text.locale(item.atomLanguage, ...args);\n          },\n        },\n        blocks,\n      };\n      md.use(markdonw_it_block, blockOptions);\n      // html\n      let html;\n      if (item.editMode === 1) {\n        html = item.content ? md.render(item.content) : '';\n      } else {\n        html = item.content || '';\n      }\n      // summary\n      const summary = trimHtml(html, this.ctx.config.article.trim);\n      // update article\n      await this.ctx.model.article.update({\n        id: key.itemId,\n        sticky: item.sticky,\n        keywords: item.keywords,\n        description: item.description,\n        summary: summary.html,\n        url,\n        editMode: item.editMode,\n        slug: item.slug,\n        sorting: item.sorting,\n        flag: item.flag,\n        extra: item.extra || '{}',\n        imageFirst,\n        audioFirst,\n        audioCoverFirst,\n      });\n      // update content\n      await this.ctx.model.query('update aCmsContent a set a.content=?, a.html=? where a.iid=? and a.atomId=?',\n        [ item.content, html, this.ctx.instance.id, key.atomId ]);\n\n      // render\n      const ignoreRender = options && options.ignoreRender;\n      if (!ignoreRender) {\n        if (atomStage === 0) {\n          await this._renderArticle({ atomClass, key, inner: true });\n        }\n        if (atomStage === 1) {\n          await this._renderArticle({ atomClass, key, inner: false });\n        }\n      }\n    }\n\n    async delete({ atomClass, key, user }) {\n      // get atom for safety\n      const atomOld = await this.ctx.bean.atom.read({ key, user });\n\n      // delete article\n      await this.ctx.model.article.delete({\n        id: key.itemId,\n      });\n      // delete content\n      await this.ctx.model.content.delete({\n        itemId: key.itemId,\n      });\n\n      // delete article\n      if (atomOld.atomStage === 0) {\n        await this._deleteArticle({ atomClass, key, article: atomOld, inner: true });\n      }\n      if (atomOld.atomStage === 1) {\n        await this._deleteArticle({ atomClass, key, article: atomOld, inner: false });\n      }\n\n      // super\n      await super.delete({ atomClass, key, user });\n    }\n\n    async submit({ atomClass, key, options, user }) {\n      // super\n      return await super.submit({ atomClass, key, options, user });\n    }\n\n    _getMeta(item, showSorting) {\n      // flags\n      const flags = [];\n      if (item.sticky) flags.push(this.ctx.text('Sticky'));\n      if (item.sorting && showSorting) flags.push(item.sorting);\n      // meta\n      const meta = {\n        summary: item.summary,\n        flags,\n      };\n      // ok\n      item._meta = meta;\n    }\n\n    async _deleteArticle({ atomClass, key, article, inner }) {\n      this.ctx.tail(async () => {\n        // queue\n        await this.ctx.app.meta.queue.pushAsync({\n          locale: this.ctx.locale,\n          subdomain: this.ctx.subdomain,\n          module: moduleInfo.relativeName,\n          queueName: 'render',\n          queueNameSub: `${atomClass.module}:${atomClass.atomClassName}`,\n          data: {\n            queueAction: 'deleteArticle',\n            atomClass, key, article, inner,\n          },\n        });\n      });\n    }\n\n    async _renderArticle({ atomClass, key, inner }) {\n      this.ctx.tail(async () => {\n        // queue\n        await this.ctx.app.meta.queue.pushAsync({\n          locale: this.ctx.locale,\n          subdomain: this.ctx.subdomain,\n          module: moduleInfo.relativeName,\n          queueName: 'render',\n          queueNameSub: `${atomClass.module}:${atomClass.atomClassName}`,\n          data: {\n            queueAction: 'renderArticle',\n            atomClass, key, inner,\n          },\n        });\n      });\n    }\n\n    async _getArticle({ key, inner }) {\n      if (!inner) {\n        // check right\n        const roleAnonymous = await this.ctx.bean.role.getSystemRole({ roleName: 'anonymous' });\n        const right = await this.ctx.bean.atom.checkRoleRightRead({ atom: { id: key.atomId }, roleId: roleAnonymous.id });\n        if (!right) return null;\n      }\n      // article\n      const article = await this.ctx.bean.atom.read({ key, user: { id: 0 } });\n      if (!article) return null;\n      // check atomLanguage\n      if (!article.atomLanguage) {\n        article.atomLanguage = this.ctx.locale;\n        // return null;\n        // this.ctx.throw(1001);\n      }\n      return article;\n    }\n\n  }\n\n  return Atom;\n};\n","module.exports = ctx => {\n  class IOMessage extends ctx.app.meta.IOMessageBase(ctx) {\n  }\n  return IOMessage;\n};\n","const path = require('path');\nconst require3 = require('require3');\nconst ejs = require3('@zhennann/ejs');\nconst pMap = require3('p-map');\nconst extend = require3('extend2');\nconst fse = require3('fs-extra');\nconst moment = require3('moment');\nconst glob = require3('glob');\nconst bb = require3('bluebird');\nconst CleanCSS = require3('clean-css');\nconst shajs = require3('sha.js');\nconst babel = require3('@babel/core');\nconst UglifyJS = require3('uglify-js');\nconst less = require3('less');\nconst time = require('../common/time.js');\nconst utils = require('../common/utils.js');\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Build extends app.meta.BeanBase {\n\n    constructor(ctx, atomClass) {\n      super(ctx);\n      this.atomClass = utils.atomClass(atomClass);\n      this.default = this.atomClass.module === 'a-cms';\n    }\n\n    async getConfigSiteBase() {\n      // config\n      //    try other then default\n      let configSite = this.ctx.config.module(this.atomClass.module).site;\n      if (!configSite) {\n        configSite = this.ctx.config.site;\n      }\n\n      // site\n      const site = extend(true, {}, configSite);\n\n      // plugins\n      site.plugins = {};\n      for (const relativeName in this.app.meta.modules) {\n        const module = this.app.meta.modules[relativeName];\n        if (module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.plugin) {\n          site.plugins[relativeName] = this.ctx.config.module(relativeName).plugin;\n        }\n      }\n      return site;\n    }\n\n    async getConfigSite() {\n      const name = this.default ? 'config-site' : `config-site:${this.atomClass.module}`;\n      return await this.ctx.bean.status.get(name);\n    }\n\n    async setConfigSite({ data }) {\n      const name = this.default ? 'config-site' : `config-site:${this.atomClass.module}`;\n      await this.ctx.bean.status.set(name, data);\n    }\n\n    async getConfigLanguage({ language }) {\n      const name = this.default ? `config-${language}` : `config-${language}:${this.atomClass.module}`;\n      return await this.ctx.bean.status.get(name);\n    }\n\n    async setConfigLanguage({ language, data }) {\n      const name = this.default ? `config-${language}` : `config-${language}:${this.atomClass.module}`;\n      this._adjustConfigLanguange(data);\n      await this.ctx.bean.status.set(name, data);\n    }\n\n    async getConfigLanguagePreview({ language }) {\n      const site = await this.getSite({ language });\n      this._adjustConfigLanguange(site);\n      return site;\n    }\n\n    _adjustConfigLanguange(data) {\n      if (data) {\n        data.host = undefined;\n        data.language = undefined;\n        data.themes = undefined;\n      }\n    }\n\n    async getLanguages() {\n      const siteBase = await this.combineSiteBase();\n      const languages = [];\n      for (const item of siteBase.language.items.split(',')) {\n        languages.push({\n          title: this.ctx.text(item),\n          value: item,\n        });\n      }\n      return languages;\n    }\n\n    // site<plugin<theme<site(db)<language(db)\n    async combineSiteBase(options) {\n      const mergeConfigSite = options && options.mergeConfigSite;\n      // site\n      let site = await this.getConfigSiteBase();\n      // site(db) special for language/themes\n      const configSite = await this.getConfigSite();\n      if (configSite) {\n        if (mergeConfigSite) {\n          site = extend(true, site, configSite);\n        } else {\n          if (configSite.language) site.language = configSite.language;\n          if (configSite.themes) site.themes = configSite.themes;\n        }\n      }\n      return site;\n    }\n\n    // site<plugin<theme<site(db)<language(db)\n    async combineSite({ siteBase, language }) {\n      // themeModuleName\n      const themeModuleName = siteBase.themes[language];\n      if (!themeModuleName) {\n        this.ctx.throw(1002, this.atomClass.module, this.atomClass.atomClassName, language);\n      }\n      // theme\n      const theme = this.combineThemes(themeModuleName);\n      // site(db)\n      const configSite = await this.getConfigSite();\n      // language(db)\n      const configLanguage = await this.getConfigLanguage({ language });\n      // combine\n      return extend(true, {},\n        siteBase, theme, configSite, configLanguage,\n        { language: { current: language } }\n      );\n    }\n\n    // theme extend\n    combineThemes(themeModuleName) {\n      return this._combineThemes(themeModuleName);\n    }\n\n    _combineThemes(themeModuleName) {\n      // module\n      const module = this.app.meta.modules[themeModuleName];\n      if (!module) this.ctx.throw(1003, themeModuleName);\n      const moduleExtend = module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.extend;\n      if (!moduleExtend) return this.ctx.config.module(themeModuleName).theme;\n      return extend(true, {},\n        this._combineThemes(moduleExtend),\n        this.ctx.config.module(themeModuleName).theme\n      );\n    }\n\n    // site<plugin<theme<site(db)<language(db)\n    async getSite({ language, options }) {\n      // options\n      options = options || {};\n      // base\n      const siteBase = await this.combineSiteBase();\n      // site\n      const site = await this.combineSite({ siteBase, language });\n      // serverUrl\n      site.serverUrl = this.getServerUrl('');\n      // atomClass\n      site.atomClass = this.atomClass;\n      // languages\n      site.languages = [];\n      for (const item of site.language.items.split(',')) {\n        site.languages.push({\n          name: item,\n          title: this.ctx.text.locale(item, item),\n          url: this.getUrl(site, item, 'index.html'),\n        });\n      }\n      // front\n      site.front = {};\n      // front.env\n      site.front.env = extend(true, {\n        base: site.base,\n        language: site.language,\n      }, site.env, {\n        site: {\n          serverUrl: site.serverUrl,\n          rawRootUrl: this.getUrlRawRoot(site),\n          atomClass: this.atomClass,\n        },\n      });\n      // front.envs\n      if (options.envs !== false) {\n        const envs = await this.getFrontEnvs({ language });\n        if (Object.keys(envs).length > 0) {\n          site.front.envs = envs;\n        }\n      }\n\n      // ok\n      return site;\n    }\n\n    // ////////////////////////////// url or path\n\n    getCMSPathName() {\n      return this.default ? 'cms' : `cms.${this.atomClass.module}`;\n    }\n\n    getUrlRawRoot(site) {\n      if (this.ctx.app.meta.isTest || this.ctx.app.meta.isLocal) {\n        // cms or cms.moduleName\n        const cmsPathName = this.getCMSPathName();\n        const publicDir = this.ctx.app.config.static.prefix + 'public/';\n        const prefix = this.ctx.bean.base.host ? `${this.ctx.bean.base.protocol}://${this.ctx.bean.base.host}` : '';\n        return `${prefix}${publicDir}${this.ctx.instance.id}/${cmsPathName}/dist`;\n      }\n      return `${site.host.url}${site.host.rootPath ? '/' + site.host.rootPath : ''}`;\n    }\n    getUrlRoot(site, language) {\n      const rawRoot = this.getUrlRawRoot(site);\n      return `${rawRoot}${language === site.language.default ? '' : '/' + language}`;\n    }\n    getUrl(site, language, path) {\n      const urlRoot = this.getUrlRoot(site, language);\n      return path ? `${urlRoot}/${path}` : urlRoot;\n    }\n    getServerUrl(path) {\n      return this.ctx.bean.base.getAbsoluteUrl(path);\n    }\n\n    async getPathCustom(language) {\n      const cms = await this.getPathCms();\n      return path.join(cms, language, 'custom');\n    }\n    async getPathIntermediate(language) {\n      const cms = await this.getPathCms();\n      return path.join(cms, language, 'intermediate');\n    }\n    async getPathDist(site, language) {\n      const rawDist = await this.getPathRawDist();\n      return path.join(rawDist, language === site.language.default ? '' : '/' + language);\n    }\n    async getPathCms() {\n      // cms\n      return await this.ctx.bean.base.getPath(this.getCMSPathName());\n    }\n    async getPathRawDist() {\n      // cms/dist\n      return await this.ctx.bean.base.getPath(`${this.getCMSPathName()}/dist`);\n    }\n\n    // ///////////////////////////////// render\n\n    async renderAllFiles({ language, progressId, progressNo }) {\n      // clearCache\n      ejs.clearCache();\n      // site\n      const site = await this.getSite({ language });\n      site.render = { scene: 'all' };\n      // render static\n      await this._renderStatic({ site });\n      // render articles\n      await this._renderArticles({ site, progressId, progressNo });\n      // render index\n      await this._renderIndex({ site });\n    }\n\n    async renderArticle({ key, inner }) {\n      // article\n      const article = await this.ctx.bean._getBean(`${moduleInfo.relativeName}.atom.article`)._getArticle({ key, inner });\n      if (!article) return;\n      // clearCache\n      ejs.clearCache();\n      // site\n      const site = await this.getSite({ language: article.atomLanguage });\n      // check if build site first\n      const siteBuilt = await this._checkIfSiteBuilt({ site });\n      if (!siteBuilt) return; // not throw error\n      // render scene\n      site.render = { scene: 'single', inner };\n      // render article\n      await this._renderArticle({ site, article });\n      if (!inner) {\n        // write sitemap\n        await this._writeSitemap({ site, article });\n        // render index\n        await this._renderIndex({ site });\n      }\n    }\n\n    async deleteArticle({ key, article, inner }) {\n      // maybe not rendered\n      if (!article.url) return;\n      // same logic with renderArticle\n      if (!article.atomLanguage) {\n        article.atomLanguage = this.ctx.locale;\n      }\n      // clearCache\n      ejs.clearCache();\n      // site\n      const site = await this.getSite({ language: article.atomLanguage });\n      // check if build site first\n      const siteBuilt = await this._checkIfSiteBuilt({ site });\n      if (!siteBuilt) return; // not throw error\n      // remove file\n      const pathDist = await this.getPathDist(site, article.atomLanguage);\n      await fse.remove(path.join(pathDist, article.url));\n      if (!inner) {\n        // remove sitemap\n        let xml = await fse.readFile(path.join(pathDist, 'sitemap.xml'));\n        const regexp = new RegExp(` {2}<url>\\\\s+<loc>[^<]*${article.url}[^<]*</loc>[\\\\s\\\\S]*?</url>[\\\\r\\\\n]`);\n        xml = xml.toString().replace(regexp, '');\n        // save\n        await fse.writeFile(path.join(pathDist, 'sitemap.xml'), xml);\n        // render index\n        await this._renderIndex({ site });\n      }\n    }\n\n    async _renderArticles({ site, progressId, progressNo }) {\n      // anonymous user\n      const user = await this.ctx.bean.user.anonymous();\n      // articles\n      const articles = await this.ctx.bean.atom.select({\n        atomClass: this.atomClass,\n        options: {\n          language: site.language.current,\n          orders: [[ 'a.updatedAt', 'desc' ]],\n          page: null,\n          mode: 'search',\n          stage: 'formal',\n        },\n        user: { id: user.id },\n        pageForce: false,\n      });\n\n      // progress\n      const progress1_Total = articles.length;\n      let progress1_progress = 0;\n\n      // concurrency\n      const mapper = async article => {\n        // progress: initialize\n        if (progressId) {\n          await this.ctx.bean.progress.update({\n            progressId,\n            progressNo,\n            total: progress1_Total,\n            progress: progress1_progress++,\n            text: article.atomName,\n          });\n        }\n        // render article\n        await this._renderArticle({ site, article });\n      };\n      await pMap(articles, mapper, { concurrency: 10 });\n      // write sitemap\n      await this._writeSitemaps({ site, articles });\n    }\n\n    async _renderArticle({ site, article }) {\n      // data\n      const data = await this.getData({ site });\n      data.article = article;\n      // render\n      await this._renderFile({\n        fileSrc: 'main/article.ejs',\n        fileDest: article.url,\n        fileDestAlt: `articles/${article.uuid}.html`,\n        data,\n      });\n    }\n\n    async _renderIndex({ site }) {\n      // index\n      const pathIntermediate = await this.getPathIntermediate(site.language.current);\n      const indexFiles = await bb.fromCallback(cb => {\n        glob(`${pathIntermediate}/main/index/\\*\\*/\\*.ejs`, cb);\n      });\n      for (const item of indexFiles) {\n        // data\n        const data = await this.getData({ site });\n        // path\n        const _fileSrc = item.substr(pathIntermediate.length + 1);\n        let _fileDest = _fileSrc.substr('main/index/'.length).replace('.ejs', '');\n        if (_fileDest.indexOf('.') === -1) {\n          _fileDest = `${_fileDest}.html`;\n        }\n        await this._renderFile({\n          fileSrc: _fileSrc,\n          fileDest: _fileDest,\n          data,\n        });\n      }\n    }\n\n    async _writeSitemaps({ site, articles }) {\n      // xml\n      let xml =\n`<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n`;\n      for (const article of articles) {\n        const loc = this.getUrl(site, site.language.current, article.url);\n        const lastmod = moment(article.updatedAt).format();\n        xml +=\n`  <url>\n    <loc>${loc}</loc>\n    <lastmod>${lastmod}</lastmod>\n  </url>\n`;\n      }\n      xml += '</urlset>';\n      // save\n      const pathDist = await this.getPathDist(site, site.language.current);\n      const fileName = path.join(pathDist, 'sitemap.xml');\n      await fse.writeFile(fileName, xml);\n    }\n\n    async _writeSitemap({ site, article }) {\n      const loc = this.getUrl(site, site.language.current, article.url);\n      const lastmod = moment(article.updatedAt).format();\n      // load\n      const pathDist = await this.getPathDist(site, site.language.current);\n      const fileName = path.join(pathDist, 'sitemap.xml');\n      let xml;\n      const exists = await fse.pathExists(fileName);\n      if (!exists) {\n        xml =\n`<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url>\n    <loc>${loc}</loc>\n    <lastmod>${lastmod}</lastmod>\n  </url>\n</urlset>`;\n      } else {\n        xml = await fse.readFile(fileName);\n        xml = xml.toString();\n        // remove\n        const regexp = new RegExp(` {2}<url>\\\\s+<loc>[^<]*${article.url}[^<]*</loc>[\\\\s\\\\S]*?</url>[\\\\r\\\\n]`);\n        xml = xml.replace(regexp, '');\n        // append\n        xml = xml.replace('<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">',\n          `<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url>\n    <loc>${loc}</loc>\n    <lastmod>${lastmod}</lastmod>\n  </url>`);\n      }\n      // save\n      await fse.writeFile(fileName, xml);\n    }\n\n\n    async _renderStatic({ site }) {\n      // static\n      const pathIntermediate = await this.getPathIntermediate(site.language.current);\n      const staticFiles = await bb.fromCallback(cb => {\n        glob(`${pathIntermediate}/static/\\*\\*/\\*.ejs`, cb);\n      });\n      for (const item of staticFiles) {\n        // data\n        const data = await this.getData({ site });\n        // path\n        const _fileSrc = item.substr(pathIntermediate.length + 1);\n        let _fileDest = _fileSrc.replace('.ejs', '');\n        if (_fileDest.indexOf('.') === -1) {\n          _fileDest = `${_fileDest}.html`;\n        }\n        await this._renderFile({\n          fileSrc: _fileSrc,\n          fileDest: _fileDest,\n          data,\n        });\n      }\n    }\n\n    async _renderFile({ fileSrc, fileDest, fileDestAlt, data }) {\n      // site\n      const site = data.site;\n      // language\n      const language = site.language.current;\n      // src\n      const pathIntermediate = await this.getPathIntermediate(language);\n      const fileName = path.join(pathIntermediate, fileSrc);\n      // dest\n      const pathDist = await this.getPathDist(site, language);\n      const fileWrite = path.join(pathDist, fileDest);\n      // data\n      data._filename = fileName;\n      data._path = fileSrc.replace('.ejs', '');\n      // env site\n      data.env('site.path', data._path);\n      // destFile for hot load\n      let hotloadFile;\n      if ((this.app.meta.isTest || this.app.meta.isLocal) && fileDest.indexOf('.html') > -1) {\n        hotloadFile = fileWrite;\n        data.env('site.hotloadFile', hotloadFile);\n      }\n      // load src\n      let contentSrc = await fse.readFile(fileName);\n      contentSrc = contentSrc ? contentSrc.toString() : '';\n      // load includes of plugins\n      const pluginIncludes = await this._loadPluginIncludes({ site, language });\n      contentSrc = `${pluginIncludes}\\n${contentSrc}`;\n      // render\n      const options = this.getOptions();\n      options.filename = fileName;\n      let content = await ejs.render(contentSrc, data, options);\n      content = await this._renderEnvs({ data, content });\n      content = await this._renderCSSJSes({ data, content });\n      // write\n      await fse.outputFile(fileWrite, content);\n      // alternative url\n      if (fileDestAlt && fileDestAlt !== fileDest) {\n        const fileWriteAlt = path.join(pathDist, fileDestAlt);\n        await fse.outputFile(fileWriteAlt, content);\n      }\n      // socketio publish\n      if (hotloadFile) {\n        await this._socketioPublish({ hotloadFile });\n      }\n    }\n\n    async _socketioPublish({ hotloadFile }) {\n      const message = {\n        userIdTo: -1,\n        content: {\n          mtime: new Date(),\n        },\n      };\n      await this.ctx.bean.io.publish({\n        path: `/a/cms/hotloadFile/${hotloadFile}`,\n        message,\n        messageClass: {\n          module: 'a-cms',\n          messageClassName: 'hotloadFile',\n        },\n      });\n    }\n\n    _checkIfPluginEnable({ site, moduleName }) {\n      const config = site.plugins[moduleName];\n      return !config || config.enable !== false;\n    }\n\n    async _loadPluginIncludes({ site, language }) {\n      // if exists\n      if (site._pluginIncludes) return site._pluginIncludes;\n      // modulesArray\n      let pluginIncludes = '';\n      for (const module of this.app.meta.modulesArray) {\n        if (module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.plugin\n        && this._checkIfPluginEnable({ site, moduleName: module.info.relativeName })\n        ) {\n          // path intermediate\n          const pathIntermediate = await this.getPathIntermediate(language);\n          let incudeFileName = path.join(pathIntermediate, `plugins/${module.info.relativeName}/include.ejs`);\n          const exists = await fse.pathExists(incudeFileName);\n          if (exists) {\n            incudeFileName = incudeFileName.replace(/\\\\/g, '\\\\\\\\');\n            pluginIncludes = `${pluginIncludes}<%- await include('${incudeFileName}') %>\\n`;\n          }\n        }\n      }\n      // ok\n      site._pluginIncludes = pluginIncludes;\n      return site._pluginIncludes;\n    }\n\n    async _renderCSSJSes({ data, content }) {\n      content = await this._renderCSSJS({ data, content, type: 'CSS', items: data._csses });\n      content = await this._renderCSSJS({ data, content, type: 'JS', items: data._jses });\n      return content;\n    }\n\n    async _renderCSSJS({ data, content, type, items }) {\n      if (items.length === 0) return content;\n      // site\n      const site = data.site;\n      // cache\n      if (!site._cache) site._cache = {};\n      if (!site._cache[type])site._cache[type] = {};\n      const cacheSha = shajs('sha256').update(items.join(',')).digest('hex');\n      let urlDest;\n      if (site._cache[type][cacheSha]) {\n        urlDest = site._cache[type][cacheSha];\n      } else {\n        // combine\n        let result = '';\n        for (const item of items) {\n          let _content;\n          if (path.extname(item) === '.ejs') {\n          // data\n            data._filename = item;\n            _content = await ejs.renderFile(item, data, this.getOptions());\n          } else {\n            _content = await fse.readFile(item);\n            _content = _content ? _content.toString() : '';\n          }\n          // minify\n          if (type === 'CSS') {\n            let _needMinify = false;\n            if (item.indexOf('.less') > -1) {\n            // less\n              const output = await less.render(_content, { filename: item });\n              _content = output.css;\n              _needMinify = true;\n            } else if (item.indexOf('.min.css') === -1) {\n            // normal\n              _needMinify = true;\n            }\n            if (_needMinify) {\n            // minify\n              const output = new CleanCSS().minify(_content);\n              _content = output.styles;\n            }\n          } else {\n            if (item.indexOf('.min.js') === -1) {\n              _content = babel.transform(_content, { ast: false, babelrc: false, presets: [ '@babel/preset-env' ] }).code;\n              // not minify for test/dev\n              if (!this.ctx.app.meta.isTest && !this.ctx.app.meta.isLocal) {\n                const output = UglifyJS.minify(_content);\n                if (output.error) throw new Error(`${output.error.name}: ${output.error.message}`);\n                _content = output.code;\n              }\n            }\n          }\n          // append\n          result += _content + '\\n';\n        }\n        // save\n        const sha = shajs('sha256').update(result).digest('hex');\n        // dest\n        const fileDest = `assets/${type.toLowerCase()}/${sha}.${type.toLowerCase()}`;\n        const pathDist = await this.getPathDist(site, site.language.current);\n        const fileWrite = path.join(pathDist, fileDest);\n        // write\n        await fse.outputFile(fileWrite, result);\n        // url\n        urlDest = this.getUrl(site, site.language.current, fileDest);\n        // cache\n        site._cache[type][cacheSha] = urlDest;\n      }\n      // replace\n      const regexp = new RegExp(`__${type}__`);\n      return content.replace(regexp, urlDest);\n    }\n\n    async _renderEnvs({ data, content }) {\n      // site\n      const site = data.site;\n      // env\n      const _env = {};\n      for (const name of Object.keys(data._envs)) {\n        let value;\n        const keys = name.split('.');\n        for (let index = keys.length - 1; index >= 0; index--) {\n          const key = keys[index];\n          value = value ? { [key]: value } : { [key]: data._envs[name] };\n        }\n        extend(true, _env, value);\n      }\n      // combine\n      const env = extend(true, site.front.env, _env);\n      // front.envs\n      if (site.front.envs) {\n        env.envs = site.front.envs;\n      }\n      // article\n      if (data.article) {\n        env.article = extend(true, {}, data.article);\n        // delete\n        env.article.summary = undefined;\n        env.article.content = undefined;\n        env.article.html = undefined;\n        env.article.contentSearch = undefined;\n      }\n      // replace\n      const text = `\n<script type=\"text/javascript\">\nvar env=${JSON.stringify(env, null, 2)};\n</script>\n`;\n      const regexp = new RegExp('__ENV__');\n      const res = content.replace(regexp, text);\n      // remove article\n      env.article = undefined;\n      // ok\n      return res;\n    }\n\n    resolvePath(pathRoot, fileCurrent, fileName) {\n      if (!fileName) return pathRoot;\n      if (fileName.charAt(0) === '.') return path.join(path.dirname(fileCurrent), fileName); // not use path.resolve\n      return path.join(pathRoot, fileName);\n    }\n\n    getOptions() {\n      return {\n        async: true,\n        cache: true,\n        compileDebug: this.ctx.app.meta.isTest || this.ctx.app.meta.isLocal,\n        outputFunctionName: 'echo',\n        rmWhitespace: true,\n      };\n    }\n\n    async getData({ site }) {\n      // data\n      const self = this;\n      const _csses = [];\n      const _jses = [];\n      const _envs = {};\n      let _pathIntermediate = await this.getPathIntermediate(site.language.current);\n      _pathIntermediate = path.join(_pathIntermediate, '/');\n      return {\n        ctx: self.ctx,\n        site,\n        _csses,\n        _jses,\n        _envs,\n        require(fileName) {\n          const _path = self.resolvePath('', this._filename, fileName);\n          return require3(_path);\n        },\n        url(fileName, language) {\n          if (fileName && (fileName.indexOf('http://') === 0 || fileName.indexOf('https://') === 0)) return utils.escapeURL(fileName);\n          let _path = self.resolvePath('', path.relative(_pathIntermediate, this._filename), fileName);\n          _path = _path.replace(/\\\\/gi, '/');\n          const _url = self.getUrl(site, language || site.language.current, _path);\n          return utils.escapeURL(_url);\n        },\n        css(fileName) {\n          _csses.push(self.resolvePath(_pathIntermediate, this._filename, fileName));\n        },\n        js(fileName) {\n          _jses.push(self.resolvePath(_pathIntermediate, this._filename, fileName));\n        },\n        env(name, value) {\n          _envs[name] = value;\n        },\n        text(...args) {\n          return this.ctx.text.locale(site.language.current, ...args);\n        },\n        util: {\n          time,\n          formatDateTime(date) {\n            return this.time.formatDateTime(date, `${site.env.format.date} ${site.env.format.time}`);\n          },\n          safeHtml(str) {\n            return self.ctx.helper.shtml(str);\n          },\n          escapeHtml(str) {\n            return utils.escapeHtml(str);\n          },\n          escapeURL(str) {\n            return utils.escapeURL(str);\n          },\n        },\n      };\n    }\n\n\n    // //////////////////////////////// build\n\n    // build languages\n    async buildLanguages({ progressId, progressNo = 0 }) {\n      try {\n        // time start\n        const timeStart = new Date();\n        // site\n        const site = await this.combineSiteBase();\n        const languages = site.language.items.split(',');\n\n        // progress\n        const progress0_Total = languages.length;\n        let progress0_progress = 0;\n\n        for (const language of languages) {\n          // progress: language\n          if (progressId) {\n            await this.ctx.bean.progress.update({\n              progressId,\n              progressNo,\n              total: progress0_Total,\n              progress: progress0_progress++,\n              text: `${this.ctx.text('Build')} ${this.ctx.text(language)}`,\n            });\n          }\n\n          // build\n          await this.buildLanguage({ language, progressId, progressNo: progressNo + 1 });\n        }\n\n        // time end\n        const timeEnd = new Date();\n        const time = (timeEnd.valueOf() - timeStart.valueOf()) / 1000; // second\n\n        // progress: done\n        if (progressId) {\n          if (progressNo === 0) {\n            await this.ctx.bean.progress.done({\n              progressId,\n              message: `${this.ctx.text('Time Used')}: ${parseInt(time)}${this.ctx.text('second2')}`,\n            });\n          }\n        }\n\n        // ok\n        return {\n          time,\n        };\n      } catch (err) {\n        // error\n        if (progressId) {\n          if (progressNo === 0) {\n            await this.ctx.bean.progress.error({ progressId, message: err.message });\n          }\n        }\n        throw err;\n      }\n    }\n\n    // build language\n    async buildLanguage({ language, progressId, progressNo = 0 }) {\n      try {\n        // time start\n        const timeStart = new Date();\n\n        // progress\n        const progress0_Total = 2;\n        let progress0_progress = 0;\n        // progress: initialize\n        if (progressId) {\n          await this.ctx.bean.progress.update({\n            progressId,\n            progressNo,\n            total: progress0_Total,\n            progress: progress0_progress++,\n            text: this.ctx.text('Initialize'),\n          });\n        }\n\n        // site\n        const site = await this.getSite({ language });\n\n        // / clear\n\n        // intermediate\n        const pathIntermediate = await this.getPathIntermediate(language);\n        await fse.remove(pathIntermediate);\n\n        // dist\n        const pathDist = await this.getPathDist(site, language);\n        //   solution: 1\n        // const distPaths = [ 'articles', 'assets', 'plugins', 'static', 'index.html', 'robots.txt', 'sitemap.xml', 'sitemapindex.xml' ];\n        // for (const item of distPaths) {\n        //   await fse.remove(path.join(pathDist, item));\n        // }\n        //   solution: 2\n        const distFiles = await bb.fromCallback(cb => {\n          glob(`${pathDist}/\\*`, cb);\n        });\n        const languages = site.language.items.split(',');\n        for (const item of distFiles) {\n          if (languages.indexOf(path.basename(item)) === -1) {\n            await fse.remove(item);\n          }\n        }\n\n        // / copy files to intermediate\n        // /  plugins<theme<custom\n\n        // plugins\n        for (const relativeName in this.app.meta.modules) {\n          const module = this.app.meta.modules[relativeName];\n          if (module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.plugin) {\n            const pluginPath = path.join(module.root, 'backend/cms/plugin');\n            const pluginFiles = await bb.fromCallback(cb => {\n              glob(`${pluginPath}/\\*`, cb);\n            });\n            for (const item of pluginFiles) {\n              await fse.copy(item, path.join(pathIntermediate, 'plugins', relativeName, path.basename(item)));\n            }\n          }\n        }\n\n        // theme\n        if (!site.themes[language]) this.ctx.throw(1002, this.atomClass.module, this.atomClass.atomClassName, language);\n        await this.copyThemes(pathIntermediate, site.themes[language]);\n\n        // custom\n        const customPath = await this.getPathCustom(language);\n        const customFiles = await bb.fromCallback(cb => {\n          glob(`${customPath}/\\*`, cb);\n        });\n        for (const item of customFiles) {\n          await fse.copy(item, path.join(pathIntermediate, path.basename(item)));\n        }\n\n        // intermediate dist\n        const intermediateDistFiles = await bb.fromCallback(cb => {\n          glob(`${pathIntermediate}/dist/\\*`, cb);\n        });\n        for (const item of intermediateDistFiles) {\n          await fse.copy(item, path.join(pathDist, path.basename(item)));\n        }\n\n        // / copy files to dist (ignore .ejs)\n        // /  assets plugins/[plugin]/assets\n        for (const dir of [ 'assets', 'plugins' ]) {\n          if (dir === 'assets') {\n            // assets\n            const _filename = path.join(pathIntermediate, 'assets');\n            const exists = await fse.pathExists(_filename);\n            if (exists) {\n              await fse.copy(_filename, path.join(pathDist, 'assets'));\n            }\n          } else {\n            // plugins\n            const pluginsFiles = await bb.fromCallback(cb => {\n              glob(`${pathIntermediate}/plugins/\\*`, cb);\n            });\n            for (const item of pluginsFiles) {\n              const _filename = `${item}/assets`;\n              const exists = await fse.pathExists(_filename);\n              if (exists) {\n                await fse.copy(_filename, path.join(pathDist, 'plugins', path.basename(item), 'assets'));\n              }\n            }\n          }\n          // delete ejs files\n          const ejsFiles = await bb.fromCallback(cb => {\n            glob(`${pathDist}/${dir}/\\*\\*/\\*.ejs`, cb);\n          });\n          for (const item of ejsFiles) {\n            await fse.remove(item);\n          }\n        }\n\n        // / robots.txt\n        await this.createRobots({ site });\n\n        // / sitemapIndex\n        await this.createSitemapIndex({ site });\n\n        // progress: render files\n        if (progressId) {\n          await this.ctx.bean.progress.update({\n            progressId,\n            progressNo,\n            total: progress0_Total,\n            progress: progress0_progress++,\n            text: this.ctx.text('Render Files'),\n          });\n        }\n\n        // render all files\n        await this.renderAllFiles({ language, progressId, progressNo: progressNo + 1 });\n\n        // time end\n        const timeEnd = new Date();\n        const time = (timeEnd.valueOf() - timeStart.valueOf()) / 1000; // second\n\n        // progress: done\n        if (progressId) {\n          if (progressNo === 0) {\n            await this.ctx.bean.progress.done({\n              progressId,\n              message: `${this.ctx.text('Time Used')}: ${parseInt(time)}${this.ctx.text('second2')}`,\n            });\n          }\n        }\n\n        // ok\n        return {\n          time,\n        };\n      } catch (err) {\n        // error\n        if (progressId) {\n          if (progressNo === 0) {\n            await this.ctx.bean.progress.error({ progressId, message: err.message });\n          }\n        }\n        throw err;\n      }\n    }\n\n    // register watchers\n    async registerWatchers() {\n      // info\n      const watcherInfos = [];\n      // site\n      const site = await this.combineSiteBase();\n      const languages = site.language.items.split(',');\n      // loop languages\n      for (const language of languages) {\n      // info\n        const watcherInfo = await this._collectWatcher({ language });\n        watcherInfos.push(watcherInfo);\n      }\n      // register\n      this.app.meta['a-cms:watcher'].registerLanguages({\n        info: {\n          subdomain: this.ctx.subdomain,\n          atomClass: this.atomClass,\n        },\n        watcherInfos,\n      });\n    }\n\n    async registerWatcher({ language }) {\n      // info\n      const watcherInfo = await this._collectWatcher({ language });\n      // register\n      this.app.meta['a-cms:watcher'].register(watcherInfo);\n    }\n\n    async _collectWatcher({ language }) {\n      // site\n      const site = await this.getSite({ language });\n\n      // watcher\n      site._watchers = [];\n\n      // / files\n      // /  plugins<theme<custom\n\n      // plugins\n      for (const relativeName in this.app.meta.modules) {\n        const module = this.app.meta.modules[relativeName];\n        if (!module.info.public && module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.plugin) {\n          site._watchers.push(path.join(module.root, 'backend/cms'));\n        // site._watchers.push(path.join(module.root, 'backend/src'));\n        }\n      }\n\n      // theme\n      if (!site.themes[language]) this.ctx.throw(1002, this.atomClass.module, this.atomClass.atomClassName, language);\n      this.watcherThemes(site, site.themes[language]);\n\n      // custom\n      const customPath = await this.getPathCustom(language);\n      site._watchers.push(customPath);\n\n      // watcherInfo\n      return {\n        subdomain: this.ctx.subdomain,\n        atomClass: this.atomClass,\n        language,\n        watchers: site._watchers,\n      };\n    }\n\n    async createSitemapIndex({ site }) {\n      // content\n      const urlRawRoot = this.getUrlRawRoot(site);\n      let items = '';\n      for (const language of site.language.items.split(',')) {\n        items +=\n`  <sitemap>\n    <loc>${urlRawRoot}${language === site.language.default ? '' : '/' + language}/sitemap.xml</loc>\n  </sitemap>\n`;\n      }\n      const content =\n`<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n${items}</sitemapindex>`;\n      // write\n      const pathRawDist = await this.getPathRawDist(site);\n      await fse.outputFile(`${pathRawDist}/sitemapindex.xml`, content);\n    }\n\n    async createRobots({ site }) {\n      // content\n      const urlRawRoot = this.getUrlRawRoot(site);\n      const content =\n`User-agent: *\nAllow: /\n\nSitemap: ${urlRawRoot}/sitemapindex.xml\n`;\n      // write\n      const pathRawDist = await this.getPathRawDist(site);\n      await fse.outputFile(`${pathRawDist}/robots.txt`, content);\n    }\n\n    // theme extend\n    async copyThemes(pathIntermediate, themeModuleName) {\n      await this._copyThemes(pathIntermediate, themeModuleName);\n    }\n\n    async _copyThemes(pathIntermediate, themeModuleName) {\n      // module\n      const module = this.app.meta.modules[themeModuleName];\n      if (!module) this.ctx.throw(1003, themeModuleName);\n      // extend\n      const moduleExtend = module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.extend;\n      if (moduleExtend) {\n        await this._copyThemes(pathIntermediate, moduleExtend);\n      }\n      // current\n      const themePath = path.join(module.root, 'backend/cms/theme');\n      const themeFiles = await bb.fromCallback(cb => {\n        glob(`${themePath}/\\*`, cb);\n      });\n      for (const item of themeFiles) {\n        await fse.copy(item, path.join(pathIntermediate, path.basename(item)));\n      }\n    }\n\n    // theme extend\n    watcherThemes(site, themeModuleName) {\n      this._watcherThemes(site, themeModuleName);\n    }\n\n    _watcherThemes(site, themeModuleName) {\n      // module\n      const module = this.app.meta.modules[themeModuleName];\n      if (!module) this.ctx.throw(1003, themeModuleName);\n      // extend\n      const moduleExtend = module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.extend;\n      if (moduleExtend) {\n        this._watcherThemes(site, moduleExtend);\n      }\n      // current\n      if (!module.info.public) {\n        site._watchers.push(path.join(module.root, 'backend/cms'));\n      // site._watchers.push(path.join(module.root, 'backend/src'));\n      }\n    }\n\n    async _checkIfSiteBuilt({ site }) {\n      // check if build site first\n      const pathIntermediate = await this.getPathIntermediate(site.language.current);\n      const fileName = path.join(pathIntermediate, 'main/article.ejs');\n      return await fse.pathExists(fileName);\n    }\n\n    async getArticleUrl({ key }) {\n      // article\n      const article = await this.ctx.bean._getBean(`${moduleInfo.relativeName}.atom.article`)._getArticle({ key, inner: true });\n      if (!article) this.ctx.throw.module('a-base', 1002);\n      // site\n      const site = await this.getSite({ language: article.atomLanguage });\n      // check if build site first\n      const siteBuilt = await this._checkIfSiteBuilt({ site });\n      if (!siteBuilt) this.ctx.throw(1006);\n      // url\n      return {\n        relativeUrl: article.url,\n        url: this.getUrl(site, site.language.current, article.url),\n      };\n    }\n\n    getAtomClassFullName(atomClass) {\n      return `${atomClass.module}:${atomClass.atomClassName}:${atomClass.atomClassIdParent}`;\n    }\n\n    async getFrontEnvs({ language }) {\n      const envs = {};\n      for (const module of this.ctx.app.meta.modulesArray) {\n        if (module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.site) {\n          // may be more atoms\n          for (const key in module.main.meta.base.atoms) {\n            if (module.main.meta.base.atoms[key].info.cms !== true) continue;\n            // atomClass\n            const atomClass = {\n              module: module.info.relativeName,\n              atomClassName: key,\n              atomClassIdParent: 0,\n            };\n            const atomClassFullName = this.getAtomClassFullName(atomClass);\n            if (this.getAtomClassFullName(this.atomClass) !== atomClassFullName) {\n              // getSite\n              let site;\n              try {\n                site = await this.ctx.service.site.getSite({\n                  atomClass,\n                  language,\n                  options: {\n                    envs: false,\n                  },\n                });\n              } catch (e) {\n              // nothing\n              }\n              // set\n              if (site) {\n                envs[atomClassFullName] = site.front.env;\n              }\n            }\n          }\n        }\n      }\n      return envs;\n    }\n\n  }\n\n  return Build;\n};\n\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Queue extends app.meta.BeanBase {\n\n    async execute(context) {\n      const data = context.data;\n      const queueAction = data.queueAction;\n      return await this[queueAction](data);\n    }\n\n    async buildLanguage({ atomClass, language, progressId }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.buildLanguage({ language, progressId });\n    }\n\n    async buildLanguages({ atomClass, progressId }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.buildLanguages({ progressId });\n    }\n\n    async renderArticle({ atomClass, key, inner }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.renderArticle({ key, inner });\n    }\n\n    async deleteArticle({ atomClass, key, article, inner }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.deleteArticle({ key, article, inner });\n    }\n\n  }\n\n  return Queue;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Startup extends app.meta.BeanBase {\n\n    async execute() {\n      // only in development\n      if (!app.meta.isLocal) return;\n      // loop modules\n      for (const module of app.meta.modulesArray) {\n        // cms.site=true\n        if (module.package.eggBornModule && module.package.eggBornModule.cms && module.package.eggBornModule.cms.site) {\n          // loop atomClasses\n          for (const key in module.main.meta.base.atoms) {\n            if (module.main.meta.base.atoms[key].info.cms === false) continue;\n            // atomClass\n            const atomClass = {\n              module: module.info.relativeName,\n              atomClassName: key,\n              atomClassIdParent: 0,\n            };\n            const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n            await build.registerWatchers();\n          }\n        }\n      }\n    }\n\n  }\n\n  return Startup;\n};\n","const require3 = require('require3');\nconst uuid = require3('uuid');\nconst utils = require('../common/utils.js');\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Version extends app.meta.BeanBase {\n\n    async update(options) {\n      if (options.version === 1) {\n        // create table: aCmsArticle\n        let sql = `\n          CREATE TABLE aCmsArticle (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            categoryId int(11) DEFAULT '0',\n            language varchar(50) DEFAULT NULL,\n            sticky int(11) DEFAULT '0',\n            keywords varchar(255) DEFAULT NULL,\n            description text DEFAULT NULL,\n            summary text DEFAULT NULL,\n            url varchar(255) DEFAULT NULL,\n            editMode int(11) DEFAULT '0',\n            slug varchar(255) DEFAULT NULL,\n            sorting int(11) DEFAULT '0',\n            flag varchar(255) DEFAULT NULL,\n            extra json DEFAULT NULL,\n            imageFirst varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aCmsContent\n        sql = `\n          CREATE TABLE aCmsContent (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            itemId int(11) DEFAULT '0',\n            content LONGTEXT DEFAULT NULL,\n            html LONGTEXT DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aCmsCategory\n        sql = `\n          CREATE TABLE aCmsCategory (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            categoryName varchar(50) DEFAULT NULL,\n            language varchar(50) DEFAULT NULL,\n            catalog int(11) DEFAULT '0',\n            hidden int(11) DEFAULT '0',\n            sorting int(11) DEFAULT '0',\n            flag varchar(255) DEFAULT NULL,\n            categoryIdParent int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create view: aCmsArticleView\n        sql = `\n          CREATE VIEW aCmsArticleView as\n            select a.*,b.categoryName from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n        `;\n        await this.ctx.model.query(sql);\n\n        // create view: aCmsArticleViewFull\n        sql = `\n          CREATE VIEW aCmsArticleViewFull as\n            select a.*,b.categoryName,c.content,c.html,concat(d.atomName,',',c.content) contentSearch from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsContent c on a.id=c.itemId\n              left join aAtom d on a.atomId=d.id\n        `;\n        await this.ctx.model.query(sql);\n\n      }\n\n      if (options.version === 2) {\n        // create table: aCmsTag\n        let sql = `\n          CREATE TABLE aCmsTag (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            language varchar(50) DEFAULT NULL,\n            tagName varchar(50) DEFAULT NULL,\n            articleCount int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aCmsArticleTag\n        sql = `\n          CREATE TABLE aCmsArticleTag (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            itemId int(11) DEFAULT '0',\n            tags JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aCmsArticleTagRef\n        sql = `\n          CREATE TABLE aCmsArticleTagRef (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            itemId int(11) DEFAULT '0',\n            tagId int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleView\n        await this.ctx.model.query('drop view aCmsArticleView');\n        sql = `\n          CREATE VIEW aCmsArticleView as\n            select a.*,b.categoryName,e.tags from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleViewFull\n        await this.ctx.model.query('drop view aCmsArticleViewFull');\n        sql = `\n          CREATE VIEW aCmsArticleViewFull as\n            select a.*,b.categoryName,e.tags,c.content,c.html from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsContent c on a.id=c.itemId\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // create view: aCmsArticleViewSearch\n        sql = `\n          CREATE VIEW aCmsArticleViewSearch as\n            select a.*,b.categoryName,e.tags,c.content,c.html,concat(d.atomName,',',c.content) contentSearch from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsContent c on a.id=c.itemId\n              left join aAtom d on a.atomId=d.id\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // create view: aCmsArticleViewTag\n        sql = `\n          CREATE VIEW aCmsArticleViewTag as\n            select a.*,b.categoryName,e.tags,f.tagId from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsArticleTag e on a.id=e.itemId\n              left join aCmsArticleTagRef f on a.id=f.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n      }\n\n      if (options.version === 3) {\n        // alter table: aCmsArticle\n        let sql = `\n        ALTER TABLE aCmsArticle\n          ADD COLUMN audioFirst varchar(255) DEFAULT NULL,\n          ADD COLUMN audioCoverFirst varchar(255) DEFAULT NULL\n                  `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleView\n        await this.ctx.model.query('drop view aCmsArticleView');\n        sql = `\n          CREATE VIEW aCmsArticleView as\n            select a.*,b.categoryName,e.tags from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleViewFull\n        await this.ctx.model.query('drop view aCmsArticleViewFull');\n        sql = `\n          CREATE VIEW aCmsArticleViewFull as\n            select a.*,b.categoryName,e.tags,c.content,c.html from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsContent c on a.id=c.itemId\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleViewSearch\n        await this.ctx.model.query('drop view aCmsArticleViewSearch');\n        sql = `\n          CREATE VIEW aCmsArticleViewSearch as\n            select a.*,b.categoryName,e.tags,c.content,c.html,concat(d.atomName,',',c.content) contentSearch from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsContent c on a.id=c.itemId\n              left join aAtom d on a.atomId=d.id\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleViewTag\n        await this.ctx.model.query('drop view aCmsArticleViewTag');\n        sql = `\n          CREATE VIEW aCmsArticleViewTag as\n            select a.*,b.categoryName,e.tags,f.tagId from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsArticleTag e on a.id=e.itemId\n              left join aCmsArticleTagRef f on a.id=f.itemId\n        `;\n        await this.ctx.model.query(sql);\n      }\n\n      if (options.version === 4) {\n        // alter table: aCmsCategory\n        const sql = `\n        ALTER TABLE aCmsCategory\n          ADD COLUMN url varchar(255) DEFAULT NULL\n                  `;\n        await this.ctx.model.query(sql);\n      }\n\n      if (options.version === 5) {\n        // alter table: aCmsCategory\n        let sql = `\n        ALTER TABLE aCmsCategory\n          ADD COLUMN atomClassId int(11) DEFAULT '0'\n                  `;\n        await this.ctx.model.query(sql);\n        // alter table: aCmsTag\n        sql = `\n        ALTER TABLE aCmsTag\n          ADD COLUMN atomClassId int(11) DEFAULT '0'\n                  `;\n        await this.ctx.model.query(sql);\n\n        // atomClass\n        await this._update5AtomClassIds(options);\n\n      }\n\n      if (options.version === 6) {\n        // alter table: aCmsArticle\n        let sql = `\n        ALTER TABLE aCmsArticle\n          ADD COLUMN uuid varchar(50) DEFAULT NULL\n                  `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleView\n        await this.ctx.model.query('drop view aCmsArticleView');\n        sql = `\n          CREATE VIEW aCmsArticleView as\n            select a.*,b.categoryName,e.tags from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleViewFull\n        await this.ctx.model.query('drop view aCmsArticleViewFull');\n        sql = `\n          CREATE VIEW aCmsArticleViewFull as\n            select a.*,b.categoryName,e.tags,c.content,c.html from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsContent c on a.id=c.itemId\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleViewSearch\n        await this.ctx.model.query('drop view aCmsArticleViewSearch');\n        sql = `\n          CREATE VIEW aCmsArticleViewSearch as\n            select a.*,b.categoryName,e.tags,c.content,c.html,concat(d.atomName,',',c.content) contentSearch from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsContent c on a.id=c.itemId\n              left join aAtom d on a.atomId=d.id\n              left join aCmsArticleTag e on a.id=e.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // alter view: aCmsArticleViewTag\n        await this.ctx.model.query('drop view aCmsArticleViewTag');\n        sql = `\n          CREATE VIEW aCmsArticleViewTag as\n            select a.*,b.categoryName,e.tags,f.tagId from aCmsArticle a\n              left join aCmsCategory b on a.categoryId=b.id\n              left join aCmsArticleTag e on a.id=e.itemId\n              left join aCmsArticleTagRef f on a.id=f.itemId\n        `;\n        await this.ctx.model.query(sql);\n\n        // uuid\n        await this._update6Uuids(options);\n\n      }\n\n      if (options.version === 7) {\n        // update cms blocks\n        await this.ctx.model.query(`\n          update aCmsContent set content = replace (content,'cms-pluginblock:audio','cms-pluginblock:blockAudio') where content like '%cms-pluginblock:audio%'\n        `);\n        await this.ctx.model.query(`\n          update aCmsContent set content = replace (content,'cms-pluginblock:iframe','cms-pluginblock:blockIFrame') where content like '%cms-pluginblock:iframe%'\n        `);\n        // migration: languange/category/tag\n        await this._update7Migration(options);\n      }\n\n      if (options.version === 8) {\n        // schemas\n        await this._update7Migration_schemas(options);\n      }\n\n    }\n\n    async init(options) {\n      if (options.version === 1) {\n        // create roles: cms-writer cms-publisher to template\n        const roles = [ 'cms-writer', 'cms-publisher' ];\n        const roleTemplate = await this.ctx.bean.role.getSystemRole({ roleName: 'template' });\n        const roleSuperuser = await this.ctx.bean.role.getSystemRole({ roleName: 'superuser' });\n        for (const roleName of roles) {\n          const roleId = await this.ctx.bean.role.add({\n            roleName,\n            roleIdParent: roleTemplate.id,\n          });\n          // role:superuser include cms-writer cms-publisher\n          await this.ctx.bean.role.addRoleInc({ roleId: roleSuperuser.id, roleIdInc: roleId });\n        }\n        // build roles\n        await this.ctx.bean.role.setDirty(true);\n\n        // add role rights\n        const roleRights = [\n          { roleName: 'cms-writer', action: 'create' },\n          { roleName: 'cms-writer', action: 'read', scopeNames: 'authenticated' },\n          { roleName: 'cms-writer', action: 'write', scopeNames: 0 },\n          { roleName: 'cms-writer', action: 'delete', scopeNames: 0 },\n          { roleName: 'cms-writer', action: 'clone', scopeNames: 0 },\n          { roleName: 'cms-writer', action: 'deleteBulk' },\n          { roleName: 'cms-writer', action: 'exportBulk' },\n          { roleName: 'cms-publisher', action: 'read', scopeNames: 'authenticated' },\n          { roleName: 'cms-publisher', action: 'write', scopeNames: 'authenticated' },\n          { roleName: 'root', action: 'read', scopeNames: 'authenticated' },\n          { roleName: 'root', action: 'read', scopeNames: 0 },\n        ];\n        await this.ctx.bean.role.addRoleRightBatch({ atomClassName: 'article', roleRights });\n\n      }\n\n    }\n\n    async test() {\n      const atomClass = {\n        module: moduleInfo.relativeName,\n        atomClassName: 'article',\n      };\n      const categories = [\n        { categoryName: 'test1', language: 'en-us', categoryIdParent: 0 },\n        { categoryName: 'test2', language: 'en-us', categoryIdParent: 0 },\n        { categoryName: 'test2-1', language: 'en-us', categoryIdParent: 'test2' },\n        { categoryName: 'test2-2', language: 'en-us', categoryIdParent: 'test2' },\n        { categoryName: 'test3', language: 'en-us', categoryIdParent: 0, categorySorting: 1 },\n        { categoryName: 'testHidden', language: 'en-us', categoryIdParent: 0, categoryHidden: 1 },\n        { categoryName: 'testFlag', language: 'en-us', categoryIdParent: 0, categoryFlag: 'Flag' },\n      ];\n      const categoryIds = {};\n      for (const item of categories) {\n        // add\n        const categoryId = await this.ctx.bean.category.add({\n          atomClass,\n          data: {\n            language: item.language,\n            categoryName: item.categoryName,\n            categoryHidden: item.categoryHidden,\n            categorySorting: item.categorySorting,\n            categoryFlag: item.categoryFlag,\n            categoryIdParent: item.categoryIdParent ? categoryIds[item.categoryIdParent] : 0,\n          },\n        });\n        categoryIds[item.categoryName] = categoryId;\n      }\n    }\n\n    async _update5AtomClassIds(options) {\n      // all instances\n      const instances = await this.ctx.bean.instance.list({ where: {} });\n      for (const instance of instances) {\n        await this.ctx.executeBean({\n          subdomain: instance.name,\n          beanModule: moduleInfo.relativeName,\n          beanFullName: `${moduleInfo.relativeName}.version.manager`,\n          context: options,\n          fn: '_update5AtomClassIdsInstance',\n        });\n      }\n    }\n\n    async _update5AtomClassIdsInstance() {\n      const atomClass = await utils.atomClass2(this.ctx, null);\n      // update aCmsCategory's atomClassId\n      await this.ctx.model.query(\n        `update aCmsCategory set atomClassId=?\n             where iid=?`,\n        [ atomClass.id, this.ctx.instance.id ]);\n      // update aCmsTag's atomClassId\n      await this.ctx.model.query(\n        `update aCmsTag set atomClassId=?\n             where iid=?`,\n        [ atomClass.id, this.ctx.instance.id ]);\n    }\n\n    async _update6Uuids(options) {\n      // all instances\n      const instances = await this.ctx.bean.instance.list({ where: {} });\n      for (const instance of instances) {\n        await this.ctx.executeBean({\n          subdomain: instance.name,\n          beanModule: moduleInfo.relativeName,\n          beanFullName: `${moduleInfo.relativeName}.version.manager`,\n          context: options,\n          fn: '_update6UuidsInstance',\n        });\n      }\n    }\n\n    async _update6UuidsInstance() {\n      const articles = await this.ctx.model.article.select();\n      for (const article of articles) {\n        const uuid = this._parseUuid(article);\n        await this.ctx.model.article.update({\n          id: article.id,\n          uuid,\n        });\n      }\n    }\n\n    async _update7Migration(options) {\n      // all instances\n      const instances = await this.ctx.bean.instance.list({ where: {} });\n      for (const instance of instances) {\n        await this.ctx.executeBean({\n          subdomain: instance.name,\n          beanModule: moduleInfo.relativeName,\n          beanFullName: `${moduleInfo.relativeName}.version.manager`,\n          context: options,\n          fn: '_update7MigrationInstance',\n        });\n      }\n    }\n\n    async _update7MigrationInstance() {\n      // cagetories\n      const mapCagetoryIds = await this._update7Migration_cagetories();\n      // tags\n      const mapTagIds = await this._update7Migration_tags();\n      // articles/post\n      await this._update7Migration_articles({ mapCagetoryIds, mapTagIds });\n    }\n\n    async _update7Migration_schemas() {\n      let sql;\n      // aCmsArticle\n      sql = `\n        ALTER TABLE aCmsArticle\n          DROP COLUMN categoryId,\n          DROP COLUMN language\n        `;\n      await this.ctx.model.query(sql);\n      // aCmsArticleTag\n      sql = 'DROP TABLE aCmsArticleTag';\n      await this.ctx.model.query(sql);\n      // aCmsArticleTagRef\n      sql = 'DROP TABLE aCmsArticleTagRef';\n      await this.ctx.model.query(sql);\n      // aCmsCategory\n      sql = 'DROP TABLE aCmsCategory';\n      await this.ctx.model.query(sql);\n      // aCmsTag\n      sql = 'DROP TABLE aCmsTag';\n      await this.ctx.model.query(sql);\n      // aCmsArticleView\n      sql = 'DROP VIEW aCmsArticleView';\n      await this.ctx.model.query(sql);\n      // aCmsArticleViewFull\n      await this.ctx.model.query('drop view aCmsArticleViewFull');\n      sql = `\n          CREATE VIEW aCmsArticleViewFull as\n            select a.*,b.content,b.html from aCmsArticle a\n              left join aCmsContent b on a.id=b.itemId\n        `;\n      await this.ctx.model.query(sql);\n      // aCmsArticleViewSearch\n      await this.ctx.model.query('drop view aCmsArticleViewSearch');\n      sql = `\n          CREATE VIEW aCmsArticleViewSearch as\n            select a.*,b.content,b.html,concat(c.atomName,',',b.content) contentSearch from aCmsArticle a\n              left join aCmsContent b on a.id=b.itemId\n              left join aAtom c on a.atomId=c.id\n        `;\n      await this.ctx.model.query(sql);\n      // aCmsArticleViewTag\n      await this.ctx.model.query('drop view aCmsArticleViewTag');\n    }\n\n    async _update7Migration_articles({ mapCagetoryIds, mapTagIds }) {\n      // articles\n      const articles = await this.ctx.model.query(`\n        select a.*,b.userIdCreated,c.tags\n           from aCmsArticle a\n           left join aAtom b on b.id=a.atomId\n           left join aCmsArticleTag c on c.atomId=a.atomId\n            where a.iid=? and a.deleted=0 and b.atomStage=1\n        `, [ this.ctx.instance.id ]);\n      // loop\n      for (const article of articles) {\n        await this._update7Migration_article({ mapCagetoryIds, mapTagIds, article });\n      }\n    }\n\n    async _update7Migration_article({ mapCagetoryIds, mapTagIds, article }) {\n      // user\n      const user = { id: article.userIdCreated };\n      // open\n      const res = await this.ctx.bean.atom.openDraft({ key: { atomId: article.atomId }, user });\n      const draftKey = res.draft.key;\n      // atomCategoryId\n      const atomCategoryId = article.categoryId === 0 ? 0 : mapCagetoryIds[article.categoryId];\n      // atomTags\n      let atomTags = article.tags;\n      if (article.tags) {\n        const _tags = JSON.parse(article.tags);\n        atomTags = _tags.map(item => {\n          return mapTagIds[item.id];\n        });\n        atomTags = JSON.stringify(atomTags);\n      }\n      // write\n      await this.ctx.bean.atom.write({\n        key: draftKey,\n        target: null,\n        item: {\n          atomLanguage: article.language,\n          atomCategoryId,\n          atomTags,\n        },\n        options: {\n          ignoreRender: true,\n        },\n        user,\n      });\n      // submit\n      await this.ctx.bean.atom.submit({\n        key: draftKey,\n        options: {\n          ignoreRender: true,\n          ignoreFlow: true,\n        },\n        user,\n      });\n    }\n\n    async _update7Migration_tags() {\n      const mapTagIds = {};\n      const tags = await this.ctx.model.select('aCmsTag', {\n        where: {\n          iid: this.ctx.instance.id,\n          deleted: 0,\n        },\n      });\n      for (const tag of tags) {\n        await this._update7Migration_tag({ mapTagIds, tags, tag });\n      }\n      return mapTagIds;\n    }\n\n    async _update7Migration_tag({ mapTagIds, tag }) {\n      const tagIdNew = await this.ctx.bean.tag.add({\n        atomClass: { id: tag.atomClassId },\n        data: {\n          language: tag.language,\n          tagName: tag.tagName,\n          tagAtomCount: tag.articleCount,\n        },\n      });\n      mapTagIds[tag.id] = tagIdNew;\n      return tagIdNew;\n    }\n\n    async _update7Migration_cagetories() {\n      const mapCagetoryIds = {};\n      const categories = await this.ctx.model.select('aCmsCategory', {\n        where: {\n          iid: this.ctx.instance.id,\n          deleted: 0,\n        },\n      });\n      for (const category of categories) {\n        await this._update7Migration_cagetory({ mapCagetoryIds, categories, category });\n      }\n      return mapCagetoryIds;\n    }\n    async _update7Migration_cagetory({ mapCagetoryIds, categories, category }) {\n      if (category.__parsed) return mapCagetoryIds[category.id];\n      let categoryIdParent = 0;\n      if (category.categoryIdParent > 0) {\n        const categoryParent = categories.find(item => item.id === category.categoryIdParent);\n        categoryIdParent = await this._update7Migration_cagetory({ mapCagetoryIds, categories, category: categoryParent });\n      }\n      const categoryIdNew = await this.ctx.bean.category.add({\n        atomClass: { id: category.atomClassId },\n        data: {\n          language: category.language,\n          categoryName: category.categoryName,\n          categoryHidden: category.hidden,\n          categorySorting: category.sorting,\n          categoryFlag: category.flag,\n          categoryUrl: category.url,\n          categoryIdParent,\n        },\n      });\n      category.__parsed = true;\n      mapCagetoryIds[category.id] = categoryIdNew;\n      return categoryIdNew;\n    }\n\n    _parseUuid(article) {\n      if (!article.url) return this._uuid();\n      const matches = article.url.match(/articles\\/(.*)\\.html/);\n      if (!matches) return this._uuid();\n      if (matches[1].length !== 32) return this._uuid();\n      return matches[1];\n    }\n\n    _uuid() {\n      return uuid.v4().replace(/-/g, '');\n    }\n\n  }\n\n  return Version;\n};\n","const versionManager = require('./bean/version.manager.js');\nconst localBuild = require('./bean/local.build.js');\nconst queueRender = require('./bean/queue.render.js');\nconst startupRegisterAllWatchers = require('./bean/startup.registerAllWatchers.js');\nconst atomArticle = require('./bean/atom.article.js');\nconst ioMessageHotloadFile = require('./bean/io.message.hotloadFile.js');\n\nmodule.exports = app => {\n  const beans = {\n    // version\n    'version.manager': {\n      mode: 'app',\n      bean: versionManager,\n    },\n    // local\n    'local.build': {\n      mode: 'app',\n      bean: localBuild,\n    },\n    // queue\n    'queue.render': {\n      mode: 'app',\n      bean: queueRender,\n    },\n    // startup\n    'startup.registerAllWatchers': {\n      mode: 'app',\n      bean: startupRegisterAllWatchers,\n    },\n    // atom\n    'atom.article': {\n      mode: 'app',\n      bean: atomArticle,\n    },\n    // io\n    'io.message.hotloadFile': {\n      mode: 'ctx',\n      bean: ioMessageHotloadFile,\n    },\n  };\n  return beans;\n};\n","const _formatDateTime = function(date, fmt) { // original author: meizz\n  const o = {\n    'M+': date.getMonth() + 1, // month\n    'D+': date.getDate(), // day\n    'H+': date.getHours(), // hour\n    'm+': date.getMinutes(), // minute\n    's+': date.getSeconds(), // second\n    'Q+': Math.floor((date.getMonth() + 3) / 3), // quarter\n    S: date.getMilliseconds(), // millisecond\n  };\n  if (/(Y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));\n  for (const k in o) { if (new RegExp('(' + k + ')').test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? (o[k]) : (('00' + o[k]).substr(('' + o[k]).length))); }\n  return fmt;\n};\n\nmodule.exports = {\n  now() {\n    return this.formatDateTime(null);\n  },\n  today() {\n    return this.formatDate(null);\n  },\n  formatDateTime(date, fmt) {\n    date = date || new Date();\n    if (typeof (date) !== 'object') date = new Date(date);\n    fmt = fmt || 'YYYY-MM-DD HH:mm:ss';\n    return _formatDateTime(date, fmt);\n  },\n  formatDate(date, sep) {\n    sep = sep || '-';\n    return this.formatDateTime(date, `YYYY${sep}MM${sep}DD`);\n  },\n  formatTime(date, sep) {\n    sep = sep || ':';\n    return this.formatDateTime(date, `HH${sep}mm${sep}ss`);\n  },\n};\n","\n/**\n  escapeHtml: based on markdown-it\n**/\n\nconst HTML_ESCAPE_TEST_RE = /[&<>\"']/;\nconst HTML_ESCAPE_REPLACE_RE = /[&<>\"']/g;\nconst HTML_REPLACEMENTS = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  '\\'': '&#039;',\n};\n\nfunction replaceUnsafeChar(ch) {\n  return HTML_REPLACEMENTS[ch];\n}\n\nfunction escapeHtml(str) {\n  if (HTML_ESCAPE_TEST_RE.test(str)) {\n    return str.replace(HTML_ESCAPE_REPLACE_RE, replaceUnsafeChar);\n  }\n  return str;\n}\n\nconst URL_ESCAPE_TEST_RE = /[<>\"']/;\nconst URL_ESCAPE_REPLACE_RE = /[<>\"']/g;\nconst URL_REPLACEMENTS = {\n  '<': '%3C',\n  '>': '%3E',\n  '\"': '%22',\n  '\\'': '%27',\n};\n\nfunction replaceUnsafeCharURL(ch) {\n  return URL_REPLACEMENTS[ch];\n}\n\nfunction escapeURL(str) {\n  if (URL_ESCAPE_TEST_RE.test(str)) {\n    return str.replace(URL_ESCAPE_REPLACE_RE, replaceUnsafeCharURL);\n  }\n  return str;\n}\n\nmodule.exports = {\n  atomClass(atomClass) {\n    let _atomClass;\n    if (atomClass) {\n      _atomClass = {\n        module: atomClass.module,\n        atomClassName: atomClass.atomClassName,\n        atomClassIdParent: atomClass.atomClassIdParent || 0,\n      };\n      if (atomClass.id) _atomClass.id = atomClass.id;\n    } else {\n      _atomClass = {\n        module: 'a-cms',\n        atomClassName: 'article',\n        atomClassIdParent: 0,\n      };\n    }\n    return _atomClass;\n  },\n  async atomClass2(ctx, atomClass) {\n    const _atomClass = this.atomClass(atomClass);\n    if (!_atomClass.id) {\n      const res = await ctx.bean.atomClass.get(_atomClass);\n      _atomClass.id = res.id;\n    }\n    return _atomClass;\n  },\n  escapeHtml(str) {\n    return escapeHtml(str);\n  },\n  escapeURL(str) {\n    return escapeURL(str);\n  },\n};\n","const require3 = require('require3');\nconst chokidar = require3('chokidar');\nconst debounce = require3('debounce');\n\nmodule.exports = function(app) {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Watcher {\n\n    constructor() {\n      this._watchers = {};\n      this._init();\n    }\n\n    _init() {\n      if (app.meta.inApp) {\n        // app\n        app.meta.messenger.addProvider({\n          name: 'a-cms:watcherChange',\n          handler: async info => {\n            await this._change(info);\n          },\n        });\n      } else {\n        // agent\n        app.meta.messenger.addProvider({\n          name: 'a-cms:watcherRegister',\n          handler: info => {\n            this._register(info);\n          },\n        });\n        app.meta.messenger.addProvider({\n          name: 'a-cms:watcherRegisterLanguages',\n          handler: info => {\n            this._registerLanguages(info);\n          },\n        });\n      }\n    }\n\n    // called by app\n    register(info) {\n      app.meta.messenger.callAgent({ name: 'a-cms:watcherRegister', data: info });\n    }\n\n    // called by app\n    registerLanguages(info) {\n      app.meta.messenger.callAgent({ name: 'a-cms:watcherRegisterLanguages', data: info });\n    }\n\n    // invoked in agent\n    _registerLanguages({ info, watcherInfos }) {\n      // key\n      const atomClasskey = JSON.stringify(info.atomClass);\n      // clear\n      const _arr = this._watchers.geto(info.subdomain).geto(info.atomClass.module).geto(atomClasskey);\n      for (const language in _arr) {\n        const watcherEntry = _arr[language];\n        if (watcherEntry.watcher) {\n          watcherEntry.watcher.close();\n          watcherEntry.watcher = null;\n        }\n      }\n      // register\n      for (const watcherInfo of watcherInfos) {\n        this._register(watcherInfo);\n      }\n    }\n\n    // invoked in agent\n    _register({ subdomain, atomClass, language, watchers }) {\n      // key\n      const atomClasskey = JSON.stringify(atomClass);\n      // watcherEntry\n      const watcherEntry = this._watchers\n        .geto(subdomain).geto(atomClass.module).geto(atomClasskey)\n        .geto(language);\n      if (watcherEntry.watcher) {\n        watcherEntry.watcher.close();\n        watcherEntry.watcher = null;\n      } else {\n        watcherEntry.info = { subdomain, atomClass, language, watchers };\n      }\n      // watcher\n      watcherEntry.watcher = chokidar.watch(watchers)\n        .on('change', debounce(function() {\n          app.meta.messenger.callRandom({\n            name: 'a-cms:watcherChange',\n            data: { subdomain, atomClass, language },\n          });\n        }, 300));\n    }\n\n    // invoked in app\n    async _change({ subdomain, atomClass, language }) {\n      app.meta.queue.push({\n        subdomain,\n        module: moduleInfo.relativeName,\n        queueName: 'render',\n        queueNameSub: `${atomClass.module}:${atomClass.atomClassName}`,\n        data: {\n          queueAction: 'buildLanguage',\n          atomClass,\n          language,\n        },\n      });\n    }\n\n  }\n\n  return Watcher;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {};\n\n  // queues\n  config.queues = {\n    render: {\n      bean: 'render',\n      concurrency: true,\n    },\n  };\n\n  // startups\n  config.startups = {\n    registerAllWatchers: {\n      bean: 'registerAllWatchers',\n      instance: true,\n      debounce: true,\n    },\n  };\n\n  // article\n  config.article = {\n    trim: {\n      limit: 100,\n      wordBreak: false,\n      preserveTags: false,\n    },\n  };\n\n  // site\n  config.site = {\n    base: {\n      title: 'my blog',\n      subTitle: 'gone with the wind',\n      description: '',\n      keywords: '',\n    },\n    host: {\n      url: 'http://example.com',\n      rootPath: '',\n    },\n    language: {\n      default: 'en-us',\n      items: 'en-us',\n    },\n    themes: {\n      'en-us': 'cms-themeblog',\n    },\n    edit: {\n      mode: 1, // markdown\n    },\n    env: {\n      format: {\n        date: 'YYYY-MM-DD',\n        time: 'HH:mm:ss',\n      },\n      article2: {\n        recentNum: 5,\n      },\n      comment: {\n        order: 'asc',\n        recentNum: 5,\n      },\n      brother: {\n        order: 'desc',\n      },\n      loadMore: {\n        loadOnScroll: false,\n      },\n    },\n    profile: {\n      userName: 'zhennann',\n      motto: 'Less is more, while more is less.',\n      avatar: 'assets/images/avatar.jpg',\n      url: 'index.html',\n      extra: '',\n    },\n  };\n\n  //\n  return config;\n};\n","// error code should start from 1001\nmodule.exports = {\n  1001: 'Language must not be Empty',\n  1002: 'Theme %s:%s:%s not Set',\n  1003: 'Theme %s not Found',\n  1004: 'Cannot delete if has children',\n  1005: 'Cannot delete if has articles',\n  1006: 'Build Site First',\n};\n","module.exports = {\n  'en-us': 'English',\n  'zh-cn': 'Chinese',\n  PersonalProfile: 'Profile',\n  AuthorProfile: 'Author Profile',\n  ArticlePrevious: 'Previous',\n  ArticleNext: 'Next',\n  second2: 's',\n};\n","module.exports = {\n  All: '',\n  Article: '',\n  Catalog: '',\n  Category: '',\n  Categories: '',\n  Comment: '',\n  Comments: '',\n  Language: '',\n  Publish: '',\n  Publishing: '',\n  Published: '',\n  Search: '',\n  Submit: '',\n  Sorting: '',\n  Tag: '',\n  Tags: '',\n  Url: '',\n  'Are You Sure?': '',\n  'Article List': '',\n  'Article List(by Category)': '()',\n  'Category Name': '',\n  'Comment Disabled': '',\n  'Create Article': '',\n  'Language must not be Empty': '',\n  'Load More': '',\n  'Post Comment': '',\n  'Recent Comments': '',\n  'Theme %s:%s:%s not Set': '%s:%s:%s',\n  'Theme %s not Found': '%s',\n  'en-us': '',\n  'zh-cn': '',\n  'CMS Block': 'CMS',\n  PersonalProfile: '',\n  AuthorProfile: '',\n  ArticlePrevious: '',\n  ArticleNext: '',\n  Yes: '',\n  No: '',\n  Sticky: '',\n  Initialize: '',\n  'Render Files': '',\n  'Time Used': '',\n  seconds: '',\n  second2: '',\n  Build: '',\n  Block: '',\n  'Slug Exists': 'Slug',\n  'Build Site First': '',\n  'Cannot delete if has children': '',\n  'Cannot delete if has articles': '',\n};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","module.exports = app => {\n  const hotloadFile = {\n    info: {\n      bean: 'hotloadFile',\n      title: 'Hotload File',\n      persistence: false,\n    },\n  };\n  return hotloadFile;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const content = {\n    listener: null,\n    process: {\n      nodes: [\n        {\n          id: 'startEvent_1',\n          name: 'Drafting',\n          type: 'startEventAtom',\n          options: {\n            atom: {\n              module: moduleInfo.relativeName,\n              atomClassName: 'article',\n            },\n            conditionExpression: null,\n          },\n        },\n        {\n          id: 'activity_1',\n          name: 'Review',\n          type: 'activityUserTask',\n          options: {\n            assignees: {\n              roles: 'superuser',\n            },\n            confirmation: false,\n            bidding: true,\n            schema: {\n              write: true,\n            },\n          },\n        },\n        {\n          id: 'endEvent_1',\n          name: 'End',\n          type: 'endEventNone',\n        },\n      ],\n      edges: [\n        {\n          id: 'edge_1',\n          source: 'startEvent_1',\n          target: 'activity_1',\n        },\n        {\n          id: 'edge_2',\n          source: 'activity_1',\n          target: 'endEvent_1',\n        },\n      ],\n    },\n  };\n  const definition = {\n    atomName: 'CMS Article Publish',\n    atomStaticKey: 'flowArticlePublish',\n    atomRevision: 0,\n    description: '',\n    content: JSON.stringify(content),\n  };\n  return definition;\n};\n","const articlePublish = require('./flowDef/articlePublish.js');\n\nmodule.exports = app => {\n  const flowDefs = [\n    articlePublish(app),\n  ];\n  return flowDefs;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const resources = [\n    // menu\n    {\n      atomName: 'Create Article',\n      atomStaticKey: 'createArticle',\n      atomRevision: 0,\n      atomCategoryId: 'a-base:menu.Create',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'article',\n        atomAction: 'create',\n      }),\n      resourceRoles: 'template.cms-writer',\n    },\n    {\n      atomName: 'Article List',\n      atomStaticKey: 'listArticle',\n      atomRevision: 0,\n      atomCategoryId: 'a-base:menu.List',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'article',\n        atomAction: 'read',\n      }),\n      resourceRoles: 'root',\n    },\n  ];\n  return resources;\n};\n","module.exports = app => {\n  const keywords = {};\n  keywords.slug = {\n    async: true,\n    type: 'string',\n    errors: true,\n    compile() {\n      return async function(data, path, rootData, name) {\n        // ignore if empty\n        if (!data) return true;\n        // unique slug for atomLanguage and atomClass\n        const ctx = this;\n        //   atomClass from atomId\n        const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: rootData.atomId });\n        //   read by atomClass, atomLanguage, slug\n        const items = await ctx.model.query(`\n          select a.id from aAtom a\n            left join aCmsArticle b on a.id=b.atomId\n              where a.atomStage=0 and a.iid=? and a.deleted=0 and a.atomClassId=? and a.atomLanguage=? and b.slug=?\n          `, [ ctx.instance.id, atomClass.id, rootData.atomLanguage, data ]);\n        if (items[0] && items[0].id !== rootData.atomId) {\n          const errors = [{ keyword: 'x-slug', params: [], message: ctx.text('Slug Exists') }];\n          throw new app.meta.ajv.ValidationError(errors);\n        }\n        return true;\n      };\n    },\n  };\n  return keywords;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const schemas = {};\n  // article\n  schemas.article = {\n    type: 'object',\n    properties: {\n      atomId: {\n        type: 'number',\n      },\n      // title\n      groupTitle: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Title',\n      },\n      atomName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Atom Name',\n        notEmpty: true,\n      },\n      // content\n      groupContent: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Content',\n      },\n      content: {\n        type: 'string',\n        ebType: 'component',\n        ebTitle: 'Content',\n        ebRender: {\n          module: moduleInfo.relativeName,\n          name: 'renderArticleContent',\n        },\n      },\n      // Basic Info\n      groupBasicInfo: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Basic Info',\n      },\n      atomLanguage: {\n        type: 'string',\n        ebType: 'language',\n        ebTitle: 'Language',\n      },\n      atomCategoryId: {\n        type: 'number',\n        ebType: 'category',\n        ebTitle: 'Category',\n      },\n      atomTags: {\n        type: [ 'string', 'null' ],\n        ebType: 'tags',\n        ebTitle: 'Tags',\n      },\n      keywords: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Keywords',\n      },\n      description: {\n        type: 'string',\n        ebType: 'text',\n        ebTextarea: true,\n        ebTitle: 'Description',\n      },\n      slug: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Slug',\n        'x-slug': true,\n      },\n      allowComment: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Allow Comment',\n        default: true,\n      },\n      // Extra\n      groupExtra: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Extra',\n      },\n      sticky: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Sticky',\n        default: false,\n      },\n      sorting: {\n        type: 'number',\n        ebType: 'text',\n        ebTitle: 'Sorting',\n      },\n      flag: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Flag',\n      },\n      extra: {\n        type: 'string',\n        ebType: 'text',\n        ebTextarea: true,\n        ebTitle: 'Extra Attributes',\n      },\n      editMode: {\n        type: 'number',\n        // ebType: 'text',\n        ebTitle: 'Edit Mode',\n        notEmpty: true,\n      },\n    },\n  };\n\n  // article search\n  schemas.articleSearch = {\n    type: 'object',\n    properties: {\n      content: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Content',\n      },\n    },\n  };\n\n  return schemas;\n};\n","const require3 = require('require3');\nconst extend = require3('extend2');\nconst utils = require('../common/utils.js');\n\nmodule.exports = app => {\n\n  class ArticleController extends app.Controller {\n\n    // list\n    async list() {\n      // atomClass\n      const atomClass = utils.atomClass(this.ctx.request.body.atomClass);\n      // options\n      const options = this.ctx.request.body.options;\n      // stage\n      options.stage = 'formal';\n      // user\n      const user = this.ctx.state.user.op;\n      // select\n      options.page = this.ctx.bean.util.page(options.page, false);\n      const items = await this.ctx.bean.atom.select({ atomClass, options, user, pageForce: false });\n      // ok\n      this.ctx.successMore(items, options.page.index, options.page.size);\n    }\n\n    // attachments\n    async attachments() {\n      // key\n      const key = this.ctx.request.body.key;\n      // options\n      const options = this.ctx.request.body.options || {};\n      // filter drafts\n      options.where = extend(true, options.where, {\n        mode: 2,\n        attachment: 1,\n      });\n      if (!options.orders) {\n        options.orders = [\n          [ 'realName', 'asc' ],\n        ];\n      }\n      // select\n      const res = await this.ctx.performAction({\n        method: 'post',\n        url: '/a/file/file/list',\n        body: {\n          key,\n          options,\n        },\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return ArticleController;\n};\n\n","const utils = require('../common/utils.js');\n\nmodule.exports = app => {\n\n  class CommentController extends app.Controller {\n\n    async all() {\n      // atomClass\n      const atomClass = utils.atomClass(this.ctx.request.body.atomClass);\n      // options\n      const options = this.ctx.request.body.options;\n      // stage\n      options.stage = 'formal';\n      // select\n      const res = await this.ctx.performAction({\n        method: 'post',\n        url: '/a/base/comment/all',\n        body: {\n          atomClass,\n          options,\n        },\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return CommentController;\n};\n","module.exports = app => {\n\n  class RenderController extends app.Controller {\n\n    async getArticleUrl() {\n      const res = await this.ctx.service.render.getArticleUrl({\n        atomClass: this.ctx.request.body.atomClass,\n        key: this.ctx.request.body.key,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return RenderController;\n};\n\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class RSSController extends app.Controller {\n\n    async feed() {\n      // params\n      //   module\n      const module = this.ctx.params.module;\n      //   atomClassName\n      const atomClassName = this.ctx.params.atomClassName;\n      //   language\n      const language = this.ctx.params.language;\n      // atomClass\n      const atomClass = { module, atomClassName };\n      // options\n      const options = {\n        language,\n        orders: [\n          [ 'a.updatedAt', 'desc' ],\n        ],\n        page: { index: 0 },\n        mode: 'default',\n      };\n      // select\n      const res = await this.ctx.performAction({\n        method: 'post',\n        url: '/a/cms/article/list',\n        body: { atomClass, options },\n      });\n      const list = res.list;\n      // build\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      // site\n      const site = await build.getSite({ language });\n      // feed\n      let feed =\n`<rss xmlns:dc=\"http://purl.org/dc/elements/1.1/\" version=\"2.0\">\n  <channel>\n    <title><![CDATA[${site.base.title}]]></title>\n    <link>${build.getUrl(site, language, 'index.html')}</link>\n    <description><![CDATA[${site.base.description || site.base.subTitle}]]></description>\n    <language>${language}</language>\n    <generator>https://cms.cabloy.com</generator>\n`;\n      for (const article of list) {\n        feed +=\n`\n    <item>\n      <title>\n        <![CDATA[\n          ${article.atomName}\n        ]]>\n      </title>\n      <link>\n        ${build.getUrl(site, language, article.url)}\n      </link>\n      <description>\n        <![CDATA[\n          ${article.description || article.summary}\n        ]]>\n      </description>\n      <category><![CDATA[${article.categoryName}]]></category>\n      <pubDate>${article.updatedAt}</pubDate>\n      <dc:creator><![CDATA[${article.userName}]]></dc:creator>\n    </item>\n`;\n      }\n      feed +=\n`\n  </channel>\n</rss>\n`;\n      // ok\n      this.ctx.status = 200;\n      this.ctx.body = feed;\n      this.ctx.set('content-type', 'application/rss+xml; charset=UTF-8');\n    }\n\n    async feedComments() {\n      // params\n      //   module\n      const module = this.ctx.params.module;\n      //   atomClassName\n      const atomClassName = this.ctx.params.atomClassName;\n      //   language\n      const language = this.ctx.params.language;\n      // atomClass\n      const atomClass = { module, atomClassName };\n      // options\n      const options = {\n        orders: [\n          [ 'h_updatedAt', 'desc' ],\n        ],\n        page: { index: 0 },\n      };\n      // select\n      const res = await this.ctx.performAction({\n        method: 'post',\n        url: '/a/cms/comment/all',\n        body: { atomClass, options },\n      });\n      const list = res.list;\n      // build\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      // site\n      const site = await build.getSite({ language });\n      // feed\n      let feed =\n`<rss xmlns:dc=\"http://purl.org/dc/elements/1.1/\" version=\"2.0\">\n  <channel>\n    <title><![CDATA[Comments for ${site.base.title}]]></title>\n    <link>${build.getUrl(site, language, 'index.html')}</link>\n    <description><![CDATA[${site.base.description || site.base.subTitle}]]></description>\n    <language>${language}</language>\n    <generator>https://cms.cabloy.com</generator>\n`;\n      for (const item of list) {\n        feed +=\n`\n    <item>\n      <title>\n        <![CDATA[\n          Comment on ${item.atomName}\n        ]]>\n      </title>\n      <link>\n        ${build.getUrl(site, language, item.url)}#comments\n      </link>\n      <description>\n        <![CDATA[\n          ${item.h_summary}\n        ]]>\n      </description>\n      <pubDate>${item.h_updatedAt}</pubDate>\n      <dc:creator><![CDATA[${item.h_userName}]]></dc:creator>\n    </item>\n`;\n      }\n      feed +=\n`\n  </channel>\n</rss>\n`;\n      // ok\n      this.ctx.status = 200;\n      this.ctx.body = feed;\n      this.ctx.set('content-type', 'application/rss+xml; charset=UTF-8');\n    }\n\n    async articleComments() {\n      // atomId\n      const atomId = this.ctx.params.atomId;\n      // article\n      const article = await this.ctx.bean._getBean(`${moduleInfo.relativeName}.atom.article`)._getArticle({ key: { atomId }, inner: false });\n      if (!article) this.ctx.throw.module('a-base', 1002);\n      // language\n      const language = article.atomLanguage;\n      // options\n      const options = {\n        orders: [\n          [ 'updatedAt', 'desc' ],\n        ],\n        page: { index: 0 },\n      };\n      const res = await this.ctx.performAction({\n        method: 'post',\n        url: '/a/base/comment/list',\n        body: {\n          key: { atomId },\n          options,\n        },\n      });\n      const list = res.list;\n      // atomClass\n      const atomClass = await this.ctx.bean.atomClass.get({ id: article.atomClassId });\n      // build\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      // site\n      const site = await build.getSite({ language });\n      // feed\n      let feed =\n`<rss xmlns:dc=\"http://purl.org/dc/elements/1.1/\" version=\"2.0\">\n  <channel>\n    <title><![CDATA[Comments on: ${article.atomName}]]></title>\n    <link>${build.getUrl(site, language, article.url)}</link>\n    <description><![CDATA[${article.description || article.summary}]]></description>\n    <language>${language}</language>\n    <generator>https://cms.cabloy.com</generator>\n`;\n      for (const item of list) {\n        feed +=\n`\n    <item>\n      <title>\n        <![CDATA[\n          Comment on ${article.atomName}\n        ]]>\n      </title>\n      <link>\n        ${build.getUrl(site, language, article.url)}#comments\n      </link>\n      <description>\n        <![CDATA[\n          ${item.summary}\n        ]]>\n      </description>\n      <pubDate>${item.updatedAt}</pubDate>\n      <dc:creator><![CDATA[${item.userName}]]></dc:creator>\n    </item>\n`;\n      }\n      feed +=\n`\n  </channel>\n</rss>\n`;\n      // ok\n      this.ctx.status = 200;\n      this.ctx.body = feed;\n      this.ctx.set('content-type', 'application/rss+xml; charset=UTF-8');\n    }\n\n  }\n  return RSSController;\n};\n\n","const utils = require('../common/utils.js');\n\nmodule.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class SiteController extends app.Controller {\n\n    async getConfigSiteBase() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const data = await this.ctx.service.site.getConfigSiteBase({ atomClass });\n      this.ctx.success({ data });\n    }\n\n    async getConfigSite() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const data = await this.ctx.service.site.getConfigSite({ atomClass });\n      this.ctx.success({ data });\n    }\n\n    async setConfigSite() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.site.setConfigSite({\n        atomClass,\n        data: this.ctx.request.body.data,\n      });\n      this.ctx.success(res);\n    }\n\n    async getConfigLanguagePreview() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const data = await this.ctx.service.site.getConfigLanguagePreview({\n        atomClass,\n        language: this.ctx.request.body.language,\n      });\n      this.ctx.success({ data });\n    }\n\n    async getConfigLanguage() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const data = await this.ctx.service.site.getConfigLanguage({\n        atomClass,\n        language: this.ctx.request.body.language,\n      });\n      this.ctx.success({ data });\n    }\n\n    async setConfigLanguage() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.site.setConfigLanguage({\n        atomClass,\n        language: this.ctx.request.body.language,\n        data: this.ctx.request.body.data,\n      });\n      this.ctx.success(res);\n    }\n\n    async buildLanguage() {\n      // atomClass\n      const atomClass = utils.atomClass(this.ctx.request.body.atomClass);\n      const language = this.ctx.request.body.language;\n      // progress\n      const progressId = await this.ctx.bean.progress.create();\n      // build\n      this.ctx.service.site.buildLanguageQueue({ atomClass, language, progressId });\n      this.ctx.success({ progressId });\n    }\n\n    async buildLanguages() {\n      // atomClass\n      const atomClass = utils.atomClass(this.ctx.request.body.atomClass);\n      // progress\n      const progressId = await this.ctx.bean.progress.create();\n      // build\n      this.ctx.service.site.buildLanguagesQueue({ atomClass, progressId });\n      this.ctx.success({ progressId });\n    }\n\n    async getLanguages() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.site.getLanguages({ atomClass });\n      this.ctx.success(res);\n    }\n\n    async getUrl() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.site.getUrl({\n        atomClass,\n        language: this.ctx.request.body.language,\n        path: this.ctx.request.body.path,\n      });\n      this.ctx.success(res);\n    }\n\n    async blockSave() {\n      const res = await this.ctx.service.site.blockSave({\n        blockName: this.ctx.request.body.blockName,\n        item: this.ctx.request.body.item,\n      });\n      this.ctx.success(res);\n    }\n\n    async getStats() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.site.getStats({\n        atomClass,\n        languages: this.ctx.request.body.languages,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return SiteController;\n};\n\n","const article = require('./controller/article.js');\nconst render = require('./controller/render.js');\nconst site = require('./controller/site.js');\nconst comment = require('./controller/comment.js');\nconst rss = require('./controller/rss.js');\n\nmodule.exports = app => {\n  const controllers = {\n    article,\n    render,\n    site,\n    comment,\n    rss,\n  };\n  return controllers;\n};\n","const config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\nconst WatcherFn = require('./common/watcher.js');\n\nmodule.exports = app => {\n\n  // watcher: only in development\n  if (app.meta.isLocal) {\n    app.meta['a-cms:watcher'] = new (WatcherFn(app))();\n  }\n\n  // beans\n  const beans = require('./beans.js')(app);\n  // routes\n  const routes = require('./routes.js')(app);\n  // controllers\n  const controllers = require('./controllers.js')(app);\n  // services\n  const services = require('./services.js')(app);\n  // models\n  const models = require('./models.js')(app);\n  // meta\n  const meta = require('./meta.js')(app);\n\n  return {\n    beans,\n    routes,\n    controllers,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    meta,\n  };\n\n};\n","module.exports = app => {\n  const keywords = require('./config/validation/keywords.js')(app);\n  const schemas = require('./config/validation/schemas.js')(app);\n  const socketioHotloadFile = require('./config/socketio/hotloadFile.js')(app);\n  const staticFlowDefs = require('./config/static/flowDefs.js')(app);\n  const staticResources = require('./config/static/resources.js')(app);\n  const meta = {\n    base: {\n      atoms: {\n        article: {\n          info: {\n            bean: 'article',\n            title: 'Article',\n            tableName: 'aCmsArticle',\n            tableNameModes: {\n              default: 'aCmsArticle',\n              full: 'aCmsArticleViewFull',\n              search: 'aCmsArticleViewSearch',\n            },\n            language: true,\n            category: true,\n            tag: true,\n            cms: true,\n          },\n          actions: {\n          },\n          validator: 'article',\n          search: {\n            validator: 'articleSearch',\n          },\n        },\n      },\n      resources: {\n        block: {\n          title: 'CMS Block',\n        },\n      },\n      statics: {\n        'a-flow.flowDef': {\n          items: staticFlowDefs,\n        },\n        'a-base.resource': {\n          items: staticResources,\n        },\n      },\n    },\n    validation: {\n      validators: {\n        article: {\n          schemas: 'article',\n        },\n        articleSearch: {\n          schemas: 'articleSearch',\n        },\n      },\n      keywords: {\n        'x-slug': keywords.slug,\n      },\n      schemas: {\n        article: schemas.article,\n        articleSearch: schemas.articleSearch,\n      },\n    },\n    settings: {\n      instance: {\n        actionPath: 'config/list',\n      },\n    },\n    event: {\n      implementations: {\n      },\n    },\n    socketio: {\n      messages: {\n        hotloadFile: socketioHotloadFile,\n      },\n    },\n  };\n  return meta;\n};\n","module.exports = app => {\n  class Article extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aCmsArticle', options: { disableDeleted: false } });\n    }\n  }\n  return Article;\n};\n","module.exports = app => {\n  class Content extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aCmsContent', options: { disableDeleted: false } });\n    }\n  }\n  return Content;\n};\n","const article = require('./model/article.js');\nconst content = require('./model/content.js');\n\nmodule.exports = app => {\n  const models = {\n    article,\n    content,\n  };\n  return models;\n};\n","module.exports = app => {\n  let routes = [\n    // article\n    { method: 'post', path: 'article/list', controller: 'article' },\n    { method: 'post', path: 'article/attachments', controller: 'article' },\n    // comment\n    { method: 'post', path: 'comment/all', controller: 'comment' },\n    // render\n    { method: 'post', path: 'render/getArticleUrl', controller: 'render',\n      meta: { right: { type: 'atom', action: 2, checkFlow: true } },\n    },\n    // site\n    { method: 'post', path: 'site/getConfigSiteBase', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/getConfigSite', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/setConfigSite', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/getConfigLanguagePreview', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/getConfigLanguage', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/setConfigLanguage', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/buildLanguage', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/buildLanguages', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'site/getLanguages', controller: 'site' },\n    { method: 'post', path: 'site/getUrl', controller: 'site' },\n    { method: 'post', path: 'site/blockSave', controller: 'site' },\n    { method: 'post', path: 'site/getStats', controller: 'site', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    // rss\n    { method: 'get', path: 'rss/feed/article/comments/:atomId', controller: 'rss', action: 'articleComments' },\n    { method: 'get', path: 'rss/feed/comments/:module/:atomClassName/:language', controller: 'rss', action: 'feedComments' },\n    { method: 'get', path: 'rss/feed/:module/:atomClassName/:language', controller: 'rss', action: 'feed' },\n  ];\n  if (app.meta.isTest || app.meta.isLocal) {\n    routes = routes.concat([\n    ]);\n  }\n  return routes;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Render extends app.Service {\n\n    async getArticleUrl({ atomClass, key }) {\n      if (!atomClass) {\n        atomClass = await this.ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      }\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.getArticleUrl({ key });\n    }\n\n    // site<plugin<theme<site(db)<language(db)\n    async combineSiteBase({ atomClass, mergeConfigSite }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.combineSiteBase({ mergeConfigSite });\n    }\n\n  }\n\n  return Render;\n};\n","const require3 = require('require3');\nconst extend = require3('extend2');\n\nlet __blocks = null;\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Site extends app.Service {\n\n    async getSite({ atomClass, language, options }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.getSite({ language, options });\n    }\n\n    async getConfigSiteBase({ atomClass }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.getConfigSiteBase();\n    }\n\n    async getConfigSite({ atomClass }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.getConfigSite();\n    }\n\n    // save site config\n    async setConfigSite({ atomClass, data }) {\n      // build\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      // save\n      await build.setConfigSite({ data });\n      // only in development\n      if (this.ctx.app.meta.isLocal) {\n        // build site\n        this.buildLanguagesQueue({ atomClass });\n        // register watchers\n        await build.registerWatchers();\n      }\n    }\n\n    async getConfigLanguagePreview({ atomClass, language }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.getConfigLanguagePreview({ language });\n    }\n\n    async getConfigLanguage({ atomClass, language }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.getConfigLanguage({ language });\n    }\n\n    // save language config\n    async setConfigLanguage({ atomClass, language, data }) {\n      // build\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      // save\n      await build.setConfigLanguage({ language, data });\n      // only in development\n      if (this.ctx.app.meta.isLocal) {\n        // build site\n        this.buildLanguageQueue({ atomClass, language });\n        // register watcher\n        await build.registerWatcher({ language });\n      }\n    }\n\n    async getLanguages({ atomClass }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      return await build.getLanguages();\n    }\n\n    async getUrl({ atomClass, language, path }) {\n      const build = this.ctx.bean._newBean(`${moduleInfo.relativeName}.local.build`, atomClass);\n      const site = await build.getSite({ language });\n      return build.getUrl(site, language, path);\n    }\n\n    buildLanguagesQueue({ atomClass, progressId }) {\n      // queue\n      this.ctx.app.meta.queue.push({\n        locale: this.ctx.locale,\n        subdomain: this.ctx.subdomain,\n        module: moduleInfo.relativeName,\n        queueName: 'render',\n        queueNameSub: `${atomClass.module}:${atomClass.atomClassName}`,\n        data: {\n          queueAction: 'buildLanguages',\n          atomClass,\n          progressId,\n        },\n      });\n    }\n\n    buildLanguageQueue({ atomClass, language, progressId }) {\n      // queue\n      this.ctx.app.meta.queue.push({\n        locale: this.ctx.locale,\n        subdomain: this.ctx.subdomain,\n        module: moduleInfo.relativeName,\n        queueName: 'render',\n        queueNameSub: `${atomClass.module}:${atomClass.atomClassName}`,\n        data: {\n          queueAction: 'buildLanguage',\n          atomClass,\n          language,\n          progressId,\n        },\n      });\n    }\n\n    async getStats({ atomClass, languages }) {\n      const res = {};\n      for (const language of languages) {\n        res[language] = await this._getStatsLanguange({ atomClass, language });\n      }\n      return res;\n    }\n\n    async _getStatsLanguange({ atomClass, language }) {\n      const stats = {};\n\n      // articles\n      stats.articles = await this.ctx.bean.atom.count({\n        atomClass,\n        options: {\n          language,\n          mode: 'default',\n        },\n      });\n\n      // comments\n      stats.comments = await this.ctx.bean.atom.count({\n        atomClass,\n        options: {\n          language,\n          mode: 'default',\n          comment: 1,\n        },\n      });\n\n      // categories\n      stats.categories = await this.ctx.bean.category.count({\n        atomClass, language,\n      });\n\n      // tags\n      stats.tags = await this.ctx.bean.tag.count({\n        atomClass, language,\n      });\n\n      // ok\n      return stats;\n    }\n\n    async blockSave({ blockName, item }) {\n      // block\n      const blocks = this.getBlocks();\n      const block = blocks[blockName];\n      // validate\n      await this.ctx.bean.validation.validate({\n        module: block.validator.module,\n        validator: block.validator.validator,\n        schema: null,\n        data: item,\n      });\n      // output\n      if (!block.output) return item;\n      return await block.output({ ctx: this.ctx, block, data: item });\n    }\n\n    getBlocks() {\n      if (!__blocks) {\n        __blocks = this._prepareBlocks();\n      }\n      return __blocks;\n    }\n\n    _prepareBlocks() {\n      const blocks = {};\n      // (X) modulesArray for block override\n      for (const module of this.app.meta.modulesArray) {\n        if (module.main.meta && module.main.meta.cms &&\n          module.main.meta.cms.plugin && module.main.meta.cms.plugin.blocks) {\n          const blocksModule = this._prepareBlocksModule({ module, blocks: module.main.meta.cms.plugin.blocks });\n          Object.assign(blocks, blocksModule);\n        }\n      }\n      return blocks;\n    }\n\n    _prepareBlocksModule({ module, blocks }) {\n      const blocksModule = {};\n      const moduleName = module.info.relativeName;\n      for (const key in blocks) {\n        const fullName = `${moduleName}:${key}`;\n        blocksModule[fullName] = blocks[key];\n      }\n      return blocksModule;\n    }\n\n  }\n\n  return Site;\n};\n","const render = require('./service/render.js');\nconst site = require('./service/site.js');\n\nmodule.exports = app => {\n  const services = {\n    render,\n    site,\n  };\n  return services;\n};\n","module.exports = require(\"path\");;","module.exports = require(\"require3\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(421);\n"],"sourceRoot":""}